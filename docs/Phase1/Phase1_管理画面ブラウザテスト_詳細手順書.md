# Phase 1: 管理画面ブラウザテスト 詳細手順書

**作成日時**: 2025年12月5日 18:30  
**最終更新日時**: 2025年12月5日 18:30  
**実施者**: Auto (AI Assistant)  
**対象**: 管理画面の各機能の詳細なブラウザテスト手順  
**状態**: ✅ **詳細手順書作成完了**  
**ファイル名**: `Phase1_管理画面ブラウザテスト_詳細手順書_20251205_1830.md`

---

## 1. FAQ管理画面（優先度: 高、既知の問題あり）

### 1.1 テストの目的

FAQ管理画面のすべての機能が正常に動作することを確認する。特に、FAQ追加・編集・削除、埋め込みベクトル自動生成の動作を確認する。

### 1.2 テスト手順

#### ステップ1: FAQ管理画面へのアクセス

1. 管理画面にログイン（`test@example.com` / `testpassword123`）
2. サイドバーまたはナビゲーションメニューから「FAQ管理」をクリック
3. FAQ管理画面が表示されることを確認

**確認項目**:
- [ ] FAQ管理画面が正常に表示される
- [ ] 「+ 新規FAQ追加」ボタンが表示される
- [ ] FAQ一覧が表示される（既存のFAQがある場合）

#### ステップ2: FAQ一覧の表示確認

1. FAQ一覧が表示されていることを確認
2. 各FAQに以下の情報が表示されていることを確認：
   - 質問文
   - 回答文
   - カテゴリ
   - 優先度
   - 編集ボタン
   - 削除ボタン

**確認項目**:
- [ ] FAQ一覧が正常に表示される
- [ ] 各FAQの情報が正しく表示される
- [ ] 編集ボタンと削除ボタンが表示される

#### ステップ3: FAQ追加の動作確認

1. 「+ 新規FAQ追加」ボタンをクリック
2. FAQ追加フォームが表示されることを確認
3. 以下の情報を入力：
   - **質問**: "What time is check-in?"
   - **回答**: "Check-in time is from 3:00 PM to 10:00 PM."
   - **カテゴリ**: "basic"（基本情報）
   - **優先度**: 1（デフォルト）
   - **言語**: "en"（英語）
   - **有効/無効**: 有効（デフォルト）
4. 「保存」ボタンをクリック
5. ローディング表示が表示されることを確認
6. 成功メッセージが表示されることを確認
7. FAQ一覧に新規FAQが追加されることを確認

**確認項目**:
- [ ] FAQ追加フォームが正常に表示される
- [ ] 入力フィールドが正常に動作する
- [ ] 「保存」ボタンをクリックするとローディング表示が表示される
- [ ] 成功メッセージが表示される
- [ ] FAQ一覧に新規FAQが追加される
- [ ] 画面が自動的に更新される（または手動で更新が必要な場合、更新後に表示される）

#### ステップ4: 埋め込みベクトル自動生成の動作確認

**目的**: FAQ追加時に埋め込みベクトルが自動生成されることを確認する

**テスト手順**:

1. **ブラウザの開発者ツールを開く**
   - Chrome/Edge: `F12` または `Ctrl+Shift+I` (Windows) / `Cmd+Option+I` (Mac)
   - Firefox: `F12` または `Ctrl+Shift+I` (Windows) / `Cmd+Option+I` (Mac)
   - Safari: `Cmd+Option+I` (Mac)

2. **ネットワークタブを開く**
   - 開発者ツールの「Network」タブを選択
   - 「Preserve log」にチェックを入れる（推奨）

3. **FAQ追加を実行**
   - ステップ3の手順でFAQを追加
   - ネットワークタブで `POST /api/v1/admin/faqs` リクエストを確認

4. **APIレスポンスを確認**
   - `POST /api/v1/admin/faqs` リクエストをクリック
   - 「Response」タブを開く
   - レスポンスに `id` が含まれていることを確認（FAQが正常に作成されたことを示す）

5. **データベースで埋め込みベクトルを確認**
   - ターミナルで以下のコマンドを実行：
   ```bash
   docker-compose exec postgres psql -U yadopera_user -d yadopera -c "SELECT id, question, answer, embedding IS NOT NULL as has_embedding FROM faqs WHERE question = 'What time is check-in?' ORDER BY id DESC LIMIT 1;"
   ```
   - または、データベースクライアントツール（pgAdmin、DBeaverなど）を使用して確認
   - **注意**: `array_length()`関数は`vector`型には使用できません。次元数（1536）は実装コードで保証されているため、存在確認のみで十分です。

6. **確認すべき項目**:
   - `has_embedding` が `true` であること（埋め込みベクトルが生成されている）
   - **次元数（1536）の確認**: 実装コード（`backend/app/ai/embeddings.py`）で保証されているため、データベースでの確認は不要です。必要に応じて、バックエンドのログで確認してください。

**確認項目**:
- [ ] APIリクエストが正常に送信される（ネットワークタブで確認）
- [ ] APIレスポンスが正常に返される（200 OK）
- [ ] データベースに埋め込みベクトルが保存されている（`embedding IS NOT NULL`）
- [ ] **次元数（1536）の確認**: 実装コードで保証されているため、データベースでの確認は不要です。必要に応じて、バックエンドのログで確認してください。

**注意**: 埋め込みベクトル生成は非同期で実行されるため、APIレスポンスが返された直後でも、データベースに保存されるまでに数秒かかる場合があります。確認する際は、数秒待ってからデータベースを確認してください。

#### ステップ5: FAQ編集の動作確認（既知の問題あり）

1. FAQ一覧から任意のFAQを選択
2. 「編集」ボタンをクリック
3. FAQ編集フォームが表示されることを確認
4. 既存の情報が正しく表示されることを確認
5. 回答文を変更（例: "Check-in time is from 2:00 PM to 11:00 PM."）
6. 「保存」ボタンをクリック

**既知の問題**:
- ⚠️ 確認モーダルが2回表示される可能性がある
- ⚠️ 「FAQ not found: faq_id=2」というエラーが表示される可能性がある
- ⚠️ 編集が保存されない可能性がある

**確認項目**:
- [ ] FAQ編集フォームが正常に表示される
- [ ] 既存の情報が正しく表示される
- [ ] 編集内容を保存できる（既知の問題が解決されている場合）
- [ ] 編集後にFAQ一覧が更新される
- [ ] 埋め込みベクトルが自動再生成される（質問または回答が変更された場合）

**問題が発生した場合の確認方法**:
1. ブラウザの開発者ツールのコンソールタブでエラーメッセージを確認
2. ネットワークタブで `PUT /api/v1/admin/faqs/{faq_id}` リクエストを確認
3. エラーレスポンスの詳細を確認
4. データベースでFAQ IDが存在するか確認：
   ```bash
   docker-compose exec postgres psql -U yadopera_user -d yadopera -c "SELECT id, facility_id, question FROM faqs WHERE id = {faq_id};"
   ```

#### ステップ6: FAQ削除の動作確認（既知の問題あり）

1. FAQ一覧から任意のFAQを選択
2. 「削除」ボタンをクリック
3. 確認モーダルが表示されることを確認
4. 「はい」をクリック

**既知の問題**:
- ⚠️ 確認モーダルが2回表示される可能性がある
- ⚠️ 「FAQ not found: faq_id=2」というエラーが表示される可能性がある
- ⚠️ 削除が実行されない可能性がある

**確認項目**:
- [ ] 確認モーダルが1回だけ表示される（既知の問題が解決されている場合）
- [ ] 「はい」をクリックすると削除が実行される
- [ ] 削除後にFAQ一覧から該当FAQが消える
- [ ] 成功メッセージが表示される

**問題が発生した場合の確認方法**:
1. ブラウザの開発者ツールのコンソールタブでエラーメッセージを確認
2. ネットワークタブで `DELETE /api/v1/admin/faqs/{faq_id}` リクエストを確認
3. エラーレスポンスの詳細を確認
4. データベースでFAQ IDが存在するか確認（ステップ5と同様）

---

## 2. 施設設定画面（優先度: 高、実装完了済み）

### 2.1 テストの目的

施設設定画面のすべての機能が正常に動作することを確認する。特に、施設情報の編集、スタッフ不在時間帯の設定、パスワード変更の動作を確認する。

### 2.2 テスト手順

#### ステップ1: 施設設定画面へのアクセス

1. 管理画面にログイン
2. サイドバーまたはナビゲーションメニューから「施設設定」をクリック
3. 施設設定画面が表示されることを確認

**確認項目**:
- [ ] 施設設定画面が正常に表示される
- [ ] 基本情報セクションが表示される
- [ ] スタッフ不在時間帯設定セクションが表示される
- [ ] パスワード変更セクションが表示される

#### ステップ2: 基本情報の表示確認

1. 基本情報セクションが表示されることを確認
2. 以下の情報が表示されていることを確認：
   - 施設名
   - メールアドレス
   - 電話番号
   - 住所
   - WiFiパスワード
   - チェックイン時間
   - チェックアウト時間

**確認項目**:
- [ ] 基本情報が正常に表示される
- [ ] 各フィールドの値が正しく表示される

#### ステップ3: 基本情報の編集確認

1. 施設名を変更（例: "やどぺらゲストハウス" → "やどぺらゲストハウス（テスト）"）
2. 「保存」ボタンをクリック
3. ローディング表示が表示されることを確認
4. 成功メッセージが表示されることを確認
5. 変更が保存されることを確認（画面を再読み込みして確認）

**確認項目**:
- [ ] 基本情報を編集できる
- [ ] 「保存」ボタンをクリックするとローディング表示が表示される
- [ ] 成功メッセージが表示される
- [ ] 変更が保存される（画面を再読み込みして確認）

#### ステップ4: スタッフ不在時間帯設定の確認

1. スタッフ不在時間帯設定セクションが表示されることを確認
2. 既存の時間帯が表示されていることを確認（デフォルト: 22:00-8:00）
3. 「時間帯を追加」ボタンをクリック
4. 新しい時間帯を追加：
   - **開始時刻**: 12:00
   - **終了時刻**: 14:00
   - **曜日**: 月曜日〜金曜日
5. 「保存」ボタンをクリック
6. 成功メッセージが表示されることを確認
7. 追加した時間帯が表示されることを確認

**確認項目**:
- [ ] スタッフ不在時間帯設定セクションが正常に表示される
- [ ] 既存の時間帯が表示される
- [ ] 新しい時間帯を追加できる
- [ ] 時間帯を削除できる（削除ボタンがある場合）
- [ ] 変更が保存される

#### ステップ5: パスワード変更の確認

1. パスワード変更セクションが表示されることを確認
2. 以下の情報を入力：
   - **現在のパスワード**: `testpassword123`
   - **新しいパスワード**: `newpassword123`
   - **新しいパスワード（確認）**: `newpassword123`
3. 「パスワードを変更」ボタンをクリック
4. ローディング表示が表示されることを確認
5. 成功メッセージが表示されることを確認
6. ログアウトして、新しいパスワードでログインできることを確認

**確認項目**:
- [ ] パスワード変更セクションが正常に表示される
- [ ] パスワード変更フォームが正常に動作する
- [ ] パスワード変更が正常に実行される
- [ ] 新しいパスワードでログインできる

**注意**: パスワード変更後は、元のパスワードに戻すことを推奨します（テスト環境の場合）。

---

## 3. FAQ自動学習UI（優先度: 中、既知の問題あり）

### 3.1 テストの目的

FAQ自動学習UIのすべての機能が正常に動作することを確認する。特に、未解決質問リストの表示、FAQ追加ボタンの動作、回答テンプレート自動生成の動作を確認する。

### 3.2 テスト手順

#### ステップ1: 未解決質問リストの表示確認

1. FAQ管理画面にアクセス
2. 「未解決質問リスト」セクションが表示されることを確認
3. 未解決質問が表示されていることを確認（テストデータがある場合）

**確認項目**:
- [ ] 未解決質問リストセクションが正常に表示される
- [ ] 未解決質問が表示される（テストデータがある場合）
- [ ] 各質問に以下の情報が表示される：
   - 質問内容
   - 言語
   - 日時
   - 信頼度スコア
   - 「FAQ追加」ボタン

#### ステップ2: FAQ追加ボタンの動作確認（既知の問題あり）

1. 未解決質問リストから任意の質問を選択
2. 「FAQ追加」ボタンをクリック
3. FAQ追加提案カードが表示されることを確認
4. 以下の情報が自動入力されることを確認：
   - **質問文**: 未解決質問の内容が自動入力される
   - **回答文**: 回答テンプレートが自動生成される（GPT-4o miniを使用）
   - **カテゴリ**: カテゴリが自動推定される

**既知の問題**:
- ⚠️ FAQ提案の承認エラーが発生する可能性がある

**確認項目**:
- [ ] 「FAQ追加」ボタンをクリックするとFAQ追加提案カードが表示される
- [ ] 質問文が自動入力される
- [ ] 回答テンプレートが自動生成される（数秒かかる場合がある）
- [ ] カテゴリが自動推定される
- [ ] 「承認」ボタンをクリックするとFAQが追加される（既知の問題が解決されている場合）

**問題が発生した場合の確認方法**:
1. ブラウザの開発者ツールのコンソールタブでエラーメッセージを確認
2. ネットワークタブで `POST /api/v1/admin/faq-suggestions/{id}/approve` リクエストを確認
3. エラーレスポンスの詳細を確認
4. バックエンドのログを確認：
   ```bash
   docker-compose logs backend | grep -i "faq.*suggestion\|error"
   ```

#### ステップ3: 回答テンプレート自動生成の確認

1. ステップ2でFAQ追加提案カードが表示された状態で確認
2. 回答文フィールドに回答テンプレートが自動生成されることを確認
3. 回答テンプレートが適切な内容であることを確認（質問に関連した回答である）

**確認項目**:
- [ ] 回答テンプレートが自動生成される（数秒かかる場合がある）
- [ ] 回答テンプレートが適切な内容である（質問に関連した回答である）
- [ ] 回答テンプレートを編集できる

---

## 4. スタッフ不在時間帯対応キューUI（優先度: 中）

### 4.1 テストの目的

スタッフ不在時間帯対応キューUIのすべての機能が正常に動作することを確認する。特に、キュー一覧の表示、キュー解決処理の動作を確認する。

### 4.2 テスト手順

#### ステップ1: スタッフ不在時間帯対応キューUIへのアクセス

1. 管理画面にログイン
2. サイドバーまたはナビゲーションメニューから「スタッフ不在時間帯対応キュー」をクリック
3. スタッフ不在時間帯対応キューUIが表示されることを確認

**確認項目**:
- [ ] スタッフ不在時間帯対応キューUIが正常に表示される
- [ ] 説明文が表示される（スタッフ不在時間帯の説明）
- [ ] 統計情報が表示される（総数、未解決数、解決済み数）

#### ステップ2: キュー一覧の表示確認

1. キュー一覧が表示されることを確認
2. 各キューアイテムに以下の情報が表示されていることを確認：
   - 質問内容
   - 言語
   - 日時
   - 対応予定時刻（スタッフ不在時間帯の終了時刻）
   - 「対応済み」ボタン

**確認項目**:
- [ ] キュー一覧が正常に表示される
- [ ] 各キューアイテムの情報が正しく表示される
- [ ] 「対応済み」ボタンが表示される（未解決のキューアイテムの場合）

#### ステップ3: キュー解決処理の確認

1. 未解決のキューアイテムを選択
2. 「対応済み」ボタンをクリック
3. 確認モーダルが表示されることを確認（表示される場合）
4. 「はい」をクリック（確認モーダルが表示された場合）
5. ローディング表示が表示されることを確認
6. 成功メッセージが表示されることを確認
7. キュー一覧から該当キューアイテムが消える（または「対応済み」マークが表示される）ことを確認

**確認項目**:
- [ ] 「対応済み」ボタンをクリックするとキュー解決処理が実行される
- [ ] 成功メッセージが表示される
- [ ] キュー一覧が更新される（該当キューアイテムが「対応済み」になる、または消える）
- [ ] 統計情報が更新される（未解決数が減り、解決済み数が増える）

**注意**: テストデータがない場合、実際にスタッフ不在時間帯にエスカレーションが発生する必要があります。テストデータを作成するか、実際の時間帯でテストする必要があります。

---

## 5. QRコード生成UI（優先度: 中）

### 5.1 テストの目的

QRコード生成UIのすべての機能が正常に動作することを確認する。特に、QRコード生成、ダウンロード、セッション統合トークン埋め込みオプションの動作を確認する。

### 5.2 テスト手順

#### ステップ1: QRコード生成UIへのアクセス

1. 管理画面にログイン
2. サイドバーまたはナビゲーションメニューから「QRコード生成」をクリック
3. QRコード生成UIが表示されることを確認

**確認項目**:
- [ ] QRコード生成UIが正常に表示される
- [ ] QRコード生成フォームが表示される
- [ ] 生成済みQRコード一覧が表示される（既存のQRコードがある場合）

#### ステップ2: QRコード生成フォームの確認

1. QRコード生成フォームが表示されることを確認
2. 以下のオプションが表示されていることを確認：
   - **設置場所**: ドロップダウンメニュー（entrance, room, kitchen, lounge, custom）
   - **カスタム設置場所名**: テキスト入力（custom選択時）
   - **セッション統合トークン埋め込み**: チェックボックス
   - **形式**: ラジオボタン（PDF, PNG, SVG）

**確認項目**:
- [ ] QRコード生成フォームが正常に表示される
- [ ] 各オプションが正常に動作する
- [ ] カスタム設置場所名入力欄が表示される（custom選択時）

#### ステップ3: QRコード生成の確認（基本）

1. 設置場所を選択（例: "entrance"）
2. 形式を選択（例: "PDF"）
3. 「QRコード生成」ボタンをクリック
4. ローディング表示が表示されることを確認
5. 成功メッセージが表示されることを確認
6. 生成済みQRコード一覧に新規QRコードが追加されることを確認

**確認項目**:
- [ ] QRコード生成が正常に実行される
- [ ] ローディング表示が表示される
- [ ] 成功メッセージが表示される
- [ ] 生成済みQRコード一覧に新規QRコードが追加される

#### ステップ4: QRコードダウンロードの確認

1. 生成済みQRコード一覧から任意のQRコードを選択
2. 「ダウンロード」ボタン（または形式別のダウンロードボタン）をクリック
3. ファイルがダウンロードされることを確認
4. ダウンロードしたファイルを開いて、QRコードが正しく表示されることを確認

**確認項目**:
- [ ] ダウンロードボタンが正常に動作する
- [ ] ファイルがダウンロードされる
- [ ] ダウンロードしたファイルにQRコードが正しく表示される
- [ ] QRコードをスキャンすると正しいURLにアクセスできる

#### ステップ5: セッション統合トークン埋め込みオプションの確認

1. QRコード生成フォームで「セッション統合トークン埋め込み」にチェックを入れる
2. 設置場所を選択（例: "entrance"）
3. 形式を選択（例: "PDF"）
4. 「QRコード生成」ボタンをクリック
5. 生成済みQRコード一覧に新規QRコードが追加されることを確認
6. ダウンロードしたQRコードをスキャン
7. URLにセッション統合トークンが含まれていることを確認（例: `?token=AB12`）

**確認項目**:
- [ ] セッション統合トークン埋め込みオプションが正常に動作する
- [ ] 生成されたQRコードのURLにセッション統合トークンが含まれる
- [ ] QRコードをスキャンすると、セッション統合トークンが含まれたURLにアクセスできる

---

## 6. ゲストフィードバック統計（優先度: 低）

### 6.1 テストの目的

ゲストフィードバック統計のすべての機能が正常に動作することを確認する。特に、フィードバック集計の表示、低評価回答一覧の表示を確認する。

### 6.2 テスト手順

#### ステップ1: ゲストフィードバック統計へのアクセス

1. 管理画面にログイン
2. ダッシュボードにアクセス
3. 「ゲストフィードバック集計」セクションが表示されることを確認
4. または、専用ページがある場合、サイドバーまたはナビゲーションメニューから「ゲストフィードバック統計」をクリック

**確認項目**:
- [ ] ゲストフィードバック統計が正常に表示される
- [ ] フィードバック集計が表示される
- [ ] 低評価回答一覧が表示される

#### ステップ2: フィードバック集計の表示確認

1. フィードバック集計セクションが表示されることを確認
2. 以下の情報が表示されていることを確認：
   - **総フィードバック数**: 総数（👍 + 👎）
   - **肯定率**: 👍 / (👍 + 👎) × 100
   - **否定率**: 👎 / (👍 + 👎) × 100
   - **円グラフまたは棒グラフ**: フィードバックの分布

**確認項目**:
- [ ] フィードバック集計が正常に表示される
- [ ] 総フィードバック数が正しく表示される
- [ ] 肯定率と否定率が正しく計算されている
- [ ] グラフが正常に表示される（グラフがある場合）

#### ステップ3: 低評価回答一覧の表示確認

1. 低評価回答一覧セクションが表示されることを確認
2. 低評価回答（👎評価が2回以上ついた回答）が表示されることを確認
3. 各低評価回答に以下の情報が表示されていることを確認：
   - 質問内容
   - 回答内容
   - 低評価数（👎の数）
   - 「FAQ改善提案」ボタン（または「対応する」ボタン）

**確認項目**:
- [ ] 低評価回答一覧が正常に表示される
- [ ] 低評価回答が表示される（テストデータがある場合）
- [ ] 各低評価回答の情報が正しく表示される
- [ ] 「FAQ改善提案」ボタンが表示される

#### ステップ4: FAQ改善提案の確認（オプション）

1. 低評価回答一覧から任意の回答を選択
2. 「FAQ改善提案」ボタンをクリック
3. FAQ改善提案カードが表示されることを確認
4. 改善提案が自動生成されることを確認（GPT-4o miniを使用）

**確認項目**:
- [ ] 「FAQ改善提案」ボタンをクリックするとFAQ改善提案カードが表示される
- [ ] 改善提案が自動生成される（数秒かかる場合がある）
- [ ] 改善提案を承認してFAQを更新できる

---

## 7. テスト結果の記録

### 7.1 記録項目

各テスト項目について、以下の情報を記録してください：

- **実施日時**: テストを実施した日時
- **テスト結果**: ✅完了 / ❌未完了 / ⚠️問題あり
- **問題点**: 問題が発生した場合、詳細を記録
- **スクリーンショット**: 必要に応じてスクリーンショットを撮影

### 7.2 問題が発生した場合の対応

1. **問題の詳細を記録**
   - 問題の症状
   - 発生条件
   - エラーメッセージ（コンソール、ネットワークタブ）
   - スクリーンショット

2. **調査分析を実施**
   - ブラウザの開発者ツールでエラーを確認
   - ネットワークタブでAPIリクエスト/レスポンスを確認
   - バックエンドのログを確認

3. **修正を実施**（指示がある場合）
   - 問題の根本原因を特定
   - 修正を実施
   - 再テストを実施

---

**Document Version**: v1.0  
**Author**: Auto (AI Assistant)  
**Last Updated**: 2025-12-05  
**Status**: ✅ **詳細手順書作成完了**

