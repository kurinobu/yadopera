# Phase 1: 重要事項 施設設定画面 ステップ計画追加

**作成日**: 2025年12月5日  
**実施者**: Auto (AI Assistant)  
**対象**: 施設設定画面の作成とステップ計画への追加  
**状態**: ✅ **重要事項記録完了**

---

## 1. 重要事項

### 1.1 クリティカルな問題の発見

**問題**: 施設設定画面が存在しない

**影響**:
- 施設管理者が施設情報を編集できない
- 夜間時間帯（22:00-8:00）などの設定を変更できない
- 施設ごとに異なる設定を適用できない

### 1.2 ステップ10の現況記録と残存課題化

**ステップ10の現況**:
- 夜間対応キューセクションの「対応済み」ボタンの実装は部分的に完了
- しかし、夜間時間帯（22:00-8:00）がハードコードされている
- 施設設定画面がないため、施設管理者が設定を変更できない

**決定事項**:
- **ステップ10は現況を記録して残存課題とする**
- **ステップ11を先に実行**
- **施設設定画面を作成後に再度ステップ10を実装**

### 1.3 ステップ11の優先実行

**理由**:
- ステップ11（ログアウトボタンの修正）は独立した問題
- 施設設定画面の作成に依存しない
- 先に完了させることで、ユーザビリティを改善

---

## 2. 施設設定画面の作成計画

### 2.1 ステップ計画への追加

**新規ステップ**: **ステップ12: 施設設定画面の作成**

**目的**: 施設管理者が施設情報を編集できる画面を作成する

**所要時間**: 4-6時間

**前提条件**:
- ローカル環境が利用可能
- バックエンドAPIが正常に動作している

**大原則の適用**:
- **根本解決 > 暫定解決**: 施設設定画面を作成することで、施設管理者が設定を変更できるようにする
- **シンプル構造 > 複雑構造**: シンプルな施設設定画面を実装する
- **統一・同一化 > 特殊独自**: 既存のパターンに従い、統一された実装を維持する
- **具体的 > 一般**: 具体的な実装内容を明確にする
- **拙速 < 安全確実**: 十分な検証を行い、安全に実装する

**実施内容**:

1. **施設モデルの拡張**
   - 夜間時間帯の設定フィールドを追加（`overnight_start_time`, `overnight_end_time`）
   - または、「スタッフ不在時間帯」という括りで複数の時間帯を設定できるようにする

2. **バックエンドAPIの実装**
   - `GET /api/v1/admin/facility/settings`: 施設設定取得
   - `PUT /api/v1/admin/facility/settings`: 施設設定更新

3. **フロントエンド画面の作成**
   - `frontend/src/views/admin/FacilitySettings.vue`を作成
   - 施設情報編集フォーム
   - 夜間時間帯（またはスタッフ不在時間帯）の設定

4. **ルーティングの追加**
   - `/admin/facility/settings`にルーティングを追加

**確認項目**:
- [ ] 施設設定画面が正常に表示される
- [ ] 施設情報を編集できる
- [ ] 夜間時間帯（またはスタッフ不在時間帯）を設定できる
- [ ] 設定変更が正常に保存される
- [ ] ブラウザの開発者ツールでエラーがない

**成果物**:
- `frontend/src/views/admin/FacilitySettings.vue`
- `backend/app/api/v1/admin/facility.py`（新規作成または拡張）
- `backend/app/schemas/facility.py`（拡張）
- `docs/Phase1/Phase1_ステップ12_施設設定画面作成_完了レポート.md`

---

## 3. 「スタッフ不在時間帯」の検討

### 3.1 現状の問題

**現在の実装**:
- 「夜間（22:00-8:00）」という固定の時間帯
- ゲストハウスやホステルでは、夜間の対応スタッフが待機している施設もある
- 昼間においてもフロントが開いていない宿泊施設も多く、フロントには誰もいない時間帯がある

### 3.2 改善案

**案1: 「スタッフ不在時間帯」という括り**
- 「夜間」「昼間」と分けるのではなく、「スタッフ不在時間帯」という括りにする
- 複数の時間帯を設定できるようにする（例: 22:00-8:00、12:00-14:00）

**案2: 柔軟な時間帯設定**
- 施設ごとに異なる時間帯を設定できるようにする
- 複数の時間帯を設定できるようにする

### 3.3 システムの目的に立ち返った検討

**システムの目的**:
- 小規模宿泊施設向け外国人ゲスト対応自動化SaaS
- スタッフが不在の時間帯に、AIが自動応答する
- エスカレーションが必要な場合は、スタッフ不在時間帯は夜間対応キューに追加

**決定事項（2025-12-05）**:
- **「スタッフ不在時間帯」の検討→採用**

**採用案**:
- **「スタッフ不在時間帯」という括りにする**
- 複数の時間帯を設定できるようにする
- 施設ごとに異なる時間帯を設定できるようにする

---

## 4. 開発者が各施設のデータを確認できる管理画面について

### 4.1 調査結果

**現状**:
- 開発者が各施設のデータを確認できる管理画面が存在しない
- 施設一覧を表示する画面が存在しない
- 施設ごとのデータを確認する画面が存在しない

**アーキテクチャ設計書の確認**:
- `docs/Architecture/やどぺら_v0.3_アーキテクチャ設計書.md`に`/admin/facility`のルーティングが記載されている
- しかし、実際の実装は存在しない

### 4.2 作成計画

**フェーズ**: **Phase 2で実装**

**決定事項（2025-12-05）**:
- 開発者が各施設のデータを確認できる管理画面は**Phase 2で実装**

**理由**:
- Phase 1はMVP開発に集中
- 開発者向けの管理画面は優先度が低い
- Phase 2（PoC準備）で実装する予定

**実装内容**:
- 施設一覧画面
- 施設ごとのデータ確認画面
- 施設設定画面（ステップ12で実装予定）

---

## 5. ステップ10の再実装計画

### 5.1 ステップ10の現況記録

**完了項目**:
- ✅ バックエンドAPIの実装（`PUT /api/v1/admin/overnight-queue/{id}/resolve`）
- ✅ フロントエンドのAPI連携
- ✅ 夜間対応キュー専用ページでの「対応済み」ボタンの実装

**残存課題**:
- ⚠️ 夜間時間帯（22:00-8:00）がハードコードされている
- ⚠️ 施設設定画面がないため、施設管理者が設定を変更できない
- ⚠️ 「スタッフ不在時間帯」という柔軟な設定ができない

### 5.2 ステップ10の再実装

**実施タイミング**: ステップ12（施設設定画面の作成）完了後

**再実装内容**:
1. 施設設定から「スタッフ不在時間帯」を取得
2. ハードコードされた時間帯を、施設設定から取得するように変更
3. 複数の時間帯に対応できるように修正

---

## 6. ステップ計画の更新

### 6.1 更新後のステップ計画

1. ✅ ステップ0-6: 完了
2. ✅ ステップ9: 完了
3. **ステップ11: ヘッダーの「ログアウト」ボタンの修正**（最優先、30分-1時間）← **次に実行**
4. **ステップ12: 施設設定画面の作成**（4-6時間）← **新規追加**
5. **ステップ10: 夜間対応キューセクションの「対応済み」ボタンの再実装**（1-2時間）← **ステップ12完了後に再実装**
6. ステップ7: 管理画面のブラウザテストでの動作確認完了（1-2時間）
7. ステップ8: ステージング環境でのテスト予定項目の確認（1-2時間）

---

**Document Version**: v1.0  
**Author**: Auto (AI Assistant)  
**Last Updated**: 2025-12-05  
**Status**: ✅ **重要事項記録完了**

**重要**: このドキュメントは、今後のすべての作業で参照し、ステップ計画を更新する必要があります。

