# Phase 1 Week 2 ステップ計画

**作成日**: 2025年11月27日  
**フェーズ**: Phase 1 Week 2（AI対話エンジン）  
**期間**: 1週間  
**目的**: MVP開発のためのAI対話エンジン構築（RAG統合型）

---

## Week 2 目標

AI対話エンジンを構築し、以下の機能を実装する：

1. OpenAI API 統合（GPT-4o mini、text-embedding-3-small）
2. RAG実装（pgvectorによる類似FAQ検索）
3. 信頼度スコア改善版実装（v0.3新規要素含む）
4. 安全カテゴリ強制エスカレーション実装
5. 夜間対応キュー実装
6. フォールバック文言実装

---

## 前提条件

### Phase 1 Week 1完了確認

- [x] FastAPI プロジェクト構造完成
- [x] PostgreSQL 接続（pgvector拡張対応）済み
- [x] Redis環境構築済み
- [x] JWT認証システム実装済み
- [x] 基本テーブル実装済み（users, facilities, conversations, messages, session_tokens）
- [x] セッション統合トークンAPI実装済み

### 必要な環境変数

`backend/.env`に以下が設定されていること：
- `DATABASE_URL`: PostgreSQL接続URL
- `REDIS_URL`: Redis接続URL
- `OPENAI_API_KEY`: OpenAI APIキー（必須）
- `SECRET_KEY`: JWT署名用シークレットキー

### 必要なデータベーステーブル（Week 2で追加）

- `faqs`: FAQテーブル（埋め込みベクトル含む）
- `escalations`: エスカレーションテーブル
- `escalation_schedules`: エスカレーションスケジュールテーブル
- `overnight_queue`: 夜間対応キューテーブル
- `question_patterns`: 質問パターン解決率テーブル（信頼度スコア計算用）
- `guest_feedback`: ゲストフィードバックテーブル（Week 3で使用、Week 2で準備）

---

## ステップ詳細

### ステップ1: データベースモデル追加（4時間）

**目的**: Week 2で必要なテーブルのモデル定義を追加

**実装内容**:
1. `backend/app/models/faq.py`作成
   - FAQモデル定義
   - `embedding`フィールド（vector(1536)型）
   - リレーションシップ定義

2. `backend/app/models/escalation.py`作成
   - エスカレーションモデル定義
   - リレーションシップ定義

3. `backend/app/models/escalation_schedule.py`作成
   - エスカレーションスケジュールモデル定義
   - リレーションシップ定義

4. `backend/app/models/overnight_queue.py`作成
   - 夜間対応キューモデル定義
   - リレーションシップ定義

5. `backend/app/models/question_pattern.py`作成
   - 質問パターン解決率モデル定義
   - `pattern_embedding`フィールド（vector(1536)型）
   - リレーションシップ定義

6. `backend/app/models/guest_feedback.py`作成
   - ゲストフィードバックモデル定義
   - リレーションシップ定義

7. `backend/app/models/__init__.py`更新
   - 新規モデルをエクスポート

**確認項目**:
- [ ] 各モデルが正しく定義されている
- [ ] pgvector型（vector(1536)）が正しく使用されている
- [ ] リレーションシップが正しく設定されている
- [ ] インデックス定義が適切である

**参考**: アーキテクチャ設計書 7.2 テーブル定義詳細

---

### ステップ2: Alembicマイグレーション作成（3時間）

**目的**: Week 2で必要なテーブルをマイグレーションで作成

**実装内容**:
1. マイグレーションファイル作成:
   - `backend/alembic/versions/003_add_week2_tables.py`
     - faqs, escalations, escalation_schedules, overnight_queue, question_patterns, guest_feedbackテーブル作成
     - インデックス作成（pgvectorインデックス含む）
     - 外部キー制約設定

2. マイグレーション実行:
   ```bash
   cd backend
   alembic upgrade head
   ```

3. マイグレーション確認:
   ```bash
   alembic current
   alembic history
   ```

**確認項目**:
- [ ] マイグレーションが正常に実行される
- [ ] テーブルが正しく作成される
- [ ] pgvectorインデックスが正しく作成される
- [ ] 外部キー制約が正しく設定される

**参考**: アーキテクチャ設計書 7.4 マイグレーション管理

---

### ステップ3: Pydanticスキーマ追加（2時間）

**目的**: Week 2で必要なAPIリクエスト・レスポンススキーマを追加

**実装内容**:
1. `backend/app/schemas/chat.py`更新
   - `ChatMessageRequest`: チャットメッセージ送信リクエスト
   - `ChatMessageResponse`: チャットメッセージレスポンス
   - `ChatHistoryResponse`: 会話履歴レスポンス
   - `FeedbackRequest`: フィードバック送信リクエスト

2. `backend/app/schemas/escalation.py`作成
   - エスカレーション関連スキーマ

3. `backend/app/schemas/overnight_queue.py`作成
   - 夜間対応キュー関連スキーマ

**確認項目**:
- [ ] 各スキーマが正しく定義されている
- [ ] バリデーションルールが適切である
- [ ] レスポンス形式が設計書と一致している

**参考**: アーキテクチャ設計書 8.3 APIリクエスト・レスポンス詳細

---

### ステップ4: OpenAI API クライアント実装（3時間）

**目的**: OpenAI API（GPT-4o mini、text-embedding-3-small）への接続を実装

**実装内容**:
1. `backend/app/ai/__init__.py`作成
2. `backend/app/ai/openai_client.py`作成
   - OpenAIクライアント初期化
   - `generate_response()`: GPT-4o miniで回答生成
   - `generate_embedding()`: text-embedding-3-smallで埋め込み生成
   - エラーハンドリング（タイムアウト、レート制限、API障害）

3. `backend/app/core/config.py`更新
   - `OPENAI_API_KEY`設定確認

**確認項目**:
- [ ] OpenAI API接続が正常に動作する
- [ ] GPT-4o miniで回答生成が正常に動作する
- [ ] text-embedding-3-smallで埋め込み生成が正常に動作する
- [ ] エラーハンドリングが適切に実装されている

**参考**: アーキテクチャ設計書 11.2 実装コード（RAG統合型）

---

### ステップ5: 埋め込みベクトル生成実装（2時間）

**目的**: テキストを埋め込みベクトルに変換する機能を実装

**実装内容**:
1. `backend/app/ai/embeddings.py`作成
   - `generate_embedding()`: テキストを埋め込みベクトルに変換
   - `generate_faq_embedding()`: FAQの埋め込みベクトル生成（保存時自動実行）
   - エラーハンドリング

**確認項目**:
- [ ] 埋め込みベクトル生成が正常に動作する
- [ ] 出力が1536次元ベクトルである
- [ ] エラーハンドリングが適切に実装されている

**参考**: アーキテクチャ設計書 11.2 実装コード（埋め込みベクトル生成）

---

### ステップ6: pgvector検索実装（3時間）

**目的**: pgvectorによる類似FAQ検索機能を実装

**実装内容**:
1. `backend/app/ai/vector_search.py`作成
   - `search_similar_faqs()`: 類似FAQ検索（コサイン類似度）
   - `search_similar_patterns()`: 類似質問パターン検索（信頼度スコア計算用）
   - IVFFlatインデックス使用
   - 類似度スコア取得

**確認項目**:
- [ ] 類似FAQ検索が正常に動作する
- [ ] コサイン類似度計算が正しい
- [ ] Top 3 FAQ取得が正しく動作する
- [ ] 類似質問パターン検索が正常に動作する

**参考**: アーキテクチャ設計書 11.2 実装コード（pgvector検索）

---

### ステップ7: 安全カテゴリ判定実装（2時間）

**目的**: 医療・安全関連キーワード検出による強制エスカレーション機能を実装

**実装内容**:
1. `backend/app/ai/safety_check.py`作成
   - `MEDICAL_KEYWORDS`: 医療関連キーワードリスト
   - `SAFETY_KEYWORDS`: 安全・避難関連キーワードリスト
   - `check_safety_category()`: 安全カテゴリ判定関数
   - 多言語対応（英語・日本語）

**確認項目**:
- [ ] 医療関連キーワード検出が正常に動作する
- [ ] 安全・避難関連キーワード検出が正常に動作する
- [ ] 多言語対応が正しく動作する
- [ ] 大文字小文字を区別しない検出が動作する

**参考**: アーキテクチャ設計書 11.2 実装コード（安全カテゴリ判定）

---

### ステップ8: 信頼度スコア計算実装（4時間）

**目的**: v0.3改善版の信頼度スコア計算機能を実装

**実装内容**:
1. `backend/app/ai/confidence.py`作成
   - `calculate_confidence()`: 信頼度スコア計算（v0.3改善版）
   - ベーススコア: 0.7
   - FAQ類似度ボーナス（0.8以上: +0.3、0.7以上: +0.15）
   - 回答長ペナルティ（20文字未満: -0.2）
   - 不確実性ワード検出（maybe等: -0.15）
   - **質問具体性スコア（固有名詞・数値: +0.1）★新規**
   - **過去同一質問解決率（80%以上: +0.15）★新規**
   - **施設カスタムFAQヒット（+0.2）★新規**
   - 0.0-1.0の範囲にクリップ

**確認項目**:
- [ ] 信頼度スコア計算が正常に動作する
- [ ] 各ボーナス・ペナルティが正しく適用される
- [ ] 過去解決率取得が正常に動作する
- [ ] スコアが0.0-1.0の範囲にクリップされる

**参考**: アーキテクチャ設計書 11.2 実装コード（信頼度スコア計算）

---

### ステップ9: コンテキスト構築実装（2時間）

**目的**: RAG統合型のコンテキスト構築機能を実装

**実装内容**:
1. `backend/app/ai/prompts.py`作成
   - `RAG_SYSTEM_PROMPT`: RAG統合型システムプロンプト
   - `build_rag_prompt()`: RAG統合型プロンプト生成
   - コンテキスト構築（約600トークン）
     - 関連FAQ Top 3: 約300トークン
     - 施設基本情報: 約150トークン
     - システムプロンプト: 約100トークン
     - ゲスト質問: 約50トークン

**確認項目**:
- [ ] コンテキスト構築が正常に動作する
- [ ] プロンプト形式が設計書と一致している
- [ ] トークン数が適切である（約600トークン）

**参考**: アーキテクチャ設計書 11.2 実装コード（コンテキスト構築）、11.3 プロンプトテンプレート

---

### ステップ10: RAG統合型AI対話エンジン実装（5時間）

**目的**: RAG統合型のAI対話エンジンを実装

**実装内容**:
1. `backend/app/ai/engine.py`作成
   - `RAGChatEngine`クラス実装
   - `process_message()`: RAG統合型メッセージ処理
     - Step 0: 安全カテゴリ判定★新規
     - Step 1: 埋め込みベクトル生成
     - Step 2: pgvector検索（Top 3 FAQ取得）
     - Step 3: コンテキスト構築
     - Step 4: GPT-4o-mini回答生成
     - Step 5: 信頼度スコア計算
     - Step 6: エスカレーション判定
   - レスポンス時間計測
   - メッセージ保存

**確認項目**:
- [ ] RAG統合型処理フローが正常に動作する
- [ ] 各ステップが正しく実行される
- [ ] レスポンス時間が適切である（目標: 3秒以内）
- [ ] メッセージ保存が正常に動作する

**参考**: アーキテクチャ設計書 11.1 RAG統合型処理フロー、11.2 実装コード（メインエンジン）

---

### ステップ11: エスカレーション判定・管理実装（4時間）

**目的**: エスカレーション判定・管理機能を実装

**実装内容**:
1. `backend/app/services/escalation_service.py`作成
   - `EscalationService`クラス実装
   - `check_escalation_needed()`: エスカレーション必要か判定
     - 現在時刻・曜日取得
     - エスカレーションスケジュール検索
     - 閾値判定（通常0.7 / 早期0.85）
     - 緊急キーワード検出
     - **安全カテゴリは即エスカレ★新規**
     - 3往復以上未解決チェック
   - `create_escalation()`: エスカレーション記録作成
   - `get_escalation_schedule()`: エスカレーションスケジュール取得

2. `backend/app/models/escalation_schedule.py`確認
   - エスカレーションスケジュールモデル確認

**確認項目**:
- [ ] エスカレーション判定が正常に動作する
- [ ] スケジュール連動判定が正しく動作する
- [ ] 安全カテゴリの即エスカレーションが動作する
- [ ] エスカレーション記録作成が正常に動作する

**参考**: アーキテクチャ設計書 12. エスカレーション管理

---

### ステップ12: 夜間対応キュー実装（4時間）

**目的**: 夜間対応キュー機能を実装

**実装内容**:
1. `backend/app/services/overnight_queue_service.py`作成
   - `OvernightQueueService`クラス実装
   - `add_to_overnight_queue()`: 夜間対応キューに追加
     - 施設のタイムゾーン取得
     - 翌朝8:00計算（施設のタイムゾーン基準）
   - `send_overnight_auto_reply()`: 夜間自動返信メッセージ送信
     - 英語/日本語対応
     - 緊急時119/110案内
   - `process_scheduled_notifications()`: 翌朝8:00の一括通知処理
     - MVP期間中: 手動実行ボタンまたは外部cron対応

2. `backend/app/api/v1/overnight_queue.py`作成（オプション、Week 3で実装予定）
   - 夜間対応キュー管理API

**確認項目**:
- [ ] 夜間対応キュー追加が正常に動作する
- [ ] タイムゾーン処理が正しく動作する
- [ ] 自動返信メッセージ送信が正常に動作する
- [ ] 翌朝8:00計算が正しい

**参考**: アーキテクチャ設計書 12.6 夜間対応キュー処理

---

### ステップ13: フォールバック文言実装（2時間）

**目的**: OpenAI API障害時のフォールバック文言を実装

**実装内容**:
1. `backend/app/ai/fallback.py`作成
   - `get_fallback_message()`: フォールバック文言取得
   - 多言語対応（英語・日本語）
   - 宿側ログ記録

2. `backend/app/ai/engine.py`更新
   - OpenAI API障害時のフォールバック処理追加
   - エラーログ記録

**確認項目**:
- [ ] フォールバック文言が正しく返される
- [ ] 多言語対応が正しく動作する
- [ ] エラーログが適切に記録される

**参考**: 要約定義書 3.1 ゲスト側機能（OpenAI API障害時フォールバック）

---

### ステップ14: チャットサービス実装（3時間）

**目的**: チャットメッセージ処理のビジネスロジックを実装

**実装内容**:
1. `backend/app/services/chat_service.py`作成
   - `ChatService`クラス実装
   - `process_chat_message()`: チャットメッセージ処理
     - セッション管理
     - RAG統合型AI対話エンジン呼び出し
     - エスカレーション処理
     - 夜間対応キュー処理
     - メッセージ保存
   - `get_conversation_history()`: 会話履歴取得

2. `backend/app/services/question_pattern_service.py`作成（オプション）
   - 質問パターン記録・更新
   - 解決率計算

**確認項目**:
- [ ] チャットメッセージ処理が正常に動作する
- [ ] セッション管理が正しく動作する
- [ ] エスカレーション処理が正常に動作する
- [ ] 会話履歴取得が正常に動作する

**参考**: アーキテクチャ設計書 11. AI対話エンジン設計

---

### ステップ15: チャットAPI実装（3時間）

**目的**: チャットメッセージ送信・会話履歴取得APIを実装

**実装内容**:
1. `backend/app/api/v1/chat.py`作成
   - `POST /api/v1/chat`: チャットメッセージ送信
     - リクエストバリデーション
     - セッション管理
     - ChatService呼び出し
     - レスポンス返却
   - `GET /api/v1/chat/history/{session_id}`: 会話履歴取得
     - セッションID検証
     - 会話履歴取得
     - レスポンス返却

2. `backend/app/api/v1/router.py`更新
   - チャットルーター登録

3. `backend/app/main.py`更新
   - チャットルーター登録確認

**確認項目**:
- [ ] チャットメッセージ送信APIが正常に動作する
- [ ] 会話履歴取得APIが正常に動作する
- [ ] エラーハンドリングが適切に実装されている
- [ ] Swagger UIでAPI仕様が確認できる

**参考**: アーキテクチャ設計書 8.2 RESTful API エンドポイント一覧、8.3 APIリクエスト・レスポンス詳細

---

### ステップ16: エラーハンドリング・例外処理拡張（2時間）

**目的**: Week 2で追加するエラーパターンの例外処理を実装

**実装内容**:
1. `backend/app/core/exceptions.py`更新
   - OpenAI API関連例外追加
   - Vector Search関連例外追加
   - エスカレーション関連例外追加

2. `backend/app/main.py`更新
   - 新規例外のハンドラー登録

**確認項目**:
- [ ] 新規例外が適切に処理される
- [ ] エラーレスポンス形式が統一されている
- [ ] 適切なHTTPステータスコードが返される

**参考**: アーキテクチャ設計書 13. エラーハンドリング

---

### ステップ17: API統合・動作確認（3時間）

**目的**: 実装したAPIを統合し、動作確認を行う

**実装内容**:
1. `backend/app/api/v1/router.py`更新
   - 全APIルーターを統合

2. `backend/app/main.py`更新
   - APIルーター登録確認
   - Swagger UI確認

3. 動作確認:
   - 各エンドポイントの動作確認
   - Swagger UIでのAPI仕様確認
   - エラーハンドリング確認
   - RAG統合型処理フロー確認
   - エスカレーション処理確認
   - 夜間対応キュー処理確認

**確認項目**:
- [ ] 全APIエンドポイントが正常に動作する
- [ ] Swagger UIが正しく表示される
- [ ] API仕様が正しく表示される
- [ ] RAG統合型処理フローが正常に動作する
- [ ] エスカレーション処理が正常に動作する
- [ ] 夜間対応キュー処理が正常に動作する

**参考**: アーキテクチャ設計書 3.1 APIルーター構造

---

### ステップ18: テストコード作成（⚠️ 実質的に必須、Phase 1 Week 4で実施）（8-12時間）

**目的**: 基本的なテストコードを作成し、品質を担保

**⚠️ 重要**: このステップは「オプション」と記載されているが、**実質的に必須**です。テスト未実施により、後で動かない場合の原因特定に大量の時間を費やすリスクが高く、MVP的にもテストを後回しにするのは愚の骨頂です。

**実施時期**: Phase 1 Week 4（推奨）または Week 3中に並行実施

**実装内容**:
1. `backend/tests/test_ai_engine.py`作成
   - RAG統合型AI対話エンジンテスト
   - 埋め込みベクトル生成テスト
   - pgvector検索テスト
   - 信頼度スコア計算テスト

2. `backend/tests/test_embeddings.py`作成
   - 埋め込みベクトル生成テスト
   - FAQ埋め込み生成テスト

3. `backend/tests/test_vector_search.py`作成
   - pgvector検索テスト
   - 類似FAQ検索テスト
   - 類似パターン検索テスト

4. `backend/tests/test_confidence.py`作成
   - 信頼度スコア計算テスト
   - v0.3改善版の全要素テスト

5. `backend/tests/test_safety_check.py`作成
   - 安全カテゴリ判定テスト
   - 医療・安全キーワード検出テスト

6. `backend/tests/test_chat.py`作成
   - チャットメッセージ送信テスト
   - 会話履歴取得テスト

7. `backend/tests/test_chat_service.py`作成
   - チャットサービス統合テスト
   - セッション管理テスト
   - エスカレーション処理テスト
   - 夜間対応キュー処理テスト

8. `backend/tests/test_escalation.py`作成
   - エスカレーション判定テスト
   - エスカレーションスケジュール連動テスト
   - タイムゾーン処理テスト

9. `backend/tests/test_overnight_queue.py`作成
   - 夜間対応キュー処理テスト
   - タイムゾーン基準の翌朝8:00計算テスト

10. `backend/tests/test_chat_api.py`作成
    - チャットAPIエンドポイントテスト
    - 会話履歴取得APIテスト

**確認項目**:
- [ ] テストが正常に実行される
- [ ] テストカバレッジが適切である（最低60%以上）
- [ ] 全テストが通過する
- [ ] エッジケースもテストされている

**⚠️ 実施必須**: Phase 1 Week 4で必ず実施すること。Week 3中に並行実施することも可能。

---

## 実装順序の推奨

1. **ステップ1**: データベースモデル追加（基盤）
2. **ステップ2**: Alembicマイグレーション作成（データベーススキーマ）
3. **ステップ3**: Pydanticスキーマ追加（API仕様）
4. **ステップ4**: OpenAI API クライアント実装（外部API接続）
5. **ステップ5**: 埋め込みベクトル生成実装（RAG基盤）
6. **ステップ6**: pgvector検索実装（RAG基盤）
7. **ステップ7**: 安全カテゴリ判定実装（エスカレーション基盤）
8. **ステップ8**: 信頼度スコア計算実装（エスカレーション基盤）
9. **ステップ9**: コンテキスト構築実装（RAG統合）
10. **ステップ10**: RAG統合型AI対話エンジン実装（コア機能）
11. **ステップ11**: エスカレーション判定・管理実装（エスカレーション機能）
12. **ステップ12**: 夜間対応キュー実装（夜間対応機能）
13. **ステップ13**: フォールバック文言実装（エラーハンドリング）
14. **ステップ14**: チャットサービス実装（ビジネスロジック）
15. **ステップ15**: チャットAPI実装（APIエンドポイント）
16. **ステップ16**: エラーハンドリング・例外処理拡張（品質向上）
17. **ステップ17**: API統合・動作確認（統合テスト）
18. **ステップ18**: テストコード作成（オプション）

---

## 各ステップの工数見積もり

| ステップ | 工数 | 累計工数 |
|---------|------|---------|
| ステップ1: データベースモデル追加 | 4時間 | 4時間 |
| ステップ2: Alembicマイグレーション作成 | 3時間 | 7時間 |
| ステップ3: Pydanticスキーマ追加 | 2時間 | 9時間 |
| ステップ4: OpenAI API クライアント実装 | 3時間 | 12時間 |
| ステップ5: 埋め込みベクトル生成実装 | 2時間 | 14時間 |
| ステップ6: pgvector検索実装 | 3時間 | 17時間 |
| ステップ7: 安全カテゴリ判定実装 | 2時間 | 19時間 |
| ステップ8: 信頼度スコア計算実装 | 4時間 | 23時間 |
| ステップ9: コンテキスト構築実装 | 2時間 | 25時間 |
| ステップ10: RAG統合型AI対話エンジン実装 | 5時間 | 30時間 |
| ステップ11: エスカレーション判定・管理実装 | 4時間 | 34時間 |
| ステップ12: 夜間対応キュー実装 | 4時間 | 38時間 |
| ステップ13: フォールバック文言実装 | 2時間 | 40時間 |
| ステップ14: チャットサービス実装 | 3時間 | 43時間 |
| ステップ15: チャットAPI実装 | 3時間 | 46時間 |
| ステップ16: エラーハンドリング・例外処理拡張 | 2時間 | 48時間 |
| ステップ17: API統合・動作確認 | 3時間 | 51時間 |
| ステップ18: テストコード作成（オプション） | 4時間 | 55時間 |

**合計**: 約48-55時間（1週間で実装可能、テストコードはオプション）

---

## 実装時の注意事項

### 1. 非同期処理
- SQLAlchemy 2.0+ のasync構文を使用
- `async def`、`await`を適切に使用
- データベース接続は非同期で管理

### 2. pgvector対応
- `vector(1536)`型を正しく使用
- インデックス作成時に`ivfflat`を使用
- コサイン類似度計算を正しく実装

### 3. OpenAI API
- エラーハンドリング（タイムアウト、レート制限、API障害）
- フォールバック文言実装
- コスト最適化（RAG統合による48%削減）

### 4. 安全カテゴリ判定
- 医療・安全関連キーワードは即エスカレーション（閾値無視）
- 多言語対応（英語・日本語）
- 大文字小文字を区別しない検出

### 5. 信頼度スコア計算
- v0.3改善版の新規要素を実装
- 過去解決率取得（pgvector検索使用）
- 施設カスタムFAQヒット判定
- 0.0-1.0の範囲にクリップ

### 6. 夜間対応キュー
- 施設のタイムゾーン基準で時刻判定
- UTC保存・ローカル表示
- MVP期間中は手動実行ボタンまたは外部cron対応

### 7. エラーハンドリング
- 統一されたエラーレスポンス形式
- 適切なHTTPステータスコード
- OpenAI API障害時のフォールバック

---

## 完了基準

Week 2完了の基準：

- [ ] データベースモデルが正しく追加されている
- [ ] マイグレーションが正常に実行される
- [ ] OpenAI API接続が正常に動作する
- [ ] 埋め込みベクトル生成が正常に動作する
- [ ] pgvector検索が正常に動作する
- [ ] 安全カテゴリ判定が正常に動作する
- [ ] 信頼度スコア計算が正常に動作する
- [ ] RAG統合型AI対話エンジンが正常に動作する
- [ ] エスカレーション判定・管理が正常に動作する
- [ ] 夜間対応キューが正常に動作する
- [ ] フォールバック文言が正しく実装されている
- [ ] チャットAPIが正常に動作する
- [ ] Swagger UIでAPI仕様が確認できる
- [ ] エラーハンドリングが適切に実装されている

---

## 次のステップ（Week 3）

Week 2完了後、Week 3（フロントエンド）に進む：

- Vue.js プロジェクト初期化
- ゲスト側UI（PWA、ダークモード）
- ゲストフィードバックUI（👍👎）
- セッション統合トークン表示・入力UI
- 管理画面（ダッシュボード）
- FAQ自動学習UI（ワンクリック追加）
- 夜間対応キューUI

---

## 参考資料

### 主要ドキュメント
- **要約定義書**: `docs/Summary/yadopera-v03-summary.md`
- **アーキテクチャ設計書**: `docs/Architecture/やどぺら_v0.3_アーキテクチャ設計書.md`
- **Phase 0引き継ぎ書**: `docs/Phase0_引き継ぎ書.md`
- **Phase 1 Week 1ステップ計画**: `docs/Phase1/Phase1_Week1_ステップ計画.md`

### 実装参考セクション
- アーキテクチャ設計書 11. AI対話エンジン設計（RAG統合型）
- アーキテクチャ設計書 12. エスカレーション管理
- アーキテクチャ設計書 7.2 テーブル定義詳細
- アーキテクチャ設計書 8.2 RESTful API エンドポイント一覧
- アーキテクチャ設計書 8.3 APIリクエスト・レスポンス詳細

---

**Document Version**: v1.0  
**Author**: Air  
**Last Updated**: 2025-11-27  
**Status**: Phase 1 Week 2 ステップ計画完了

