# ポート4173削除 事前調査・安全確認レポート

**作成日時**: 2025年12月20日 13時27分59秒  
**目的**: ポート4173の削除による影響を事前調査し、安全性を確認  
**状態**: ✅ **安全確認完了 - 削除可能**

---

## 1. 調査結果サマリー

### 1.1 ポート4173の現在の使用状況

**結論**: **現在は使用されていない**

- **docker-compose.yml**: ポートマッピングは設定されているが、実際にはサービスが起動していない
- **フロントエンドコンテナ**: `npm run dev`のみ実行（ポート5173のみ使用）
- **プレビューサーバー**: 起動していない（`npm run preview`は実行されていない）
- **接続エラー**: `ERR_CONNECTION_RESET`が発生（サービスが存在しないため）

### 1.2 ポート4173の過去の使用履歴

**過去の用途**: プレビューサーバー（`npm run preview`）として使用されていた

- **使用時期**: Phase 1開発期間中（2025年12月）
- **目的**: ビルド済みファイル（`dist/`）の動作確認
- **起動方法**: 手動で`docker-compose exec frontend npm run preview -- --host 0.0.0.0 --port 4173`を実行
- **現在の状況**: 開発サーバー（5173）で十分なため、使用されていない

---

## 2. ポート4173への参照箇所

### 2.1 設定ファイル

1. **docker-compose.yml**:
   - ポートマッピング: `"4173:4173"`（66行目）
   - CORS設定: `CORS_ORIGINS=http://localhost:5173,http://localhost:3000,http://localhost:4173`（45行目）

2. **backend/app/core/config.py**:
   - デフォルト値: `cors_origins: str = "http://localhost:5173,http://localhost:3000"`（4173は含まれていない）
   - **注意**: 環境変数で上書きされる可能性あり

3. **backend/.env.example**:
   - `CORS_ORIGINS=http://localhost:5173,http://localhost:3000`（4173は含まれていない）

### 2.2 過去の文書（記録として残す）

- 多数の文書でポート4173が言及されているが、これらは過去の記録として残す
- 削除対象ではない

### 2.3 フロントエンドコード

- **vite.config.ts**: ポート4173への参照なし（ポート5173のみ設定）
- **package.json**: `"preview": "vite preview"`スクリプトは存在するが、ポート指定なし
- **Dockerfile**: ポート4173への参照なし

---

## 3. 削除による影響分析

### 3.1 機能への影響

| 項目 | 影響 | 理由 |
|------|------|------|
| 開発サーバー（5173） | **影響なし** | 独立して動作 |
| バックエンドAPI | **影響なし** | ポート4173とは無関係 |
| フロントエンド機能 | **影響なし** | ポート4173を使用していない |
| ビルドプロセス | **影響なし** | ビルドは`npm run build`で実行 |
| テスト実行 | **影響なし** | テストは5173で実行 |

### 3.2 環境への影響

| 環境 | 影響 | 理由 |
|------|------|------|
| ローカル開発環境 | **影響なし** | 開発サーバー（5173）で十分 |
| ステージング環境 | **影響なし** | render.yamlにポート4173の設定なし |
| 本番環境 | **影響なし** | 本番環境では使用されていない |

### 3.3 CORS設定への影響

**現在の状況**:
- `docker-compose.yml`の`CORS_ORIGINS`に`http://localhost:4173`が含まれている
- しかし、実際にはポート4173からAPIリクエストは発生していない

**削除後の影響**:
- ポート4173が削除されても、CORS設定から削除することで整合性が保たれる
- 開発サーバー（5173）からのリクエストは引き続き許可される

---

## 4. 安全性確認

### 4.1 競合・干渉の確認

✅ **他の機能への競合なし**:
- ポート4173は独立したポートで、他のサービスと競合しない
- 削除しても他の機能に影響しない

✅ **UIへの干渉なし**:
- フロントエンドコードにポート4173への参照なし
- UIコンポーネントへの影響なし

✅ **APIへの干渉なし**:
- バックエンドAPIはポート8000で動作
- ポート4173とは無関係

### 4.2 削除の安全性

✅ **削除可能**: 
- 現在使用されていない
- 削除しても機能に影響しない
- 開発サーバー（5173）で十分

---

## 5. 削除対象ファイル・設定

### 5.1 削除対象

1. **docker-compose.yml**:
   - ポートマッピング: `"4173:4173"`を削除（66行目）
   - CORS設定: `http://localhost:4173`を削除（45行目）

### 5.2 削除しないもの

1. **過去の文書**: 記録として残す（削除しない）
2. **package.jsonの`preview`スクリプト**: 将来使用する可能性があるため残す
3. **vite.config.ts**: 変更不要（ポート4173への参照なし）

---

## 6. 削除後の確認項目

削除後、以下を確認する：

1. ✅ 開発サーバー（5173）が正常に動作する
2. ✅ バックエンドAPI（8000）が正常に動作する
3. ✅ CORSエラーが発生しない（5173からのリクエスト）
4. ✅ ビルドが正常に実行できる
5. ✅ テストが正常に実行できる

---

## 7. 結論

**ポート4173は削除可能**

- ✅ 現在使用されていない
- ✅ 削除しても他の機能に影響しない
- ✅ 開発サーバー（5173）で十分
- ✅ ステージング/本番環境では使用されていない

**削除対象**:
- `docker-compose.yml`のポートマッピング（66行目）
- `docker-compose.yml`のCORS設定から`http://localhost:4173`（45行目）

**記録として残す**:
- 過去の文書（削除しない）

---

**Document Version**: v1.0  
**Author**: AI Assistant  
**Status**: ✅ **安全確認完了 - 削除準備完了**
