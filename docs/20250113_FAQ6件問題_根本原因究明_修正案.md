# FAQ6件問題 - 根本原因究明と修正案

## 1. 問題の概要

### 1.1 報告された問題
- **現象**: 合計6件しか表示されていない
- **期待値**: 20件表示されるべき
- **データベース**: 20件のFAQが正しく登録されている（確認済み）
- **APIレスポンス**: 20件を正しく返している（確認済み）

### 1.2 調査結果の要約

**バックエンドの処理**:
- ✅ データベース: 20件のFAQが正しく登録されている
  - basic: 8件
  - facilities: 5件
  - location: 1件
  - trouble: 6件
- ✅ APIレスポンス: 20件を正しく返している
  - パターン1（カテゴリなし、is_activeなし）: 20件
  - パターン2（is_active=True）: 20件

**問題の所在**:
- バックエンドの処理は正しく動作している
- データベースには20件登録されている
- APIレスポンスは20件を返している
- **フロントエンドの表示に問題がある可能性が高い**

## 2. 根本原因の分析

### 2.1 考えられる原因

1. **フロントエンドのカテゴリフィルタリングの問題**
   - `FaqList.vue`の`getFaqsByCategory`メソッドに問題がある可能性
   - カテゴリ別に表示する際に、何らかの条件でFAQが除外されている

2. **`filteredFaqs`の問題**
   - `filteredFaqs`が`selectedCategory`によってフィルタリングされている
   - もし`selectedCategory`が設定されている場合、そのカテゴリのFAQのみが表示される

3. **表示ロジックの問題**
   - `FaqList.vue`の表示ロジックに問題がある可能性
   - カテゴリ別に表示する際に、何らかの条件でFAQが除外されている

### 2.2 `FaqList.vue`のコード分析

```typescript
const filteredFaqs = computed(() => {
  if (!selectedCategory.value) {
    return props.faqs
  }
  return props.faqs.filter(faq => faq.category === selectedCategory.value)
})

const getFaqsByCategory = (category: FAQCategory): FAQ[] => {
  return filteredFaqs.value.filter(faq => faq.category === category)
}
```

**問題点**:
- `getFaqsByCategory`は`filteredFaqs.value`からフィルタリングしている
- `filteredFaqs`は`selectedCategory`によってフィルタリングされている
- もし`selectedCategory`が設定されている場合、`getFaqsByCategory`はさらにフィルタリングするため、結果が空になる可能性がある

### 2.3 根本原因の特定

**真の根本原因**:
`getFaqsByCategory`メソッドが`filteredFaqs.value`からフィルタリングしているため、`selectedCategory`が設定されている場合、正しく動作しない可能性があります。

**正しい実装**:
`getFaqsByCategory`は`props.faqs`から直接フィルタリングする必要があります。

## 3. 大原則に準拠した修正案

### 3.1 修正方針

**大原則**:
1. **シンプルな実装**: 複雑なロジックを避ける
2. **根本的な解決**: フロントエンドの表示ロジックを修正
3. **確実性**: すべてのFAQが正しく表示される

### 3.2 修正案: `FaqList.vue`の`getFaqsByCategory`を修正

**修正内容**:
`getFaqsByCategory`メソッドを、`filteredFaqs.value`ではなく`props.faqs`から直接フィルタリングするように変更します。

**修正前**:
```typescript
const getFaqsByCategory = (category: FAQCategory): FAQ[] => {
  return filteredFaqs.value.filter(faq => faq.category === category)
}
```

**修正後**:
```typescript
const getFaqsByCategory = (category: FAQCategory): FAQ[] => {
  return props.faqs.filter(faq => faq.category === category)
}
```

**理由**:
- `getFaqsByCategory`は、カテゴリ別にFAQを取得するためのメソッドです
- `filteredFaqs`は、`selectedCategory`によってフィルタリングされた結果です
- カテゴリ別に表示する際は、元の`props.faqs`から直接フィルタリングする必要があります

## 4. 実装手順

1. **修正: `FaqList.vue`の`getFaqsByCategory`を修正**
   - `filteredFaqs.value`を`props.faqs`に変更

2. **テスト**
   - 各プランで新規登録
   - 20件のFAQが表示されることを確認
   - カテゴリ別に正しく表示されることを確認

## 5. 期待される効果

1. **すべてのFAQが表示される**: 20件のFAQが正しく表示される
2. **カテゴリ別に正しく表示される**: 各カテゴリのFAQが正しく表示される
3. **シンプルな実装**: 複雑なロジックが不要

## 6. 注意事項

1. **`filteredFaqs`の用途**: `filteredFaqs`は、`selectedCategory`が設定されている場合に使用されます（カテゴリフィルタが適用されている場合）
2. **`getFaqsByCategory`の用途**: `getFaqsByCategory`は、カテゴリ別にFAQを表示するために使用されます（カテゴリタブなど）

