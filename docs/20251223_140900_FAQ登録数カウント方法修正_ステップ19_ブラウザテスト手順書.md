# ステップ19: ブラウザテスト手順書

**作成日時**: 2025年12月23日  
**目的**: FAQ登録数カウント方法修正のブラウザテスト実施  
**テスト環境**: ローカルDocker環境

---

## テスト環境情報

- **バックエンドURL**: http://localhost:8000
- **フロントエンドURL**: http://localhost:5173
- **管理画面ログインURL**: http://localhost:5173/admin/login
- **テストユーザー**:
  - メールアドレス: `test@example.com`
  - パスワード: `testpassword123`
- **既存FAQデータ**: 9件（インテント単位）

---

## テスト項目一覧

### ✅ テスト1: FAQ管理画面 - FAQ一覧表示
### ✅ テスト2: FAQ管理画面 - FAQ作成（複数言語）
### ✅ テスト3: FAQ管理画面 - FAQ更新（複数言語）
### ✅ テスト4: FAQ管理画面 - FAQ削除
### ✅ テスト5: FAQ管理画面 - FAQ登録数のカウント確認
### ✅ テスト6: 複数言語FAQ作成後のカウント確認

---

## テスト1: FAQ管理画面 - FAQ一覧表示

### 手順

1. **ブラウザで管理画面にアクセス**
   - URL: http://localhost:5173/admin/login
   - ブラウザ: Chrome / Firefox / Safari 推奨

2. **ログイン**
   - メールアドレス: `test@example.com`
   - パスワード: `testpassword123`
   - 「ログイン」ボタンをクリック

3. **FAQ管理画面に移動**
   - サイドバーまたはメニューから「FAQ管理」をクリック
   - URL: http://localhost:5173/admin/faqs

4. **確認事項**

   ✅ **FAQ一覧が表示される**
   - 既存のFAQが一覧表示される
   - カテゴリ別にグループ化されている（basic, facilities, location, trouble）

   ✅ **各FAQに複数言語の翻訳が表示される**
   - 各FAQカードに複数の翻訳が表示される
   - 言語ラベル（英語、日本語など）が表示される
   - 各翻訳ごとに質問文（Q:）と回答文（A:）が表示される

   ✅ **言語ごとに質問・回答が表示される**
   - 例: 英語版「What time is check-out?」と日本語版「チェックアウトの時間は何時ですか？」が同じFAQ内に表示される

### 期待結果

- FAQ一覧が正常に表示される
- 各FAQに複数言語の翻訳が表示される
- 言語ごとに質問・回答が区別されて表示される

---

## テスト2: FAQ管理画面 - FAQ作成（複数言語）

### 手順

1. **FAQ管理画面で新規FAQ追加**
   - 「+ 新規FAQ追加」ボタンをクリック
   - モーダルが開く

2. **フォームに入力**

   **基本情報**:
   - カテゴリ: `basic` を選択
   - 優先度: `3` に設定（スライダー）

   **翻訳1（英語）**:
   - 言語: `英語` を選択
   - 質問文: `What time is check-out?`
   - 回答文: `Check-out time is 11:00 AM.`

   **翻訳2（日本語）を追加**:
   - 「+ 翻訳を追加」ボタンをクリック
   - 言語: `日本語` を選択
   - 質問文: `チェックアウトの時間は何時ですか？`
   - 回答文: `チェックアウトの時間は午前11時です。`

3. **FAQを作成**
   - 「作成」ボタンをクリック
   - モーダルが閉じる

4. **確認事項**

   ✅ **FAQが作成される**
   - 成功メッセージが表示される（オプション）
   - エラーメッセージが表示されない

   ✅ **FAQ一覧に新しいFAQが表示される**
   - 作成したFAQが一覧に追加される
   - カテゴリ「basic」のセクションに表示される

   ✅ **英語と日本語の両方の翻訳が表示される**
   - FAQカード内に英語版と日本語版の両方が表示される
   - 言語ラベルが正しく表示される

   ✅ **FAQ登録数が1件増える（インテント単位）**
   - ダッシュボードまたはFAQ一覧の件数表示を確認
   - 例: 9件 → 10件（2言語の翻訳があっても1件としてカウント）

### 期待結果

- FAQが正常に作成される
- 複数言語の翻訳が正しく保存される
- FAQ登録数がインテント単位で1件としてカウントされる

---

## テスト3: FAQ管理画面 - FAQ更新（複数言語）

### 手順

1. **作成したFAQを編集**
   - テスト2で作成したFAQの「編集」ボタンをクリック
   - モーダルが開く

2. **翻訳を追加**

   **翻訳3（繁体字中国語）を追加**:
   - 「+ 翻訳を追加」ボタンをクリック
   - 言語: `繁体字中国語` を選択
   - 質問文: `退房時間是幾點？`
   - 回答文: `退房時間是上午11點。`

3. **FAQを更新**
   - 「更新」ボタンをクリック
   - モーダルが閉じる

4. **確認事項**

   ✅ **FAQが更新される**
   - 成功メッセージが表示される（オプション）
   - エラーメッセージが表示されない

   ✅ **3つの言語（en, ja, zh-TW）の翻訳が表示される**
   - FAQカード内に英語、日本語、繁体字中国語の3つの翻訳が表示される
   - 各言語ラベルが正しく表示される

   ✅ **FAQ登録数は変わらない（インテント単位で1件のまま）**
   - ダッシュボードまたはFAQ一覧の件数表示を確認
   - 例: 10件のまま（3言語の翻訳があっても1件としてカウント）

### 期待結果

- FAQが正常に更新される
- 新しい翻訳が正しく追加される
- FAQ登録数が変わらない（インテント単位でカウント）

---

## テスト4: FAQ管理画面 - FAQ削除

### 手順

1. **作成したFAQを削除**
   - テスト2で作成したFAQの「削除」ボタンをクリック
   - 確認ダイアログが表示される

2. **削除を確認**
   - 確認ダイアログで「OK」または「削除」をクリック

3. **確認事項**

   ✅ **FAQが削除される**
   - 成功メッセージが表示される（オプション）
   - エラーメッセージが表示されない

   ✅ **FAQ一覧から削除される**
   - 削除したFAQが一覧から消える
   - ページをリロードしても表示されない

   ✅ **すべての翻訳も削除される**
   - データベースで確認（オプション）
   - 関連するすべての翻訳が削除される

   ✅ **FAQ登録数が1件減る**
   - ダッシュボードまたはFAQ一覧の件数表示を確認
   - 例: 10件 → 9件

### 期待結果

- FAQが正常に削除される
- 関連するすべての翻訳も削除される
- FAQ登録数が正しく減る

---

## テスト5: FAQ管理画面 - FAQ登録数のカウント確認

### 手順

1. **FAQ管理画面に移動**
   - サイドバーまたはメニューから「FAQ管理」をクリック
   - URL: http://localhost:5173/admin/faqs

2. **FAQ登録数を確認**
   - FAQ一覧のカテゴリ別件数を確認
   - 例: "Basic (5件)", "Facilities (2件)", "Location (1件)", "Trouble (1件)"
   - 合計件数がインテント単位でカウントされていることを確認

3. **確認事項**

   ✅ **FAQ登録数がカテゴリ別に表示される**
   - 各カテゴリの件数が表示される（例: "Basic (5件)"）
   - この件数はインテント単位でカウントされている

   ✅ **言語に関係なく、インテント単位でカウントされている**
   - 複数言語の翻訳があるFAQも1件としてカウント
   - 例: 英語と日本語の翻訳があるFAQは1件としてカウント

   ✅ **カウントが正確である**
   - データベースの`faqs`テーブルのレコード数と一致
   - `faq_translations`テーブルのレコード数とは一致しない（翻訳数ではなくインテント数）

### 期待結果

- FAQ登録数がカテゴリ別に正しく表示される
- インテント単位でカウントされている
- 複数言語の翻訳があっても1件としてカウントされる

---

## テスト6: 複数言語FAQ作成後のカウント確認

### 手順

1. **新しいFAQを作成（英語のみ）**
   - FAQ管理画面で「+ 新規FAQ追加」をクリック
   - カテゴリ: `facilities`
   - 翻訳1: 言語=英語, 質問=`Do you have WiFi?`, 回答=`Yes, we have free WiFi.`
   - 「作成」ボタンをクリック

2. **FAQ登録数を確認**
   - FAQ管理画面のカテゴリ別件数を確認
   - 例: "Facilities (3件)"（既存2件 + 新規1件）
   - 合計件数がインテント単位でカウントされていることを確認

3. **同じFAQに日本語翻訳を追加**
   - 作成したFAQの「編集」ボタンをクリック
   - 「+ 翻訳を追加」をクリック
   - 翻訳2: 言語=日本語, 質問=`WiFiはありますか？`, 回答=`はい、無料WiFiをご利用いただけます。`
   - 「更新」ボタンをクリック

4. **FAQ登録数を再確認**
   - FAQ管理画面のカテゴリ別件数を再確認
   - 例: "Facilities (3件)"（件数が変わらない）

5. **確認事項**

   ✅ **FAQ登録数が変わらない（3件のまま）**
   - 翻訳を追加してもFAQ登録数が増えない
   - インテント単位でカウントされていることを確認

   ✅ **FAQ一覧に2つの翻訳が表示される**
   - 英語版と日本語版の両方が表示される
   - 言語ラベルが正しく表示される

### 期待結果

- 翻訳を追加してもFAQ登録数が変わらない
- インテント単位でカウントされていることを確認
- 複数言語の翻訳が正しく表示される

---

## テスト結果記録

### テスト実施日時
- 開始: _______________
- 終了: _______________

### テスト結果

| テスト項目 | 結果 | 備考 |
|-----------|------|------|
| テスト1: FAQ一覧表示 | ⬜ 成功 / ⬜ 失敗 | |
| テスト2: FAQ作成（複数言語） | ⬜ 成功 / ⬜ 失敗 | |
| テスト3: FAQ更新（複数言語） | ⬜ 成功 / ⬜ 失敗 | |
| テスト4: FAQ削除 | ⬜ 成功 / ⬜ 失敗 | |
| テスト5: ダッシュボードFAQカウント | ⬜ 成功 / ⬜ 失敗 | |
| テスト6: 複数言語FAQ作成後のカウント | ⬜ 成功 / ⬜ 失敗 | |

### 発見した問題

1. _________________________________________________
2. _________________________________________________
3. _________________________________________________

### 修正が必要な項目

1. _________________________________________________
2. _________________________________________________
3. _________________________________________________

---

## 補足情報

### データベース確認コマンド（オプション）

```bash
# FAQ数（インテント単位）を確認
docker exec yadopera-postgres psql -U yadopera_user -d yadopera -c "SELECT COUNT(*) FROM faqs;"

# 翻訳数（言語単位）を確認
docker exec yadopera-postgres psql -U yadopera_user -d yadopera -c "SELECT COUNT(*) FROM faq_translations;"

# FAQと翻訳の関係を確認
docker exec yadopera-postgres psql -U yadopera_user -d yadopera -c "SELECT f.id, f.intent_key, COUNT(ft.id) as translation_count FROM faqs f LEFT JOIN faq_translations ft ON f.id = ft.faq_id GROUP BY f.id, f.intent_key ORDER BY f.id;"
```

### ブラウザ開発者ツールの確認

- **ネットワークタブ**: APIリクエスト/レスポンスを確認
- **コンソールタブ**: JavaScriptエラーを確認
- **アプリケーションタブ**: ローカルストレージ、セッションストレージを確認

---

**テスト完了後、結果を記録し、問題があれば報告してください。**

