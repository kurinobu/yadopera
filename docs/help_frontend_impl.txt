# Phase 2: 統合ヘルプシステム - Frontend完全実装ガイド

## ドキュメント情報
- **プロジェクト**: YadOPERA（宿泊施設管理システム）
- **対象フェーズ**: Phase 2 - 統合ヘルプシステム Frontend実装
- **作成日**: 2025年12月27日
- **バージョン**: 1.0
- **依存文書**: help-system-plan.md, help-system-backend.md

---

## 目次

1. [プロジェクト構成](#1-プロジェクト構成)
2. [型定義](#2-型定義)
3. [API通信層](#3-api通信層)
4. [状態管理（Pinia Store）](#4-状態管理pinia-store)
5. [コンポーネント実装](#5-コンポーネント実装)
6. [スタイリング](#6-スタイリング)
7. [国際化（i18n）](#7-国際化i18n)
8. [ルーティング統合](#8-ルーティング統合)
9. [テストコード](#9-テストコード)
10. [ビルド・デプロイ設定](#10-ビルドデプロイ設定)

---

## 1. プロジェクト構成

```
frontend/
├── src/
│   ├── components/
│   │   └── help/
│   │       ├── HelpButton.vue              # 右下固定ヘルプボタン
│   │       ├── HelpModal.vue               # ヘルプモーダル本体
│   │       ├── FaqList.vue                 # FAQ一覧表示
│   │       ├── FaqItem.vue                 # FAQ個別アイテム
│   │       ├── FaqSearchBar.vue            # FAQ検索バー
│   │       ├── CategoryFilter.vue          # カテゴリフィルタ
│   │       ├── AiChatPanel.vue             # AIチャットパネル
│   │       ├── ChatMessage.vue             # チャットメッセージ
│   │       └── RelatedFaqSuggestion.vue    # 関連FAQ提案
│   ├── stores/
│   │   └── helpStore.ts                    # ヘルプシステム状態管理
│   ├── api/
│   │   ├── client.ts                       # Axios設定
│   │   └── help.ts                         # ヘルプAPI呼び出し
│   ├── types/
│   │   └── help.ts                         # 型定義
│   ├── composables/
│   │   └── useHelp.ts                      # ヘルプシステム共通ロジック
│   ├── i18n/
│   │   ├── index.ts                        # i18n設定
│   │   └── locales/
│   │       ├── ja.json                     # 日本語翻訳
│   │       └── en.json                     # 英語翻訳
│   └── App.vue                             # ルートコンポーネント
├── tests/
│   └── components/
│       └── help/
│           ├── HelpButton.spec.ts
│           ├── HelpModal.spec.ts
│           └── AiChatPanel.spec.ts
├── package.json
├── tsconfig.json
├── vite.config.ts
└── tailwind.config.js
```

---

## 2. 型定義

### src/types/help.ts

```typescript
/**
 * ヘルプシステム型定義
 */

/**
 * FAQカテゴリ
 */
export type FaqCategory = 
  | 'setup'
  | 'qrcode'
  | 'faq_management'
  | 'ai_logic'
  | 'logs'
  | 'troubleshooting'
  | 'billing'
  | 'security';

/**
 * FAQ項目
 */
export interface Faq {
  id: number;
  category: FaqCategory;
  question: string;
  answer: string;
  keywords?: string;
  related_url?: string;
  display_order: number;
  relevance_score?: number;
}

/**
 * FAQリストレスポンス
 */
export interface FaqListResponse {
  faqs: Faq[];
  total: number;
  categories: string[];
}

/**
 * FAQ検索レスポンス
 */
export interface FaqSearchResponse {
  results: Faq[];
  total: number;
  query: string;
}

/**
 * チャットメッセージタイプ
 */
export type MessageRole = 'user' | 'assistant';

/**
 * チャットメッセージ
 */
export interface ChatMessage {
  id: string;
  role: MessageRole;
  content: string;
  timestamp: string;
  related_faqs?: RelatedFaq[];
  related_url?: string;
}

/**
 * 関連FAQ
 */
export interface RelatedFaq {
  id: number;
  question: string;
  category: string;
}

/**
 * チャットリクエスト
 */
export interface ChatRequest {
  message: string;
  language: string;
}

/**
 * チャットレスポンス
 */
export interface ChatResponse {
  response: string;
  related_faqs: RelatedFaq[];
  related_url?: string;
  timestamp: string;
}

/**
 * ヘルプモーダルタブ
 */
export type HelpTab = 'faq' | 'chat';

/**
 * カテゴリ情報
 */
export interface CategoryInfo {
  category: FaqCategory;
  count: number;
  label: string;
}
```

---

## 3. API通信層

### src/api/client.ts

```typescript
/**
 * Axios クライアント設定
 */
import axios, { AxiosInstance, AxiosError, InternalAxiosRequestConfig } from 'axios';

const BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8000/api/v1';

/**
 * Axiosインスタンス作成
 */
const apiClient: AxiosInstance = axios.create({
  baseURL: BASE_URL,
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json',
  },
});

/**
 * リクエストインターセプター: JWT認証トークン付与
 */
apiClient.interceptors.request.use(
  (config: InternalAxiosRequestConfig) => {
    const token = localStorage.getItem('access_token');
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error: AxiosError) => {
    return Promise.reject(error);
  }
);

/**
 * レスポンスインターセプター: エラーハンドリング
 */
apiClient.interceptors.response.use(
  (response) => response,
  (error: AxiosError) => {
    if (error.response?.status === 401) {
      // 認証エラー時の処理（ログインページへリダイレクトなど）
      console.error('Unauthorized access');
      // router.push('/login');
    } else if (error.response?.status === 429) {
      // レート制限エラー
      console.error('Rate limit exceeded');
    }
    return Promise.reject(error);
  }
);

export default apiClient;
```

### src/api/help.ts

```typescript
/**
 * ヘルプシステムAPI呼び出し
 */
import apiClient from './client';
import type {
  FaqListResponse,
  FaqSearchResponse,
  ChatRequest,
  ChatResponse,
} from '@/types/help';

/**
 * ヘルプAPI
 */
export const helpApi = {
  /**
   * FAQ一覧取得
   */
  async getFaqs(params?: {
    category?: string;
    language?: string;
  }): Promise<FaqListResponse> {
    const response = await apiClient.get<FaqListResponse>('/help/faqs', {
      params: {
        language: params?.language || 'ja',
        ...(params?.category && { category: params.category }),
      },
    });
    return response.data;
  },

  /**
   * FAQ検索
   */
  async searchFaqs(params: {
    query: string;
    language?: string;
    limit?: number;
  }): Promise<FaqSearchResponse> {
    const response = await apiClient.get<FaqSearchResponse>('/help/search', {
      params: {
        q: params.query,
        language: params.language || 'ja',
        limit: params.limit || 10,
      },
    });
    return response.data;
  },

  /**
   * AIチャット送信
   */
  async sendChatMessage(request: ChatRequest): Promise<ChatResponse> {
    const response = await apiClient.post<ChatResponse>('/help/chat', request);
    return response.data;
  },
};
```

---

## 4. 状態管理（Pinia Store）

### src/stores/helpStore.ts

```typescript
/**
 * ヘルプシステム状態管理
 */
import { defineStore } from 'pinia';
import { ref, computed } from 'vue';
import type {
  Faq,
  ChatMessage,
  FaqCategory,
  HelpTab,
  CategoryInfo,
} from '@/types/help';
import { helpApi } from '@/api/help';

export const useHelpStore = defineStore('help', () => {
  // State
  const isModalOpen = ref(false);
  const activeTab = ref<HelpTab>('faq');
  const faqs = ref<Faq[]>([]);
  const filteredFaqs = ref<Faq[]>([]);
  const categories = ref<string[]>([]);
  const selectedCategory = ref<string | null>(null);
  const searchQuery = ref('');
  const chatMessages = ref<ChatMessage[]>([]);
  const isLoading = ref(false);
  const isSending = ref(false);
  const error = ref<string | null>(null);
  const currentLanguage = ref('ja');

  // Computed
  const categoryInfoList = computed<CategoryInfo[]>(() => {
    const categoryLabels: Record<FaqCategory, string> = {
      setup: '初期設定',
      qrcode: 'QRコード',
      faq_management: 'FAQ管理',
      ai_logic: 'AI仕組み',
      logs: 'ログ分析',
      troubleshooting: 'トラブルシューティング',
      billing: '料金',
      security: 'セキュリティ',
    };

    return categories.value.map((cat) => {
      const count = faqs.value.filter((faq) => faq.category === cat).length;
      return {
        category: cat as FaqCategory,
        count,
        label: categoryLabels[cat as FaqCategory] || cat,
      };
    });
  });

  const hasMessages = computed(() => chatMessages.value.length > 0);

  // Actions
  const openModal = (tab: HelpTab = 'faq') => {
    isModalOpen.value = true;
    activeTab.value = tab;
  };

  const closeModal = () => {
    isModalOpen.value = false;
  };

  const switchTab = (tab: HelpTab) => {
    activeTab.value = tab;
  };

  /**
   * FAQ一覧取得
   */
  const fetchFaqs = async (category?: string) => {
    isLoading.value = true;
    error.value = null;

    try {
      const response = await helpApi.getFaqs({
        category,
        language: currentLanguage.value,
      });

      faqs.value = response.faqs;
      filteredFaqs.value = response.faqs;
      categories.value = response.categories;
    } catch (err) {
      error.value = 'FAQの取得に失敗しました';
      console.error('Failed to fetch FAQs:', err);
    } finally {
      isLoading.value = false;
    }
  };

  /**
   * FAQ検索
   */
  const searchFaqs = async (query: string) => {
    if (!query || query.trim().length < 2) {
      filteredFaqs.value = faqs.value;
      searchQuery.value = '';
      return;
    }

    isLoading.value = true;
    error.value = null;
    searchQuery.value = query;

    try {
      const response = await helpApi.searchFaqs({
        query,
        language: currentLanguage.value,
      });

      filteredFaqs.value = response.results;
    } catch (err) {
      error.value = '検索に失敗しました';
      console.error('Failed to search FAQs:', err);
    } finally {
      isLoading.value = false;
    }
  };

  /**
   * カテゴリフィルタ適用
   */
  const filterByCategory = (category: string | null) => {
    selectedCategory.value = category;
    searchQuery.value = '';

    if (!category) {
      filteredFaqs.value = faqs.value;
    } else {
      filteredFaqs.value = faqs.value.filter((faq) => faq.category === category);
    }
  };

  /**
   * チャットメッセージ送信
   */
  const sendChatMessage = async (message: string) => {
    if (!message.trim()) return;

    isSending.value = true;
    error.value = null;

    // ユーザーメッセージ追加
    const userMessage: ChatMessage = {
      id: `user-${Date.now()}`,
      role: 'user',
      content: message,
      timestamp: new Date().toISOString(),
    };
    chatMessages.value.push(userMessage);

    try {
      const response = await helpApi.sendChatMessage({
        message,
        language: currentLanguage.value,
      });

      // AIメッセージ追加
      const aiMessage: ChatMessage = {
        id: `assistant-${Date.now()}`,
        role: 'assistant',
        content: response.response,
        timestamp: response.timestamp,
        related_faqs: response.related_faqs,
        related_url: response.related_url,
      };
      chatMessages.value.push(aiMessage);
    } catch (err) {
      error.value = 'メッセージの送信に失敗しました';
      console.error('Failed to send message:', err);

      // エラーメッセージ追加
      const errorMessage: ChatMessage = {
        id: `error-${Date.now()}`,
        role: 'assistant',
        content: '申し訳ございません。一時的にエラーが発生しました。',
        timestamp: new Date().toISOString(),
      };
      chatMessages.value.push(errorMessage);
    } finally {
      isSending.value = false;
    }
  };

  /**
   * チャット履歴クリア
   */
  const clearChatHistory = () => {
    chatMessages.value = [];
  };

  /**
   * 言語切り替え
   */
  const changeLanguage = async (lang: string) => {
    currentLanguage.value = lang;
    await fetchFaqs(selectedCategory.value || undefined);
  };

  /**
   * 初期化
   */
  const initialize = async () => {
    await fetchFaqs();
  };

  return {
    // State
    isModalOpen,
    activeTab,
    faqs,
    filteredFaqs,
    categories,
    selectedCategory,
    searchQuery,
    chatMessages,
    isLoading,
    isSending,
    error,
    currentLanguage,

    // Computed
    categoryInfoList,
    hasMessages,

    // Actions
    openModal,
    closeModal,
    switchTab,
    fetchFaqs,
    searchFaqs,
    filterByCategory,
    sendChatMessage,
    clearChatHistory,
    changeLanguage,
    initialize,
  };
});
```

---

## 5. コンポーネント実装

### src/components/help/HelpButton.vue

```vue
<template>
  <Teleport to="body">
    <button
      @click="handleClick"
      class="fixed bottom-6 right-6 z-50 group"
      aria-label="ヘルプ"
      title="ヘルプを表示"
    >
      <div
        class="
          flex items-center justify-center
          w-14 h-14 rounded-full
          bg-indigo-600 hover:bg-indigo-700
          text-white shadow-lg hover:shadow-xl
          transition-all duration-200
          group-hover:scale-110
        "
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
          d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
        />
      </svg>
      <p class="text-lg font-medium">{{ t('help.faq.empty') }}</p>
    </div>

    <!-- FAQ Items -->
    <div v-else class="space-y-3">
      <FaqItem
        v-for="faq in helpStore.filteredFaqs"
        :key="faq.id"
        :faq="faq"
        :highlight-query="helpStore.searchQuery"
      />
    </div>
  </div>
</template>

<script setup lang="ts">
import { useI18n } from 'vue-i18n';
import { useHelpStore } from '@/stores/helpStore';
import FaqItem from './FaqItem.vue';

const { t } = useI18n();
const helpStore = useHelpStore();

// Methods
const handleRetry = async () => {
  await helpStore.fetchFaqs();
};
</script>
```

### src/components/help/FaqItem.vue

```vue
<template>
  <div
    class="
      p-4 rounded-lg border border-gray-200
      hover:border-indigo-300 hover:shadow-md
      transition-all cursor-pointer
    "
    @click="toggleExpanded"
  >
    <!-- Question -->
    <div class="flex items-start justify-between">
      <h3 class="flex-1 text-base font-medium text-gray-900" v-html="highlightedQuestion"></h3>
      <button
        class="ml-4 text-gray-400 hover:text-gray-600 transition-colors"
        :aria-label="isExpanded ? '閉じる' : '開く'"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 transition-transform"
          :class="{ 'rotate-180': isExpanded }"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 9l-7 7-7-7"
          />
        </svg>
      </button>
    </div>

    <!-- Category Badge -->
    <div class="mt-2">
      <span
        class="
          inline-block px-2 py-1 text-xs font-medium rounded
          bg-indigo-100 text-indigo-800
        "
      >
        {{ categoryLabel }}
      </span>
    </div>

    <!-- Answer (Expandable) -->
    <Transition name="expand">
      <div v-if="isExpanded" class="mt-4 space-y-3">
        <div class="text-sm text-gray-700 whitespace-pre-wrap" v-html="highlightedAnswer"></div>

        <!-- Related URL -->
        <div v-if="faq.related_url" class="pt-3 border-t">
          <a
            :href="faq.related_url"
            class="
              inline-flex items-center text-sm text-indigo-600
              hover:text-indigo-800 hover:underline
            "
            @click.stop
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-4 w-4 mr-1"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 7l5 5m0 0l-5 5m5-5H6"
              />
            </svg>
            {{ t('help.faq.goToPage') }}
          </a>
        </div>
      </div>
    </Transition>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue';
import { useI18n } from 'vue-i18n';
import type { Faq } from '@/types/help';

const { t } = useI18n();

// Props
interface Props {
  faq: Faq;
  highlightQuery?: string;
}

const props = defineProps<Props>();

// State
const isExpanded = ref(false);

// Computed
const categoryLabel = computed(() => {
  const labels: Record<string, string> = {
    setup: '初期設定',
    qrcode: 'QRコード',
    faq_management: 'FAQ管理',
    ai_logic: 'AI仕組み',
    logs: 'ログ分析',
    troubleshooting: 'トラブルシューティング',
    billing: '料金',
    security: 'セキュリティ',
  };
  return labels[props.faq.category] || props.faq.category;
});

const highlightedQuestion = computed(() => {
  return highlightText(props.faq.question, props.highlightQuery);
});

const highlightedAnswer = computed(() => {
  return highlightText(props.faq.answer, props.highlightQuery);
});

// Methods
const toggleExpanded = () => {
  isExpanded.value = !isExpanded.value;
};

const highlightText = (text: string, query?: string): string => {
  if (!query || query.trim().length === 0) {
    return text;
  }

  const regex = new RegExp(`(${escapeRegex(query)})`, 'gi');
  return text.replace(regex, '<mark class="bg-yellow-200">$1</mark>');
};

const escapeRegex = (str: string): string => {
  return str.replace(/[.*+?^${}()|[\]\\]/g, '\\');
};
</script>

<style scoped>
.expand-enter-active,
.expand-leave-active {
  transition: all 0.3s ease;
  max-height: 500px;
  overflow: hidden;
}

.expand-enter-from,
.expand-leave-to {
  max-height: 0;
  opacity: 0;
}
</style>
```

### src/components/help/AiChatPanel.vue

```vue
<template>
  <div class="flex flex-col h-full">
    <!-- Chat Messages Area -->
    <div ref="messagesContainer" class="flex-1 overflow-y-auto p-6 space-y-4">
      <!-- Welcome Message -->
      <div v-if="!helpStore.hasMessages" class="text-center py-12">
        <div class="inline-block p-4 bg-indigo-100 rounded-full mb-4">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-12 w-12 text-indigo-600"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
            />
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-gray-900 mb-2">
          {{ t('help.chat.welcome.title') }}
        </h3>
        <p class="text-sm text-gray-600 max-w-md mx-auto">
          {{ t('help.chat.welcome.description') }}
        </p>
      </div>

      <!-- Chat Messages -->
      <ChatMessage
        v-for="message in helpStore.chatMessages"
        :key="message.id"
        :message="message"
      />

      <!-- Loading Indicator -->
      <div v-if="helpStore.isSending" class="flex items-start space-x-3">
        <div class="flex-shrink-0 w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 text-indigo-600"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
            />
          </svg>
        </div>
        <div class="flex-1 bg-gray-100 rounded-lg p-4">
          <div class="flex space-x-2">
            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="border-t p-4 bg-gray-50">
      <!-- Clear History Button -->
      <div v-if="helpStore.hasMessages" class="mb-3 text-center">
        <button
          @click="handleClearHistory"
          class="text-sm text-gray-600 hover:text-gray-800 hover:underline"
        >
          {{ t('help.chat.clearHistory') }}
        </button>
      </div>

      <!-- Input Form -->
      <form @submit.prevent="handleSendMessage" class="flex items-end space-x-3">
        <div class="flex-1">
          <textarea
            v-model="messageInput"
            :placeholder="t('help.chat.placeholder')"
            rows="2"
            class="
              w-full px-4 py-3 rounded-lg border border-gray-300
              focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent
              resize-none transition-all
            "
            :disabled="helpStore.isSending"
            @keydown.enter.exact.prevent="handleSendMessage"
          ></textarea>
          <p class="mt-1 text-xs text-gray-500">
            {{ t('help.chat.hint') }}
          </p>
        </div>
        <button
          type="submit"
          :disabled="!messageInput.trim() || helpStore.isSending"
          class="
            px-6 py-3 rounded-lg font-medium
            bg-indigo-600 text-white
            hover:bg-indigo-700
            disabled:bg-gray-300 disabled:cursor-not-allowed
            transition-colors
          "
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
            />
          </svg>
        </button>
      </form>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, nextTick, watch } from 'vue';
import { useI18n } from 'vue-i18n';
import { useHelpStore } from '@/stores/helpStore';
import ChatMessage from './ChatMessage.vue';

const { t } = useI18n();
const helpStore = useHelpStore();

// State
const messageInput = ref('');
const messagesContainer = ref<HTMLElement | null>(null);

// Methods
const handleSendMessage = async () => {
  if (!messageInput.value.trim() || helpStore.isSending) {
    return;
  }

  const message = messageInput.value;
  messageInput.value = '';

  await helpStore.sendChatMessage(message);
  await scrollToBottom();
};

const handleClearHistory = () => {
  if (confirm(t('help.chat.confirmClear'))) {
    helpStore.clearChatHistory();
  }
};

const scrollToBottom = async () => {
  await nextTick();
  if (messagesContainer.value) {
    messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight;
  }
};

// Watch messages changes and scroll
watch(
  () => helpStore.chatMessages.length,
  () => {
    scrollToBottom();
  }
);
</script>
```

### src/components/help/ChatMessage.vue

```vue
<template>
  <div
    :class="[
      'flex items-start space-x-3',
      message.role === 'user' ? 'justify-end' : 'justify-start',
    ]"
  >
    <!-- Assistant Avatar -->
    <div
      v-if="message.role === 'assistant'"
      class="flex-shrink-0 w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-5 w-5 text-indigo-600"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
        />
      </svg>
    </div>

    <!-- Message Content -->
    <div
      :class="[
        'max-w-[70%] rounded-lg p-4',
        message.role === 'user'
          ? 'bg-indigo-600 text-white'
          : 'bg-gray-100 text-gray-900',
      ]"
    >
      <p class="text-sm whitespace-pre-wrap">{{ message.content }}</p>

      <!-- Related URL -->
      <div v-if="message.related_url && message.role === 'assistant'" class="mt-3 pt-3 border-t border-gray-200">
        <a
          :href="message.related_url"
          class="inline-flex items-center text-sm text-indigo-600 hover:text-indigo-800 hover:underline"
          target="_blank"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 mr-1"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 7l5 5m0 0l-5 5m5-5H6"
            />
          </svg>
          {{ t('help.chat.goToPage') }}
        </a>
      </div>

      <!-- Related FAQs -->
      <RelatedFaqSuggestion
        v-if="message.related_faqs && message.related_faqs.length > 0"
        :related-faqs="message.related_faqs"
      />

      <!-- Timestamp -->
      <p
        :class="[
          'mt-2 text-xs',
          message.role === 'user' ? 'text-indigo-200' : 'text-gray-500',
        ]"
      >
        {{ formatTimestamp(message.timestamp) }}
      </p>
    </div>

    <!-- User Avatar -->
    <div
      v-if="message.role === 'user'"
      class="flex-shrink-0 w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-5 w-5 text-gray-600"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
        />
      </svg>
    </div>
  </div>
</template>

<script setup lang="ts">
import { useI18n } from 'vue-i18n';
import type { ChatMessage as ChatMessageType } from '@/types/help';
import RelatedFaqSuggestion from './RelatedFaqSuggestion.vue';

const { t } = useI18n();

// Props
interface Props {
  message: ChatMessageType;
}

defineProps<Props>();

// Methods
const formatTimestamp = (timestamp: string): string => {
  const date = new Date(timestamp);
  return date.toLocaleTimeString('ja-JP', {
    hour: '2-digit',
    minute: '2-digit',
  });
};
</script>
```

### src/components/help/RelatedFaqSuggestion.vue

```vue
<template>
  <div class="mt-3 pt-3 border-t border-gray-200">
    <p class="text-xs font-medium text-gray-600 mb-2">
      {{ t('help.chat.relatedFaqs') }}
    </p>
    <div class="space-y-2">
      <button
        v-for="faq in relatedFaqs"
        :key="faq.id"
        @click="handleFaqClick(faq.id)"
        class="
          w-full text-left px-3 py-2 rounded
          bg-white border border-gray-200
          hover:border-indigo-300 hover:bg-indigo-50
          transition-colors text-sm
        "
      >
        <span class="text-gray-700">{{ faq.question }}</span>
        <span class="ml-2 text-xs text-gray-500">({{ getCategoryLabel(faq.category) }})</span>
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { useI18n } from 'vue-i18n';
import { useHelpStore } from '@/stores/helpStore';
import type { RelatedFaq } from '@/types/help';

const { t } = useI18n();
const helpStore = useHelpStore();

// Props
interface Props {
  relatedFaqs: RelatedFaq[];
}

defineProps<Props>();

// Methods
const handleFaqClick = (faqId: number) => {
  // FAQタブに切り替えて該当FAQにスクロール
  helpStore.switchTab('faq');
  
  // FAQ詳細を開く処理（次のtickで実行）
  setTimeout(() => {
    const faqElement = document.getElementById(`faq-${faqId}`);
    if (faqElement) {
      faqElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
      faqElement.click();
    }
  }, 100);
};

const getCategoryLabel = (category: string): string => {
  const labels: Record<string, string> = {
    setup: '初期設定',
    qrcode: 'QRコード',
    faq_management: 'FAQ管理',
    ai_logic: 'AI仕組み',
    logs: 'ログ分析',
    troubleshooting: 'トラブルシューティング',
    billing: '料金',
    security: 'セキュリティ',
  };
  return labels[category] || category;
};
</script>
```

---

## 6. スタイリング

### tailwind.config.js

```javascript
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{vue,js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        indigo: {
          50: '#eef2ff',
          100: '#e0e7ff',
          200: '#c7d2fe',
          300: '#a5b4fc',
          400: '#818cf8',
          500: '#6366f1',
          600: '#4f46e5',
          700: '#4338ca',
          800: '#3730a3',
          900: '#312e81',
        },
      },
      animation: {
        'bounce': 'bounce 1s infinite',
      },
    },
  },
  plugins: [],
}
```

---

## 7. 国際化（i18n）

### src/i18n/index.ts

```typescript
/**
 * Vue i18n 設定
 */
import { createI18n } from 'vue-i18n';
import ja from './locales/ja.json';
import en from './locales/en.json';

const i18n = createI18n({
  legacy: false,
  locale: 'ja',
  fallbackLocale: 'en',
  messages: {
    ja,
    en,
  },
});

export default i18n;
```

### src/i18n/locales/ja.json

```json
{
  "help": {
    "title": "ヘルプ",
    "tabs": {
      "faq": "よくある質問",
      "chat": "AIチャット"
    },
    "categories": {
      "all": "すべて"
    },
    "search": {
      "placeholder": "FAQを検索...",
      "results": "{count}件の結果"
    },
    "faq": {
      "empty": "該当するFAQが見つかりませんでした",
      "retry": "再試行",
      "goToPage": "該当ページへ移動"
    },
    "chat": {
      "welcome": {
        "title": "AIヘルプアシスタント",
        "description": "何でも質問してください。システムの使い方や設定方法について、AIがお答えします。"
      },
      "placeholder": "質問を入力してください...",
      "hint": "Enterで送信、Shift+Enterで改行",
      "clearHistory": "履歴をクリア",
      "confirmClear": "チャット履歴を削除しますか？",
      "relatedFaqs": "関連するFAQ:",
      "goToPage": "該当ページへ移動"
    }
  }
}
```

### src/i18n/locales/en.json

```json
{
  "help": {
    "title": "Help",
    "tabs": {
      "faq": "FAQ",
      "chat": "AI Chat"
    },
    "categories": {
      "all": "All"
    },
    "search": {
      "placeholder": "Search FAQs...",
      "results": "{count} results"
    },
    "faq": {
      "empty": "No FAQs found",
      "retry": "Retry",
      "goToPage": "Go to page"
    },
    "chat": {
      "welcome": {
        "title": "AI Help Assistant",
        "description": "Ask me anything. I'll help you with system usage and settings."
      },
      "placeholder": "Type your question...",
      "hint": "Press Enter to send, Shift+Enter for new line",
      "clearHistory": "Clear history",
      "confirmClear": "Delete chat history?",
      "relatedFaqs": "Related FAQs:",
      "goToPage": "Go to page"
    }
  }
}
```

---

## 8. ルーティング統合

### src/App.vue

```vue
<template>
  <div id="app">
    <!-- メインコンテンツ -->
    <router-view />

    <!-- ヘルプボタン（全ページ共通） -->
    <HelpButton />

    <!-- ヘルプモーダル -->
    <HelpModal />
  </div>
</template>

<script setup lang="ts">
import { onMounted } from 'vue';
import HelpButton from '@/components/help/HelpButton.vue';
import HelpModal from '@/components/help/HelpModal.vue';
import { useHelpStore } from '@/stores/helpStore';

const helpStore = useHelpStore();

onMounted(async () => {
  // 初回FAQデータ読み込み
  await helpStore.initialize();
});
</script>
```

---

## 9. テストコード

### tests/components/help/HelpButton.spec.ts

```typescript
import { describe, it, expect, beforeEach } from 'vitest';
import { mount } from '@vue/test-utils';
import { createPinia, setActivePinia } from 'pinia';
import HelpButton from '@/components/help/HelpButton.vue';
import { useHelpStore } from '@/stores/helpStore';

describe('HelpButton.vue', () => {
  beforeEach(() => {
    setActivePinia(createPinia());
  });

  it('renders welcome message when no messages', () => {
    const wrapper = mount(AiChatPanel);
    expect(wrapper.text()).toContain('AIヘルプアシスタント');
  });

  it('sends message correctly', async () => {
    const wrapper = mount(AiChatPanel);
    const helpStore = useHelpStore();

    const textarea = wrapper.find('textarea');
    const form = wrapper.find('form');

    await textarea.setValue('テストメッセージ');
    await form.trigger('submit');
    await flushPromises();

    expect(helpStore.chatMessages.length).toBeGreaterThan(0);
    expect(helpStore.chatMessages[0].content).toBe('テストメッセージ');
  });

  it('disables input while sending', async () => {
    const wrapper = mount(AiChatPanel);
    const helpStore = useHelpStore();

    helpStore.isSending = true;
    await wrapper.vm.$nextTick();

    const textarea = wrapper.find('textarea');
    const button = wrapper.find('button[type="submit"]');

    expect(textarea.attributes('disabled')).toBeDefined();
    expect(button.attributes('disabled')).toBeDefined();
  });

  it('clears history when button clicked', async () => {
    const wrapper = mount(AiChatPanel);
    const helpStore = useHelpStore();

    // メッセージを追加
    helpStore.chatMessages = [
      {
        id: '1',
        role: 'user',
        content: 'テスト',
        timestamp: new Date().toISOString(),
      },
    ];

    await wrapper.vm.$nextTick();

    // confirmをモック
    global.confirm = vi.fn(() => true);

    const clearButton = wrapper.find('button');
    if (clearButton.text().includes('履歴をクリア')) {
      await clearButton.trigger('click');
      expect(helpStore.chatMessages.length).toBe(0);
    }
  });
});
```

---

## 10. ビルド・デプロイ設定

### package.json

```json
{
  "name": "yadopera-frontend",
  "version": "0.3.9",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc && vite build",
    "preview": "vite preview",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "lint": "eslint . --ext .vue,.js,.jsx,.cjs,.mjs,.ts,.tsx,.cts,.mts --fix --ignore-path .gitignore",
    "format": "prettier --write src/"
  },
  "dependencies": {
    "vue": "^3.4.21",
    "vue-router": "^4.3.0",
    "pinia": "^2.1.7",
    "axios": "^1.6.7",
    "vue-i18n": "^9.10.0",
    "@vueuse/core": "^10.9.0"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^5.0.4",
    "@vue/test-utils": "^2.4.4",
    "typescript": "^5.4.2",
    "vite": "^5.1.6",
    "vitest": "^1.3.1",
    "@vitest/ui": "^1.3.1",
    "vue-tsc": "^2.0.6",
    "tailwindcss": "^3.4.1",
    "postcss": "^8.4.35",
    "autoprefixer": "^10.4.18",
    "eslint": "^8.57.0",
    "eslint-plugin-vue": "^9.22.0",
    "@typescript-eslint/parser": "^7.1.1",
    "@typescript-eslint/eslint-plugin": "^7.1.1",
    "prettier": "^3.2.5",
    "jsdom": "^24.0.0"
  }
}
```

### vite.config.ts

```typescript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import { fileURLToPath, URL } from 'node:url';

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url)),
    },
  },
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true,
      },
    },
  },
  build: {
    outDir: 'dist',
    sourcemap: true,
    rollupOptions: {
      output: {
        manualChunks: {
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          'ui-vendor': ['axios', 'vue-i18n'],
        },
      },
    },
  },
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./tests/setup.ts'],
  },
});
```

### tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "preserve",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,

    /* Path Alias */
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },

    /* Vue */
    "types": ["vite/client", "vitest/globals"]
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue", "tests/**/*.ts"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

### .env.example

```bash
# API Base URL
VITE_API_BASE_URL=http://localhost:8000/api/v1

# Environment
VITE_APP_ENV=development
```

### .eslintrc.cjs

```javascript
module.exports = {
  root: true,
  env: {
    node: true,
    browser: true,
    es2021: true,
  },
  extends: [
    'eslint:recommended',
    'plugin:vue/vue3-recommended',
    'plugin:@typescript-eslint/recommended',
  ],
  parser: 'vue-eslint-parser',
  parserOptions: {
    parser: '@typescript-eslint/parser',
    ecmaVersion: 'latest',
    sourceType: 'module',
  },
  plugins: ['vue', '@typescript-eslint'],
  rules: {
    'vue/multi-word-component-names': 'off',
    '@typescript-eslint/no-explicit-any': 'warn',
  },
};
```

### .prettierrc

```json
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5",
  "printWidth": 100,
  "arrowParens": "always"
}
```

### tests/setup.ts

```typescript
import { config } from '@vue/test-utils';
import { vi } from 'vitest';

// Mock router
config.global.mocks = {
  $t: (key: string) => key,
  $route: {
    params: {},
    query: {},
  },
  $router: {
    push: vi.fn(),
    replace: vi.fn(),
  },
};

// Mock localStorage
const localStorageMock = {
  getItem: vi.fn(),
  setItem: vi.fn(),
  removeItem: vi.fn(),
  clear: vi.fn(),
};
global.localStorage = localStorageMock as any;
```

### Dockerfile

```dockerfile
# Stage 1: Build
FROM node:20-alpine AS build

WORKDIR /app

# Install dependencies
COPY package*.json ./
RUN npm ci

# Copy source
COPY . .

# Build
RUN npm run build

# Stage 2: Production
FROM nginx:alpine

# Copy built files
COPY --from=build /app/dist /usr/share/nginx/html

# Copy nginx config
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

### nginx.conf

```nginx
server {
    listen 80;
    server_name localhost;

    root /usr/share/nginx/html;
    index index.html;

    # Gzip compression
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/javascript application/json;

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # SPA fallback
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API proxy (optional)
    location /api/ {
        proxy_pass http://backend:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Cache static assets
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

### docker-compose.yml

```yaml
version: '3.8'

services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3000:80"
    environment:
      - VITE_API_BASE_URL=http://backend:8000/api/v1
    depends_on:
      - backend
    networks:
      - yadopera

networks:
  yadopera:
    driver: bridge
```

---

## まとめ

このドキュメントでは、Phase 2統合ヘルプシステムのFrontend実装を完全に網羅しました。

### 実装内容
1. **型定義**: TypeScript型定義の完全実装
2. **API通信層**: Axios設定 + ヘルプAPI呼び出し
3. **状態管理**: Pinia Store（FAQ・チャット管理）
4. **コンポーネント**: 9個の完全なVueコンポーネント
   - HelpButton（ヘルプボタン）
   - HelpModal（モーダル）
   - FaqSearchBar（検索バー）
   - CategoryFilter（カテゴリフィルタ）
   - FaqList（FAQ一覧）
   - FaqItem（FAQ項目）
   - AiChatPanel（チャットパネル）
   - ChatMessage（チャットメッセージ）
   - RelatedFaqSuggestion（関連FAQ提案）
5. **スタイリング**: Tailwind CSS設定
6. **国際化**: Vue i18n（日本語・英語）
7. **テスト**: Vitest + @vue/test-utils
8. **ビルド設定**: Vite + Docker + Nginx

### 次のステップ
- Backend実装との統合
- E2Eテスト実施
- Staging環境デプロイ
- PoC実施

**実装期間**: Frontend部分は3日間で完了可能
  });

  it('renders button correctly', () => {
    const wrapper = mount(HelpButton);
    expect(wrapper.find('button').exists()).toBe(true);
  });

  it('opens modal when clicked', async () => {
    const wrapper = mount(HelpButton);
    const helpStore = useHelpStore();

    await wrapper.find('button').trigger('click');

    expect(helpStore.isModalOpen).toBe(true);
    expect(helpStore.activeTab).toBe('faq');
  });

  it('displays badge when showBadge prop is true', () => {
    const wrapper = mount(HelpButton, {
      props: {
        showBadge: true,
      },
    });

    expect(wrapper.find('span').exists()).toBe(true);
  });
});
```

### tests/components/help/HelpModal.spec.ts

```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest';
import { mount, flushPromises } from '@vue/test-utils';
import { createPinia, setActivePinia } from 'pinia';
import HelpModal from '@/components/help/HelpModal.vue';
import { useHelpStore } from '@/stores/helpStore';

// Mock API
vi.mock('@/api/help', () => ({
  helpApi: {
    getFaqs: vi.fn(() => Promise.resolve({
      faqs: [
        {
          id: 1,
          category: 'setup',
          question: 'テスト質問',
          answer: 'テスト回答',
          display_order: 100,
        },
      ],
      total: 1,
      categories: ['setup'],
    })),
  },
}));

describe('HelpModal.vue', () => {
  beforeEach(() => {
    setActivePinia(createPinia());
  });

  it('does not render when modal is closed', () => {
    const wrapper = mount(HelpModal);
    const helpStore = useHelpStore();

    helpStore.closeModal();

    expect(wrapper.find('.fixed').exists()).toBe(false);
  });

  it('renders when modal is open', async () => {
    const wrapper = mount(HelpModal);
    const helpStore = useHelpStore();

    helpStore.openModal();
    await flushPromises();

    expect(wrapper.find('.fixed').exists()).toBe(true);
  });

  it('switches tabs correctly', async () => {
    const wrapper = mount(HelpModal);
    const helpStore = useHelpStore();

    helpStore.openModal('faq');
    await flushPromises();

    const buttons = wrapper.findAll('button');
    const chatTabButton = buttons.find((btn) => btn.text().includes('AIチャット'));

    if (chatTabButton) {
      await chatTabButton.trigger('click');
      expect(helpStore.activeTab).toBe('chat');
    }
  });

  it('closes modal when close button is clicked', async () => {
    const wrapper = mount(HelpModal);
    const helpStore = useHelpStore();

    helpStore.openModal();
    await flushPromises();

    const closeButton = wrapper.find('[aria-label="閉じる"]');
    await closeButton.trigger('click');

    expect(helpStore.isModalOpen).toBe(false);
  });
});
```

### tests/components/help/AiChatPanel.spec.ts

```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest';
import { mount, flushPromises } from '@vue/test-utils';
import { createPinia, setActivePinia } from 'pinia';
import AiChatPanel from '@/components/help/AiChatPanel.vue';
import { useHelpStore } from '@/stores/helpStore';

// Mock API
vi.mock('@/api/help', () => ({
  helpApi: {
    sendChatMessage: vi.fn(() => Promise.resolve({
      response: 'AIの回答です',
      related_faqs: [],
      timestamp: new Date().toISOString(),
    })),
  },
}));

describe('AiChatPanel.vue', () => {
  beforeEach(() => {
    setActivePinia(createPinia());# Phase 2: 統合ヘルプシステム - Frontend完全実装ガイド

## ドキュメント情報
- **プロジェクト**: YadOPERA（宿泊施設管理システム）
- **対象フェーズ**: Phase 2 - 統合ヘルプシステム Frontend実装
- **作成日**: 2025年12月27日
- **バージョン**: 1.0
- **依存文書**: help-system-plan.md, help-system-backend.md

---

## 目次

1. [プロジェクト構成](#1-プロジェクト構成)
2. [型定義](#2-型定義)
3. [API通信層](#3-api通信層)
4. [状態管理（Pinia Store）](#4-状態管理pinia-store)
5. [コンポーネント実装](#5-コンポーネント実装)
6. [スタイリング](#6-スタイリング)
7. [国際化（i18n）](#7-国際化i18n)
8. [ルーティング統合](#8-ルーティング統合)
9. [テストコード](#9-テストコード)
10. [ビルド・デプロイ設定](#10-ビルドデプロイ設定)

---

## 1. プロジェクト構成

```
frontend/
├── src/
│   ├── components/
│   │   └── help/
│   │       ├── HelpButton.vue              # 右下固定ヘルプボタン
│   │       ├── HelpModal.vue               # ヘルプモーダル本体
│   │       ├── FaqList.vue                 # FAQ一覧表示
│   │       ├── FaqItem.vue                 # FAQ個別アイテム
│   │       ├── FaqSearchBar.vue            # FAQ検索バー
│   │       ├── CategoryFilter.vue          # カテゴリフィルタ
│   │       ├── AiChatPanel.vue             # AIチャットパネル
│   │       ├── ChatMessage.vue             # チャットメッセージ
│   │       └── RelatedFaqSuggestion.vue    # 関連FAQ提案
│   ├── stores/
│   │   └── helpStore.ts                    # ヘルプシステム状態管理
│   ├── api/
│   │   ├── client.ts                       # Axios設定
│   │   └── help.ts                         # ヘルプAPI呼び出し
│   ├── types/
│   │   └── help.ts                         # 型定義
│   ├── composables/
│   │   └── useHelp.ts                      # ヘルプシステム共通ロジック
│   ├── i18n/
│   │   ├── index.ts                        # i18n設定
│   │   └── locales/
│   │       ├── ja.json                     # 日本語翻訳
│   │       └── en.json                     # 英語翻訳
│   └── App.vue                             # ルートコンポーネント
├── tests/
│   └── components/
│       └── help/
│           ├── HelpButton.spec.ts
│           ├── HelpModal.spec.ts
│           └── AiChatPanel.spec.ts
├── package.json
├── tsconfig.json
├── vite.config.ts
└── tailwind.config.js
```

---

## 2. 型定義

### src/types/help.ts

```typescript
/**
 * ヘルプシステム型定義
 */

/**
 * FAQカテゴリ
 */
export type FaqCategory = 
  | 'setup'
  | 'qrcode'
  | 'faq_management'
  | 'ai_logic'
  | 'logs'
  | 'troubleshooting'
  | 'billing'
  | 'security';

/**
 * FAQ項目
 */
export interface Faq {
  id: number;
  category: FaqCategory;
  question: string;
  answer: string;
  keywords?: string;
  related_url?: string;
  display_order: number;
  relevance_score?: number;
}

/**
 * FAQリストレスポンス
 */
export interface FaqListResponse {
  faqs: Faq[];
  total: number;
  categories: string[];
}

/**
 * FAQ検索レスポンス
 */
export interface FaqSearchResponse {
  results: Faq[];
  total: number;
  query: string;
}

/**
 * チャットメッセージタイプ
 */
export type MessageRole = 'user' | 'assistant';

/**
 * チャットメッセージ
 */
export interface ChatMessage {
  id: string;
  role: MessageRole;
  content: string;
  timestamp: string;
  related_faqs?: RelatedFaq[];
  related_url?: string;
}

/**
 * 関連FAQ
 */
export interface RelatedFaq {
  id: number;
  question: string;
  category: string;
}

/**
 * チャットリクエスト
 */
export interface ChatRequest {
  message: string;
  language: string;
}

/**
 * チャットレスポンス
 */
export interface ChatResponse {
  response: string;
  related_faqs: RelatedFaq[];
  related_url?: string;
  timestamp: string;
}

/**
 * ヘルプモーダルタブ
 */
export type HelpTab = 'faq' | 'chat';

/**
 * カテゴリ情報
 */
export interface CategoryInfo {
  category: FaqCategory;
  count: number;
  label: string;
}
```

---

## 3. API通信層

### src/api/client.ts

```typescript
/**
 * Axios クライアント設定
 */
import axios, { AxiosInstance, AxiosError, InternalAxiosRequestConfig } from 'axios';

const BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8000/api/v1';

/**
 * Axiosインスタンス作成
 */
const apiClient: AxiosInstance = axios.create({
  baseURL: BASE_URL,
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json',
  },
});

/**
 * リクエストインターセプター: JWT認証トークン付与
 */
apiClient.interceptors.request.use(
  (config: InternalAxiosRequestConfig) => {
    const token = localStorage.getItem('access_token');
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error: AxiosError) => {
    return Promise.reject(error);
  }
);

/**
 * レスポンスインターセプター: エラーハンドリング
 */
apiClient.interceptors.response.use(
  (response) => response,
  (error: AxiosError) => {
    if (error.response?.status === 401) {
      // 認証エラー時の処理（ログインページへリダイレクトなど）
      console.error('Unauthorized access');
      // router.push('/login');
    } else if (error.response?.status === 429) {
      // レート制限エラー
      console.error('Rate limit exceeded');
    }
    return Promise.reject(error);
  }
);

export default apiClient;
```

### src/api/help.ts

```typescript
/**
 * ヘルプシステムAPI呼び出し
 */
import apiClient from './client';
import type {
  FaqListResponse,
  FaqSearchResponse,
  ChatRequest,
  ChatResponse,
} from '@/types/help';

/**
 * ヘルプAPI
 */
export const helpApi = {
  /**
   * FAQ一覧取得
   */
  async getFaqs(params?: {
    category?: string;
    language?: string;
  }): Promise<FaqListResponse> {
    const response = await apiClient.get<FaqListResponse>('/help/faqs', {
      params: {
        language: params?.language || 'ja',
        ...(params?.category && { category: params.category }),
      },
    });
    return response.data;
  },

  /**
   * FAQ検索
   */
  async searchFaqs(params: {
    query: string;
    language?: string;
    limit?: number;
  }): Promise<FaqSearchResponse> {
    const response = await apiClient.get<FaqSearchResponse>('/help/search', {
      params: {
        q: params.query,
        language: params.language || 'ja',
        limit: params.limit || 10,
      },
    });
    return response.data;
  },

  /**
   * AIチャット送信
   */
  async sendChatMessage(request: ChatRequest): Promise<ChatResponse> {
    const response = await apiClient.post<ChatResponse>('/help/chat', request);
    return response.data;
  },
};
```

---

## 4. 状態管理（Pinia Store）

### src/stores/helpStore.ts

```typescript
/**
 * ヘルプシステム状態管理
 */
import { defineStore } from 'pinia';
import { ref, computed } from 'vue';
import type {
  Faq,
  ChatMessage,
  FaqCategory,
  HelpTab,
  CategoryInfo,
} from '@/types/help';
import { helpApi } from '@/api/help';

export const useHelpStore = defineStore('help', () => {
  // State
  const isModalOpen = ref(false);
  const activeTab = ref<HelpTab>('faq');
  const faqs = ref<Faq[]>([]);
  const filteredFaqs = ref<Faq[]>([]);
  const categories = ref<string[]>([]);
  const selectedCategory = ref<string | null>(null);
  const searchQuery = ref('');
  const chatMessages = ref<ChatMessage[]>([]);
  const isLoading = ref(false);
  const isSending = ref(false);
  const error = ref<string | null>(null);
  const currentLanguage = ref('ja');

  // Computed
  const categoryInfoList = computed<CategoryInfo[]>(() => {
    const categoryLabels: Record<FaqCategory, string> = {
      setup: '初期設定',
      qrcode: 'QRコード',
      faq_management: 'FAQ管理',
      ai_logic: 'AI仕組み',
      logs: 'ログ分析',
      troubleshooting: 'トラブルシューティング',
      billing: '料金',
      security: 'セキュリティ',
    };

    return categories.value.map((cat) => {
      const count = faqs.value.filter((faq) => faq.category === cat).length;
      return {
        category: cat as FaqCategory,
        count,
        label: categoryLabels[cat as FaqCategory] || cat,
      };
    });
  });

  const hasMessages = computed(() => chatMessages.value.length > 0);

  // Actions
  const openModal = (tab: HelpTab = 'faq') => {
    isModalOpen.value = true;
    activeTab.value = tab;
  };

  const closeModal = () => {
    isModalOpen.value = false;
  };

  const switchTab = (tab: HelpTab) => {
    activeTab.value = tab;
  };

  /**
   * FAQ一覧取得
   */
  const fetchFaqs = async (category?: string) => {
    isLoading.value = true;
    error.value = null;

    try {
      const response = await helpApi.getFaqs({
        category,
        language: currentLanguage.value,
      });

      faqs.value = response.faqs;
      filteredFaqs.value = response.faqs;
      categories.value = response.categories;
    } catch (err) {
      error.value = 'FAQの取得に失敗しました';
      console.error('Failed to fetch FAQs:', err);
    } finally {
      isLoading.value = false;
    }
  };

  /**
   * FAQ検索
   */
  const searchFaqs = async (query: string) => {
    if (!query || query.trim().length < 2) {
      filteredFaqs.value = faqs.value;
      searchQuery.value = '';
      return;
    }

    isLoading.value = true;
    error.value = null;
    searchQuery.value = query;

    try {
      const response = await helpApi.searchFaqs({
        query,
        language: currentLanguage.value,
      });

      filteredFaqs.value = response.results;
    } catch (err) {
      error.value = '検索に失敗しました';
      console.error('Failed to search FAQs:', err);
    } finally {
      isLoading.value = false;
    }
  };

  /**
   * カテゴリフィルタ適用
   */
  const filterByCategory = (category: string | null) => {
    selectedCategory.value = category;
    searchQuery.value = '';

    if (!category) {
      filteredFaqs.value = faqs.value;
    } else {
      filteredFaqs.value = faqs.value.filter((faq) => faq.category === category);
    }
  };

  /**
   * チャットメッセージ送信
   */
  const sendChatMessage = async (message: string) => {
    if (!message.trim()) return;

    isSending.value = true;
    error.value = null;

    // ユーザーメッセージ追加
    const userMessage: ChatMessage = {
      id: `user-${Date.now()}`,
      role: 'user',
      content: message,
      timestamp: new Date().toISOString(),
    };
    chatMessages.value.push(userMessage);

    try {
      const response = await helpApi.sendChatMessage({
        message,
        language: currentLanguage.value,
      });

      // AIメッセージ追加
      const aiMessage: ChatMessage = {
        id: `assistant-${Date.now()}`,
        role: 'assistant',
        content: response.response,
        timestamp: response.timestamp,
        related_faqs: response.related_faqs,
        related_url: response.related_url,
      };
      chatMessages.value.push(aiMessage);
    } catch (err) {
      error.value = 'メッセージの送信に失敗しました';
      console.error('Failed to send message:', err);

      // エラーメッセージ追加
      const errorMessage: ChatMessage = {
        id: `error-${Date.now()}`,
        role: 'assistant',
        content: '申し訳ございません。一時的にエラーが発生しました。',
        timestamp: new Date().toISOString(),
      };
      chatMessages.value.push(errorMessage);
    } finally {
      isSending.value = false;
    }
  };

  /**
   * チャット履歴クリア
   */
  const clearChatHistory = () => {
    chatMessages.value = [];
  };

  /**
   * 言語切り替え
   */
  const changeLanguage = async (lang: string) => {
    currentLanguage.value = lang;
    await fetchFaqs(selectedCategory.value || undefined);
  };

  /**
   * 初期化
   */
  const initialize = async () => {
    await fetchFaqs();
  };

  return {
    // State
    isModalOpen,
    activeTab,
    faqs,
    filteredFaqs,
    categories,
    selectedCategory,
    searchQuery,
    chatMessages,
    isLoading,
    isSending,
    error,
    currentLanguage,

    // Computed
    categoryInfoList,
    hasMessages,

    // Actions
    openModal,
    closeModal,
    switchTab,
    fetchFaqs,
    searchFaqs,
    filterByCategory,
    sendChatMessage,
    clearChatHistory,
    changeLanguage,
    initialize,
  };
});
```

---

## 5. コンポーネント実装

### src/components/help/HelpButton.vue

```vue
<template>
  <Teleport to="body">
    <button
      @click="handleClick"
      class="fixed bottom-6 right-6 z-50 group"
      aria-label="ヘルプ"
      title="ヘルプを表示"
    >
      <div
        class="
          flex items-center justify-center
          w-14 h-14 rounded-full
          bg-indigo-600 hover:bg-indigo-700
          text-white shadow-lg hover:shadow-xl
          transition-all duration-200
          group-hover:scale-110
        "
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
      </div>

      <!-- バッジ（新着通知など） -->
      <span
        v-if="showBadge"
        class="
          absolute -top-1 -right-1
          flex items-center justify-center
          w-5 h-5 rounded-full
          bg-red-500 text-white text-xs font-bold
        "
      >
        !
      </span>
    </button>
  </Teleport>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { useHelpStore } from '@/stores/helpStore';

const helpStore = useHelpStore();

// Props
interface Props {
  showBadge?: boolean;
}

withDefaults(defineProps<Props>(), {
  showBadge: false,
});

// Methods
const handleClick = () => {
  helpStore.openModal('faq');
};
</script>
```

### src/components/help/HelpModal.vue

```vue
<template>
  <Teleport to="body">
    <Transition name="modal">
      <div
        v-if="helpStore.isModalOpen"
        class="fixed inset-0 z-50 overflow-y-auto"
        @click.self="handleClose"
      >
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity" />

        <!-- Modal -->
        <div class="flex min-h-screen items-center justify-center p-4">
          <div
            class="
              relative w-full max-w-4xl
              bg-white rounded-lg shadow-2xl
              transform transition-all
            "
            @click.stop
          >
            <!-- Header -->
            <div class="flex items-center justify-between px-6 py-4 border-b">
              <h2 class="text-xl font-semibold text-gray-900">
                {{ t('help.title') }}
              </h2>
              <button
                @click="handleClose"
                class="
                  p-2 rounded-lg
                  text-gray-400 hover:text-gray-600 hover:bg-gray-100
                  transition-colors
                "
                aria-label="閉じる"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  />
                </svg>
              </button>
            </div>

            <!-- Tabs -->
            <div class="flex border-b">
              <button
                @click="helpStore.switchTab('faq')"
                :class="[
                  'flex-1 px-6 py-3 text-sm font-medium transition-colors',
                  helpStore.activeTab === 'faq'
                    ? 'text-indigo-600 border-b-2 border-indigo-600'
                    : 'text-gray-500 hover:text-gray-700',
                ]"
              >
                {{ t('help.tabs.faq') }}
              </button>
              <button
                @click="helpStore.switchTab('chat')"
                :class="[
                  'flex-1 px-6 py-3 text-sm font-medium transition-colors',
                  helpStore.activeTab === 'chat'
                    ? 'text-indigo-600 border-b-2 border-indigo-600'
                    : 'text-gray-500 hover:text-gray-700',
                ]"
              >
                {{ t('help.tabs.chat') }}
              </button>
            </div>

            <!-- Content -->
            <div class="h-[600px] overflow-hidden">
              <!-- FAQ Tab -->
              <div v-show="helpStore.activeTab === 'faq'" class="h-full">
                <div class="p-6 space-y-4">
                  <!-- Search Bar -->
                  <FaqSearchBar />

                  <!-- Category Filter -->
                  <CategoryFilter />

                  <!-- FAQ List -->
                  <FaqList />
                </div>
              </div>

              <!-- Chat Tab -->
              <div v-show="helpStore.activeTab === 'chat'" class="h-full">
                <AiChatPanel />
              </div>
            </div>
          </div>
        </div>
      </div>
    </Transition>
  </Teleport>
</template>

<script setup lang="ts">
import { onMounted } from 'vue';
import { useI18n } from 'vue-i18n';
import { useHelpStore } from '@/stores/helpStore';
import FaqSearchBar from './FaqSearchBar.vue';
import CategoryFilter from './CategoryFilter.vue';
import FaqList from './FaqList.vue';
import AiChatPanel from './AiChatPanel.vue';

const { t } = useI18n();
const helpStore = useHelpStore();

// Lifecycle
onMounted(async () => {
  await helpStore.initialize();
});

// Methods
const handleClose = () => {
  helpStore.closeModal();
};
</script>

<style scoped>
.modal-enter-active,
.modal-leave-active {
  transition: opacity 0.3s ease;
}

.modal-enter-from,
.modal-leave-to {
  opacity: 0;
}
</style>
```

### src/components/help/FaqSearchBar.vue

```vue
<template>
  <div class="relative">
    <div class="relative">
      <input
        v-model="localQuery"
        type="text"
        :placeholder="t('help.search.placeholder')"
        class="
          w-full px-4 py-3 pl-11
          border border-gray-300 rounded-lg
          focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent
          transition-all
        "
        @input="handleInput"
        @keyup.enter="handleSearch"
      />
      <div class="absolute left-3 top-3.5 text-gray-400">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          />
        </svg>
      </div>

      <!-- Clear Button -->
      <button
        v-if="localQuery"
        @click="handleClear"
        class="
          absolute right-3 top-3
          p-1 rounded-full
          text-gray-400 hover:text-gray-600 hover:bg-gray-100
          transition-colors
        "
        aria-label="クリア"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    </div>

    <!-- Search Results Count -->
    <div v-if="helpStore.searchQuery && !helpStore.isLoading" class="mt-2 text-sm text-gray-600">
      {{ t('help.search.results', { count: helpStore.filteredFaqs.length }) }}
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, watch } from 'vue';
import { useI18n } from 'vue-i18n';
import { useHelpStore } from '@/stores/helpStore';
import { useDebounceFn } from '@vueuse/core';

const { t } = useI18n();
const helpStore = useHelpStore();

// State
const localQuery = ref('');

// Debounced search
const debouncedSearch = useDebounceFn(async (query: string) => {
  await helpStore.searchFaqs(query);
}, 300);

// Methods
const handleInput = () => {
  debouncedSearch(localQuery.value);
};

const handleSearch = async () => {
  await helpStore.searchFaqs(localQuery.value);
};

const handleClear = async () => {
  localQuery.value = '';
  await helpStore.searchFaqs('');
};

// Watch store searchQuery changes
watch(
  () => helpStore.searchQuery,
  (newQuery) => {
    if (newQuery !== localQuery.value) {
      localQuery.value = newQuery;
    }
  }
);
</script>
```

### src/components/help/CategoryFilter.vue

```vue
<template>
  <div class="flex flex-wrap gap-2">
    <!-- All Categories -->
    <button
      @click="handleSelectCategory(null)"
      :class="[
        'px-4 py-2 rounded-full text-sm font-medium transition-all',
        !helpStore.selectedCategory
          ? 'bg-indigo-600 text-white'
          : 'bg-gray-100 text-gray-700 hover:bg-gray-200',
      ]"
    >
      {{ t('help.categories.all') }}
      <span class="ml-1 text-xs opacity-75">({{ totalCount }})</span>
    </button>

    <!-- Category Buttons -->
    <button
      v-for="categoryInfo in helpStore.categoryInfoList"
      :key="categoryInfo.category"
      @click="handleSelectCategory(categoryInfo.category)"
      :class="[
        'px-4 py-2 rounded-full text-sm font-medium transition-all',
        helpStore.selectedCategory === categoryInfo.category
          ? 'bg-indigo-600 text-white'
          : 'bg-gray-100 text-gray-700 hover:bg-gray-200',
      ]"
    >
      {{ categoryInfo.label }}
      <span class="ml-1 text-xs opacity-75">({{ categoryInfo.count }})</span>
    </button>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { useI18n } from 'vue-i18n';
import { useHelpStore } from '@/stores/helpStore';

const { t } = useI18n();
const helpStore = useHelpStore();

// Computed
const totalCount = computed(() => helpStore.faqs.length);

// Methods
const handleSelectCategory = (category: string | null) => {
  helpStore.filterByCategory(category);
};
</script>
```

### src/components/help/FaqList.vue

```vue
<template>
  <div class="h-[400px] overflow-y-auto">
    <!-- Loading -->
    <div v-if="helpStore.isLoading" class="flex items-center justify-center h-full">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
    </div>

    <!-- Error -->
    <div v-else-if="helpStore.error" class="flex items-center justify-center h-full">
      <div class="text-center">
        <p class="text-red-600 mb-4">{{ helpStore.error }}</p>
        <button
          @click="handleRetry"
          class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
        >
          {{ t('help.faq.retry') }}
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div
      v-else-if="helpStore.filteredFaqs.length === 0"
      class="flex flex-col items-center justify-center h-full text-gray-500"
    >
        <path