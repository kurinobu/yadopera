# Phase 2: Docker再テスト準備 - 詳細テスト項目

**作成日時**: 2025年12月13日  
**調査者**: AI Assistant  
**目的**: 過去の詳細なテスト内容を調査分析し、Dockerを使った再テストの準備を行う

---

## 1. 過去のテスト内容の調査分析結果

### 1.1 管理画面ブラウザテスト詳細手順書（Phase 1）

**参照**: `docs/Phase1/Phase1_管理画面ブラウザテスト_詳細手順書.md`

**詳細なテスト項目**:

#### 1. FAQ管理画面（優先度: 高、既知の問題あり）

**テスト手順**:
1. **FAQ管理画面へのアクセス**
   - 管理画面にログイン（`test@example.com` / `testpassword123`）
   - サイドバーまたはナビゲーションメニューから「FAQ管理」をクリック
   - FAQ管理画面が表示されることを確認

2. **FAQ一覧の表示確認**
   - FAQ一覧が表示されていることを確認
   - 各FAQに以下の情報が表示されていることを確認：
     - 質問文
     - 回答文
     - カテゴリ
     - 優先度
     - 編集ボタン
     - 削除ボタン

3. **FAQ追加の動作確認**
   - 「+ 新規FAQ追加」ボタンをクリック
   - FAQ追加フォームが表示されることを確認
   - 以下の情報を入力：
     - **質問**: "What time is check-in?"
     - **回答**: "Check-in time is from 3:00 PM to 10:00 PM."
     - **カテゴリ**: "basic"（基本情報）
     - **優先度**: 1（デフォルト）
     - **言語**: "en"（英語）
     - **有効/無効**: 有効（デフォルト）
   - 「保存」ボタンをクリック
   - ローディング表示が表示されることを確認
   - 成功メッセージが表示されることを確認
   - FAQ一覧に新規FAQが追加されることを確認

4. **埋め込みベクトル自動生成の動作確認**
   - ブラウザの開発者ツールを開く
   - ネットワークタブを開く
   - FAQ追加を実行
   - ネットワークタブで `POST /api/v1/admin/faqs` リクエストを確認
   - APIレスポンスを確認
   - データベースで埋め込みベクトルを確認：
     ```bash
     docker-compose exec postgres psql -U yadopera_user -d yadopera -c "SELECT id, question, answer, embedding IS NOT NULL as has_embedding FROM faqs WHERE question = 'What time is check-in?' ORDER BY id DESC LIMIT 1;"
     ```

5. **FAQ編集の動作確認（既知の問題あり）**
   - FAQ一覧から任意のFAQを選択
   - 「編集」ボタンをクリック
   - FAQ編集フォームが表示されることを確認
   - 既存の情報が正しく表示されることを確認
   - 回答文を変更（例: "Check-in time is from 2:00 PM to 11:00 PM."）
   - 「保存」ボタンをクリック
   - 編集後にFAQ一覧が更新されることを確認
   - 埋め込みベクトルが自動再生成されることを確認

6. **FAQ削除の動作確認（既知の問題あり）**
   - FAQ一覧から任意のFAQを選択
   - 「削除」ボタンをクリック
   - 確認モーダルが表示されることを確認
   - 「はい」をクリック
   - 削除後にFAQ一覧から該当FAQが消えることを確認
   - 成功メッセージが表示されることを確認

#### 2. 施設設定画面（優先度: 高、実装完了済み）

**テスト手順**:
1. **施設設定画面へのアクセス**
   - 管理画面にログイン
   - サイドバーまたはナビゲーションメニューから「施設設定」をクリック
   - 施設設定画面が表示されることを確認

2. **基本情報の表示確認**
   - 基本情報セクションが表示されることを確認
   - 以下の情報が表示されていることを確認：
     - 施設名
     - メールアドレス
     - 電話番号
     - 住所
     - WiFiパスワード
     - チェックイン時間
     - チェックアウト時間

3. **基本情報の編集確認**
   - 施設名を変更（例: "やどぺらゲストハウス" → "やどぺらゲストハウス（テスト）"）
   - 「保存」ボタンをクリック
   - ローディング表示が表示されることを確認
   - 成功メッセージが表示されることを確認
   - 変更が保存されることを確認（画面を再読み込みして確認）

4. **スタッフ不在時間帯設定の確認**
   - スタッフ不在時間帯設定セクションが表示されることを確認
   - 既存の時間帯が表示されていることを確認（デフォルト: 22:00-8:00）
   - 「時間帯を追加」ボタンをクリック
   - 新しい時間帯を追加：
     - **開始時刻**: 12:00
     - **終了時刻**: 14:00
     - **曜日**: 月曜日〜金曜日
   - 「保存」ボタンをクリック
   - 成功メッセージが表示されることを確認
   - 追加した時間帯が表示されることを確認

5. **パスワード変更の確認**
   - パスワード変更セクションが表示されることを確認
   - 以下の情報を入力：
     - **現在のパスワード**: `testpassword123`
     - **新しいパスワード**: `newpassword123`
     - **新しいパスワード（確認）**: `newpassword123`
   - 「パスワードを変更」ボタンをクリック
   - ローディング表示が表示されることを確認
   - 成功メッセージが表示されることを確認
   - ログアウトして、新しいパスワードでログインできることを確認

#### 3. FAQ自動学習UI（優先度: 中、既知の問題あり）

**テスト手順**:
1. **未解決質問リストの表示確認**
   - FAQ管理画面にアクセス
   - 「未解決質問リスト」セクションが表示されることを確認
   - 未解決質問が表示されていることを確認（テストデータがある場合）
   - 各質問に以下の情報が表示されることを確認：
     - 質問内容
     - 言語
     - 日時
     - 信頼度スコア
     - 「FAQ追加」ボタン

2. **FAQ追加ボタンの動作確認（既知の問題あり）**
   - 未解決質問リストから任意の質問を選択
   - 「FAQ追加」ボタンをクリック
   - FAQ追加提案カードが表示されることを確認
   - 以下の情報が自動入力されることを確認：
     - **質問文**: 未解決質問の内容が自動入力される
     - **回答文**: 回答テンプレートが自動生成される（GPT-4o miniを使用）
     - **カテゴリ**: カテゴリが自動推定される

3. **回答テンプレート自動生成の確認**
   - ステップ2でFAQ追加提案カードが表示された状態で確認
   - 回答文フィールドに回答テンプレートが自動生成されることを確認
   - 回答テンプレートが適切な内容であることを確認（質問に関連した回答である）
   - 回答テンプレートを編集できることを確認

#### 4. スタッフ不在時間帯対応キューUI（優先度: 中）

**テスト手順**:
1. **スタッフ不在時間帯対応キューUIへのアクセス**
   - 管理画面にログイン
   - サイドバーまたはナビゲーションメニューから「スタッフ不在時間帯対応キュー」をクリック
   - スタッフ不在時間帯対応キューUIが表示されることを確認

2. **キュー一覧の表示確認**
   - キュー一覧が表示されることを確認
   - 各キューアイテムに以下の情報が表示されていることを確認：
     - 質問内容
     - 言語
     - 日時
     - 対応予定時刻（スタッフ不在時間帯の終了時刻）
     - 「対応済み」ボタン

3. **キュー解決処理の確認**
   - 未解決のキューアイテムを選択
   - 「対応済み」ボタンをクリック
   - 確認モーダルが表示されることを確認（表示される場合）
   - 「はい」をクリック（確認モーダルが表示された場合）
   - ローディング表示が表示されることを確認
   - 成功メッセージが表示されることを確認
   - キュー一覧から該当キューアイテムが消える（または「対応済み」マークが表示される）ことを確認

#### 5. QRコード生成UI（優先度: 中）

**テスト手順**:
1. **QRコード生成UIへのアクセス**
   - 管理画面にログイン
   - サイドバーまたはナビゲーションメニューから「QRコード生成」をクリック
   - QRコード生成UIが表示されることを確認

2. **QRコード生成フォームの確認**
   - QRコード生成フォームが表示されることを確認
   - 以下のオプションが表示されていることを確認：
     - **設置場所**: ドロップダウンメニュー（entrance, room, kitchen, lounge, custom）
     - **カスタム設置場所名**: テキスト入力（custom選択時）
     - **セッション統合トークン埋め込み**: チェックボックス
     - **形式**: ラジオボタン（PDF, PNG, SVG）

3. **QRコード生成の確認（基本）**
   - 設置場所を選択（例: "entrance"）
   - 形式を選択（例: "PDF"）
   - 「QRコード生成」ボタンをクリック
   - ローディング表示が表示されることを確認
   - 成功メッセージが表示されることを確認
   - 生成済みQRコード一覧に新規QRコードが追加されることを確認

4. **QRコードダウンロードの確認**
   - 生成済みQRコード一覧から任意のQRコードを選択
   - 「ダウンロード」ボタン（または形式別のダウンロードボタン）をクリック
   - ファイルがダウンロードされることを確認
   - ダウンロードしたファイルを開いて、QRコードが正しく表示されることを確認
   - QRコードをスキャンすると正しいURLにアクセスできることを確認

5. **セッション統合トークン埋め込みオプションの確認**
   - QRコード生成フォームで「セッション統合トークン埋め込み」にチェックを入れる
   - 設置場所を選択（例: "entrance"）
   - 形式を選択（例: "PDF"）
   - 「QRコード生成」ボタンをクリック
   - 生成済みQRコード一覧に新規QRコードが追加されることを確認
   - ダウンロードしたQRコードをスキャン
   - URLにセッション統合トークンが含まれていることを確認（例: `?token=AB12`）

#### 6. ゲストフィードバック統計（優先度: 低）

**テスト手順**:
1. **ゲストフィードバック統計へのアクセス**
   - 管理画面にログイン
   - ダッシュボードにアクセス
   - 「ゲストフィードバック集計」セクションが表示されることを確認

2. **フィードバック集計の表示確認**
   - フィードバック集計セクションが表示されることを確認
   - 以下の情報が表示されていることを確認：
     - **総フィードバック数**: 総数（👍 + 👎）
     - **肯定率**: 👍 / (👍 + 👎) × 100
     - **否定率**: 👎 / (👍 + 👎) × 100
     - **円グラフまたは棒グラフ**: フィードバックの分布

3. **低評価回答一覧の表示確認**
   - 低評価回答一覧セクションが表示されることを確認
   - 低評価回答（👎評価が2回以上ついた回答）が表示されることを確認
   - 各低評価回答に以下の情報が表示されていることを確認：
     - 質問内容
     - 回答内容
     - 低評価数（👎の数）
     - 「FAQ改善提案」ボタン（または「対応する」ボタン）

4. **FAQ改善提案の確認（オプション）**
   - 低評価回答一覧から任意の回答を選択
   - 「FAQ改善提案」ボタンをクリック
   - FAQ改善提案カードが表示されることを確認
   - 改善提案が自動生成されることを確認（GPT-4o miniを使用）

---

### 1.2 ゲスト画面の動作確認（Phase 2管理画面・ゲスト画面動作確認レポートより）

**参照**: `docs/Phase2/Phase2_管理画面・ゲスト画面動作確認レポート.md`

**詳細なテスト項目**:

#### 1. 言語選択画面

**確認項目**:
- [ ] 言語選択画面が正常に表示される

#### 2. ウェルカム画面

**確認項目**:
- [ ] ウェルカム画面が正常に表示される
- [ ] よくある質問TOP3が表示される
- [ ] フリー入力欄が表示される
- [ ] 緊急連絡先が表示される

#### 3. チャット画面

**確認項目**:
- [ ] チャット画面が正常に表示される
- [ ] チャット形式で表示される
- [ ] PWA対応が正常に動作する
- [ ] ダークモードが正常に動作する
- [ ] 固定フッターが正常に表示される

#### 4. AI対話

**確認項目**:
- [ ] テスト質問を送信し、AI回答が返ってくる
- [ ] レスポンス時間が3秒以内である
- [ ] RAG統合型AI応答が正常に動作する

**テスト質問例**:
- "What time is check-in?"
- "Where is the WiFi password?"

#### 5. ゲストフィードバックUI

**確認項目**:
- [ ] ゲストフィードバックUI（👍👎）が正常に動作する

#### 6. セッション統合トークン

**確認項目**:
- [ ] 4桁英数字トークンが表示される
- [ ] トークン入力でセッション統合が正常に動作する

#### 7. ダークモード切替

**確認項目**:
- [ ] ダークモード切替が正常に動作する

#### 8. PWAインストールプロンプト

**確認項目**:
- [ ] PWAインストールプロンプトが正常に表示される

---

## 2. 再テストの準備

### 2.1 テスト環境の確認

**Docker Composeの状態**:
- ✅ postgres: 正常稼働中（healthy）
- ✅ redis: 正常稼働中（healthy）
- ✅ backend: 正常稼働中
- ✅ frontend: 正常稼働中

**確認コマンド**:
```bash
docker-compose ps
docker-compose logs backend --tail 50
docker-compose logs frontend --tail 50
```

### 2.2 CORSエラーの確認

**確認方法**:
1. ブラウザで `http://localhost:5173/admin/login` にアクセス
2. ブラウザの開発者ツール（Consoleタブ）でCORSエラーが発生していないか確認
3. NetworkタブでAPIリクエストが正常に送信されているか確認

**期待される結果**:
- CORSエラーが発生しない
- APIリクエストが正常に送信される

### 2.3 テストユーザー情報

**管理画面ログイン用**:
- メールアドレス: `test@example.com`
- パスワード: `testpassword123`
- ログインURL: `http://localhost:5173/admin/login`

**ゲスト画面用**:
- 施設slug: `test-facility`
- ゲスト画面URL: `http://localhost:5173/f/test-facility?location=entrance`

---

## 3. 再テスト実施手順

### 3.1 ステップ1: CORSエラーの確認

1. ブラウザで `http://localhost:5173/admin/login` にアクセス
2. ブラウザの開発者ツール（Consoleタブ）でCORSエラーが発生していないか確認
3. NetworkタブでAPIリクエストが正常に送信されているか確認

### 3.2 ステップ2: ログイン機能のテスト

1. ログイン画面にアクセス（`http://localhost:5173/admin/login`）
2. ログイン処理が正常に動作するか確認（`test@example.com` / `testpassword123`）
3. JWT認証が正常に動作するか確認
4. ログイン成功後にダッシュボードにリダイレクトされるか確認

### 3.3 ステップ3: 管理画面の詳細テスト

上記の「1.1 管理画面ブラウザテスト詳細手順書」に記載されている詳細なテスト項目を実施

### 3.4 ステップ4: ゲスト画面の詳細テスト

上記の「1.2 ゲスト画面の動作確認」に記載されている詳細なテスト項目を実施

---

## 4. テスト結果の記録

### 4.1 記録項目

各テスト項目について、以下の情報を記録してください：

- **実施日時**: テストを実施した日時
- **テスト結果**: ✅完了 / ❌未完了 / ⚠️問題あり
- **問題点**: 問題が発生した場合、詳細を記録
- **スクリーンショット**: 必要に応じてスクリーンショットを撮影

### 4.2 問題が発生した場合の対応

1. **問題の詳細を記録**
   - 問題の症状
   - 発生条件
   - エラーメッセージ（コンソール、ネットワークタブ）
   - スクリーンショット

2. **調査分析を実施**
   - ブラウザの開発者ツールでエラーを確認
   - ネットワークタブでAPIリクエスト/レスポンスを確認
   - バックエンドのログを確認

3. **修正を実施**（指示がある場合）
   - 問題の根本原因を特定
   - 修正を実施
   - 再テストを実施

---

**状態**: ✅ **過去の詳細なテスト内容を調査分析完了 → Dockerを使った再テストの準備完了**
