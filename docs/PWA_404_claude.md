\# Phase 1ãƒ»Phase 2: PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã®èµ·å‹•æ™‚404ã‚¨ãƒ©ãƒ¼ èª¿æŸ»åˆ†æå ±å‘Šæ›¸ãƒ»ä¿®æ­£æ¡ˆ

\*\*ä½œæˆæ—¥æ™‚\*\*: 2025å¹´12æœˆ22æ—¥ 16æ™‚30åˆ†00ç§’    
\*\*ä½œæˆè€…\*\*: Claude (Anthropic)    
\*\*ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ\*\*: YadOPERA \- å°è¦æ¨¡å®¿æ³Šæ–½è¨­å‘ã‘AIå¤šè¨€èªè‡ªå‹•æ¡ˆå†…ã‚·ã‚¹ãƒ†ãƒ     
\*\*å¯¾è±¡ãƒ•ã‚§ãƒ¼ã‚º\*\*: Phase 2ï¼ˆPoCæº–å‚™ï¼‰ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ    
\*\*ç·Šæ€¥åº¦\*\*: ğŸ”´ \*\*æœ€é«˜ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä¾¡å€¤ãŒæš´è½ã—ã¦ã„ã‚‹çŠ¶æ…‹ï¼‰\*\*

\---

\#\# ğŸ“‹ ç›®æ¬¡

1\. \[ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼\](\#1-ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼)  
2\. \[å•é¡Œã®æ¦‚è¦\](\#2-å•é¡Œã®æ¦‚è¦)  
3\. \[èª¿æŸ»åˆ†æçµæœ\](\#3-èª¿æŸ»åˆ†æçµæœ)  
4\. \[æ ¹æœ¬åŸå› ã®ç‰¹å®š\](\#4-æ ¹æœ¬åŸå› ã®ç‰¹å®š)  
5\. \[æ¨å¥¨ä¿®æ­£æ¡ˆ\](\#5-æ¨å¥¨ä¿®æ­£æ¡ˆ)  
6\. \[ä¿®æ­£æ¡ˆã®å®Ÿè£…æ‰‹é †\](\#6-ä¿®æ­£æ¡ˆã®å®Ÿè£…æ‰‹é †)  
7\. \[æ¤œè¨¼æ–¹æ³•\](\#7-æ¤œè¨¼æ–¹æ³•)  
8\. \[ä»˜éŒ²\](\#8-ä»˜éŒ²)

\---

\#\# 1\. ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

\#\#\# 1.1 å•é¡Œã®æœ¬è³ª

\*\*PWAã®\`start\_url: '/'\`ã¨localStorageä¿å­˜å‡¦ç†ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒæ ¹æœ¬çš„ã«ä¸ä¸€è‡´\*\*

\#\#\# 1.2 æ ¹æœ¬åŸå› 

1\. \*\*è¨­è¨ˆä¸Šã®çŸ›ç›¾\*\*: PWAèµ·å‹•æ™‚ã¯å¸¸ã«\`/\`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŒã€æ–½è¨­URLä¿å­˜ã¯\`/f/:facilityId\`ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ã¿å®Ÿè¡Œã•ã‚Œã‚‹  
2\. \*\*Safari iOSã®åˆ¶ç´„\*\*: \`beforeinstallprompt\`ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãªã„ãŸã‚ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®ä¿å­˜å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œãªã„  
3\. \*\*éåŒæœŸå‡¦ç†ã®ä¸ç¢ºå®Ÿæ€§\*\*: Chrome Androidã§ã‚‚ã€ä¿å­˜å‡¦ç†ãŒå®Œäº†ã™ã‚‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

\#\#\# 1.3 å”¯ä¸€ã®æ ¹æœ¬è§£æ±ºç­–

\*\*PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«\`start\_url\`ã‚’ç¾åœ¨ã®æ–½è¨­URLï¼ˆ\`/f/:facilityId\`ï¼‰ã«å‹•çš„è¨­å®šã™ã‚‹\*\*

\- localStorageã¸ã®ä¾å­˜ã‚’å®Œå…¨ã«æ’é™¤  
\- PWAèµ·å‹•æ™‚ã«ç›´æ¥æ–½è¨­URLã«ã‚¢ã‚¯ã‚»ã‚¹  
\- Safari iOS/Chrome Androidä¸¡å¯¾å¿œ

\#\#\# 1.4 æœŸå¾…ã•ã‚Œã‚‹çµæœ

\- âœ… PWAèµ·å‹•æ™‚ã«404ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„  
\- âœ… ã‚²ã‚¹ãƒˆãŒæœ€å¾Œã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸæ–½è¨­URLã«è‡ªå‹•çš„ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹  
\- âœ… Safari iOSã¨Chrome Androidã®ä¸¡æ–¹ã§æ­£å¸¸ã«å‹•ä½œã™ã‚‹  
\- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’ç¶­æŒ

\---

\#\# 2\. å•é¡Œã®æ¦‚è¦

\#\#\# 2.1 ç¾åœ¨ã®å‹•ä½œãƒ•ãƒ­ãƒ¼ï¼ˆå•é¡Œã®ã‚ã‚‹çŠ¶æ…‹ï¼‰

\`\`\`  
1\. ã‚²ã‚¹ãƒˆãŒãƒ–ãƒ©ã‚¦ã‚¶ã§ /f/347 ã«ã‚¢ã‚¯ã‚»ã‚¹  
2\. PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹  
3\. ã‚²ã‚¹ãƒˆãŒPWAã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
4\. ãƒ›ãƒ¼ãƒ ç”»é¢ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—  
5\. PWAãŒèµ·å‹• â†’ manifest.start\_url ("/") ã«ã‚¢ã‚¯ã‚»ã‚¹  
6\. Service WorkerãŒ /index.html ã‚’è¿”ã™  
7\. Vue RouterãŒåˆæœŸåŒ–ã•ã‚Œã‚‹  
8\. "/" ãƒ«ãƒ¼ãƒˆã® beforeEnter ã‚¬ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹  
9\. localStorage.getItem('last\_facility\_url') ã‚’å®Ÿè¡Œ  
10\. âŒ last\_facility\_url ãŒå­˜åœ¨ã—ãªã„  
11\. âŒ next({ name: 'NotFound' }) ãŒå®Ÿè¡Œã•ã‚Œã‚‹  
12\. âŒ 404ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹  
\`\`\`

\#\#\# 2.2 æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œãƒ•ãƒ­ãƒ¼

\`\`\`  
1\. ã‚²ã‚¹ãƒˆãŒãƒ–ãƒ©ã‚¦ã‚¶ã§ /f/347 ã«ã‚¢ã‚¯ã‚»ã‚¹  
2\. PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹  
3\. ã‚²ã‚¹ãƒˆãŒPWAã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆstart\_url ã‚’ /f/347 ã«è¨­å®šï¼‰  
4\. ãƒ›ãƒ¼ãƒ ç”»é¢ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—  
5\. PWAãŒèµ·å‹• â†’ /f/347 ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹  
6\. âœ… æ–½è¨­ç‹¬è‡ªã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹  
\`\`\`

\---

\#\# 3\. èª¿æŸ»åˆ†æçµæœ

\#\#\# 3.1 æŠ€è¡“ä»•æ§˜ã®ç¢ºèª

\#\#\#\# PWAã®èµ·å‹•ãƒ•ãƒ­ãƒ¼

1\. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒPWAã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—  
2\. ãƒ–ãƒ©ã‚¦ã‚¶ãŒ\`manifest.json\`ã®\`start\_url\`ã‚’èª­ã¿å–ã‚‹  
3\. \`start\_url\`ã§æŒ‡å®šã•ã‚ŒãŸURLã«ãƒŠãƒ“ã‚²ãƒ¼ãƒˆ  
4\. Service WorkerãŒ\`fetch\`ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†  
5\. ãƒ–ãƒ©ã‚¦ã‚¶ãŒ\`index.html\`ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°  
6\. Vue AppãŒåˆæœŸåŒ–ã•ã‚Œã€Vue RouterãŒãƒ«ãƒ¼ãƒˆãƒãƒƒãƒãƒ³ã‚°ã‚’å®Ÿè¡Œ

\#\#\#\# ç¾åœ¨ã®è¨­å®šã®è‡´å‘½çš„ãªå•é¡Œ

\*\*\`manifest.start\_url: '/'\`ã®å•é¡Œ\*\*:  
\- PWAèµ·å‹•æ™‚ã«å¸¸ã«\`/\`ã«ã‚¢ã‚¯ã‚»ã‚¹  
\- \`/\`ãƒ«ãƒ¼ãƒˆã®\`beforeEnter\`ã‚¬ãƒ¼ãƒ‰ãŒlocalStorageã‹ã‚‰æ–½è¨­URLã‚’å–å¾—  
\- \*\*ã—ã‹ã—ã€localStorageã«\`last\_facility\_url\`ã¯å­˜åœ¨ã—ãªã„\*\*

\*\*ãªãœå­˜åœ¨ã—ãªã„ã®ã‹\*\*:  
\- \`router.beforeEach\`ã¯\`/f/:facilityId\`ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ã¿ä¿å­˜å‡¦ç†ã‚’å®Ÿè¡Œ  
\- PWAèµ·å‹•æ™‚ã¯\`/\`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã€ã“ã®æ¡ä»¶ã‚’æº€ãŸã•ãªã„  
\- PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®ä¿å­˜å‡¦ç†ã‚‚ç¢ºå®Ÿã«å®Œäº†ã—ãªã„ï¼ˆå¾Œè¿°ï¼‰

\#\#\# 3.2 localStorageã¸ã®ä¿å­˜ãŒå¤±æ•—ã™ã‚‹ç†ç”±

\#\#\#\# Chrome Androidã®å ´åˆ

\`\`\`  
1\. /f/347 ã«ã‚¢ã‚¯ã‚»ã‚¹  
2\. beforeinstallprompt ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«  
3\. PWAInstallPrompt.vue ã® handleInstall å®Ÿè¡Œé–‹å§‹  
4\. localStorage.setItem('last\_facility\_url', '/f/347') å®Ÿè¡Œ  
5\. deferredPrompt.prompt() å®Ÿè¡Œ  
6\. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º  
7\. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€ã‚’ã‚¿ãƒƒãƒ—  
8\. âŒ å•é¡Œ: æ‰‹é †4ã®ä¿å­˜ãŒå®Œäº†ã™ã‚‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã™ã‚‹å¯èƒ½æ€§  
\`\`\`

\*\*éåŒæœŸå‡¦ç†ã®ä¸ç¢ºå®Ÿæ€§\*\*: JavaScriptã®å®Ÿè¡Œã¨ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒã‚¤ãƒ†ã‚£ãƒ–å‡¦ç†ï¼ˆPWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰ã®é–“ã«ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ãšã‚ŒãŒç™ºç”Ÿã™ã‚‹

\#\#\#\# Safari iOSã®å ´åˆ

\`\`\`  
1\. /f/347 ã«ã‚¢ã‚¯ã‚»ã‚¹  
2\. âŒ beforeinstallprompt ã‚¤ãƒ™ãƒ³ãƒˆã¯ç™ºç«ã—ãªã„ï¼ˆSafari iOSã®ä»•æ§˜ï¼‰  
3\. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œå…±æœ‰ã€â†’ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’æ‰‹å‹•å®Ÿè¡Œ  
4\. âŒ PWAInstallPrompt.vue ã® handleInstall ã¯å®Ÿè¡Œã•ã‚Œãªã„  
5\. âŒ usePWA.ts ã® handleAppInstalled ã¯å®Ÿè¡Œã•ã‚Œãªã„  
6\. âŒ localStorage ã¸ã®ä¿å­˜å‡¦ç†ãŒä¸€åˆ‡å®Ÿè¡Œã•ã‚Œãªã„  
\`\`\`

\*\*Safari iOSã®åˆ¶ç´„\*\*: \`beforeinstallprompt\`ã‚¤ãƒ™ãƒ³ãƒˆãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®JavaScriptå‡¦ç†ã‚’å®Ÿè¡Œã§ããªã„

\#\#\# 3.3 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ­ã‚°ã®åˆ†æçµæœ

\*\*è¦³å¯Ÿã•ã‚ŒãŸäº‹å®Ÿ\*\*:  
1\. \`Error404-\*.js\`ã¨\`Error404-\*.css\`ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹  
2\. Vue RouterãŒ\`NotFound\`ãƒ«ãƒ¼ãƒˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¦ã„ã‚‹è¨¼æ‹   
3\. \`index-\*.js\`ã¯æ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ï¼ˆVue Appã¯åˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹ï¼‰

\*\*å‡¦ç†ãƒ•ãƒ­ãƒ¼ã®æ¨å®š\*\*:  
1\. PWAèµ·å‹• â†’ \`/\`ã«ã‚¢ã‚¯ã‚»ã‚¹  
2\. Service WorkerãŒ\`/index.html\`ã‚’è¿”ã™  
3\. Vue RouterãŒåˆæœŸåŒ–ã•ã‚Œã‚‹  
4\. \`/\`ãƒ«ãƒ¼ãƒˆã®\`beforeEnter\`ã‚¬ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹  
5\. \`localStorage.getItem('last\_facility\_url')\`ãŒ\`null\`ã‚’è¿”ã™  
6\. \`next({ name: 'NotFound' })\`ãŒå®Ÿè¡Œã•ã‚Œã‚‹  
7\. \`Error404.vue\`ãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹

\#\#\# 3.4 ãªãœ\`\[PWA\]\`ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œãªã„ã®ã‹

\*\*æ¨æ¸¬ã•ã‚Œã‚‹åŸå› \*\*:  
1\. \`beforeEnter\`ã‚¬ãƒ¼ãƒ‰ã¯å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ï¼ˆ404ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãŸã‚ï¼‰  
2\. \`console.log('\[PWA\] ãƒ«ãƒ¼ãƒˆã‚¬ãƒ¼ãƒ‰é–‹å§‹...')\`ã‚‚å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹  
3\. ã—ã‹ã—ã€PWAèµ·å‹•æ™‚ã¯é–‹ç™ºè€…ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãŒé–‹ã‹ã‚Œã¦ã„ãªã„ãŸã‚ã€ãƒ­ã‚°ãŒè¨˜éŒ²ã•ã‚Œãªã„  
4\. ã¾ãŸã¯ã€\`next({ name: 'NotFound' })\`ã«ã‚ˆã‚‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã§ãƒ­ã‚°ãŒã‚¯ãƒªã‚¢ã•ã‚Œã‚‹

\---

\#\# 4\. æ ¹æœ¬åŸå› ã®ç‰¹å®š

\#\#\# 4.1 æ ¹æœ¬åŸå› 

\*\*PWAã®è¨­è¨ˆä¸Šã®çŸ›ç›¾ãŒæ ¹æœ¬åŸå› \*\*

\#\#\#\# åŸå› 1: \`start\_url: '/'\`ã¨localStorageä¿å­˜å‡¦ç†ã®ä¸ä¸€è‡´

\- PWAèµ·å‹•æ™‚: å¸¸ã«\`/\`ã«ã‚¢ã‚¯ã‚»ã‚¹  
\- ä¿å­˜å‡¦ç†: \`/f/:facilityId\`ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ã¿å®Ÿè¡Œ  
\- \*\*çµæœ\*\*: PWAèµ·å‹•æ™‚ã«ä¿å­˜å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œãªã„

\#\#\#\# åŸå› 2: PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®ä¿å­˜å‡¦ç†ãŒç¢ºå®Ÿã«å®Œäº†ã—ãªã„

\*\*Chrome Android\*\*:  
\- éåŒæœŸå‡¦ç†ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œ  
\- \`localStorage.setItem()\`ãŒå®Œäº†ã™ã‚‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã™ã‚‹å¯èƒ½æ€§

\*\*Safari iOS\*\*:  
\- \`beforeinstallprompt\`ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãªã„  
\- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®JavaScriptå‡¦ç†ã‚’å®Ÿè¡Œã§ããªã„

\#\#\#\# åŸå› 3: \`beforeEnter\`ã‚¬ãƒ¼ãƒ‰ãŒlocalStorageã«ä¾å­˜

\- \`/\`ãƒ«ãƒ¼ãƒˆã®\`beforeEnter\`ã‚¬ãƒ¼ãƒ‰ãŒlocalStorageã‹ã‚‰\`last\_facility\_url\`ã‚’å–å¾—  
\- å­˜åœ¨ã—ãªã„å ´åˆã€404ãƒ«ãƒ¼ãƒˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ  
\- \*\*ã—ã‹ã—ã€ä¸Šè¨˜ã®åŸå› 1ã¨2ã«ã‚ˆã‚Šã€PWAèµ·å‹•æ™‚ã«localStorageã«\`last\_facility\_url\`ãŒå­˜åœ¨ã—ãªã„\*\*

\#\#\# 4.2 çµè«–

\*\*localStorageãƒ™ãƒ¼ã‚¹ã®è¨­è¨ˆã§ã¯æ ¹æœ¬çš„ã«è§£æ±ºã§ããªã„\*\*

\- ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å•é¡Œ  
\- ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶ç´„ï¼ˆSafari iOSï¼‰  
\- éåŒæœŸå‡¦ç†ã®ä¸ç¢ºå®Ÿæ€§

\*\*å”¯ä¸€ã®æ ¹æœ¬è§£æ±ºç­–\*\*: PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«\`start\_url\`ã‚’æ–½è¨­URLã«å‹•çš„è¨­å®šã—ã€localStorageã¸ã®ä¾å­˜ã‚’æ’é™¤ã™ã‚‹

\---

\#\# 5\. æ¨å¥¨ä¿®æ­£æ¡ˆ

\#\#\# 5.1 ä¿®æ­£æ–¹é‡

\*\*å¤§åŸå‰‡ã«åŸºã¥ãä¿®æ­£æ–¹é‡\*\*:  
1\. \*\*æ ¹æœ¬è§£æ±º \> æš«å®šè§£æ±º\*\*: localStorageã¸ã®ä¾å­˜ã‚’å®Œå…¨ã«æ’é™¤  
2\. \*\*ã‚·ãƒ³ãƒ—ãƒ«æ§‹é€  \> è¤‡é›‘æ§‹é€ \*\*: \`/\`ãƒ«ãƒ¼ãƒˆã®è¤‡é›‘ãª\`beforeEnter\`ã‚¬ãƒ¼ãƒ‰ã‚’å‰Šé™¤  
3\. \*\*å®‰å…¨ã§ç¢ºå®Ÿ \> æ€¥ã„ã§ä¸ç¢ºå®Ÿ\*\*: ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶ç´„ã«å½±éŸ¿ã•ã‚Œãªã„è¨­è¨ˆ

\#\#\# 5.2 æ¨å¥¨ä¿®æ­£æ¡ˆ: å‹•çš„manifestã«ã‚ˆã‚‹æ ¹æœ¬è§£æ±º

\#\#\#\# æ¦‚è¦

\*\*ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ\*\*: PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ã€ç¾åœ¨ã‚¢ã‚¯ã‚»ã‚¹ä¸­ã®æ–½è¨­URLï¼ˆ\`/f/:facilityId\`ï¼‰ã‚’\`manifest.start\_url\`ã«å‹•çš„è¨­å®š

\*\*å®Ÿè£…ã®æ ¸å¿ƒ\*\*:  
\- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å‹•çš„ã«manifestã‚’ç”Ÿæˆ  
\- Blob URLã‚’ä½¿ç”¨ã—ã¦manifest linkã‚¿ã‚°ã‚’æ›´æ–°  
\- PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«è‡ªå‹•çš„ã«æ–½è¨­URLãŒ\`start\_url\`ã«è¨­å®šã•ã‚Œã‚‹

\*\*ãƒ¡ãƒªãƒƒãƒˆ\*\*:  
\- âœ… localStorageã¸ã®ä¾å­˜ã‚’å®Œå…¨ã«æ’é™¤  
\- âœ… \`/\`ãƒ«ãƒ¼ãƒˆã®è¤‡é›‘ãª\`beforeEnter\`ã‚¬ãƒ¼ãƒ‰ãŒä¸è¦  
\- âœ… PWAèµ·å‹•æ™‚ã«ç›´æ¥æ–½è¨­URLã«ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆç¢ºå®Ÿï¼‰  
\- âœ… Safari iOS/Chrome Androidä¸¡å¯¾å¿œ  
\- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¶­æŒï¼ˆæ–½è¨­URLã®æ¤œè¨¼ã¯\`/f/:facilityId\`ãƒ«ãƒ¼ãƒˆã§å®Ÿæ–½ï¼‰

\*\*ãƒ‡ãƒ¡ãƒªãƒƒãƒˆï¼ˆè¨±å®¹å¯èƒ½ï¼‰\*\*:  
\- âš ï¸ è¤‡æ•°æ–½è¨­ã¸ã®åˆ‡ã‚Šæ›¿ãˆã«ã¯å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦  
\- âš ï¸ Blob URLã‚’ä½¿ç”¨ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯åŠ¹ã‹ãªã„ï¼‰

\*\*åˆ¤æ–­\*\*: ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã¯è¨±å®¹å¯èƒ½ã€‚ã‚²ã‚¹ãƒˆã¯é€šå¸¸ã€æ»åœ¨ä¸­ã®1ã¤ã®æ–½è¨­ã®ã¿ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€è¤‡æ•°æ–½è¨­ã¸ã®åˆ‡ã‚Šæ›¿ãˆã¯ç¨€ã€‚

\---

\#\# 6\. ä¿®æ­£æ¡ˆã®å®Ÿè£…æ‰‹é †

\#\#\# 6.1 å…¨ä½“ã®å¤‰æ›´æ¦‚è¦

\*\*å¤‰æ›´ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«\*\*:  
1\. \`frontend/src/utils/manifestGenerator.ts\`ï¼ˆæ–°è¦ä½œæˆï¼‰  
2\. \`frontend/src/composables/usePWA.ts\`ï¼ˆä¿®æ­£ï¼‰  
3\. \`frontend/src/router/index.ts\`ï¼ˆä¿®æ­£ï¼‰  
4\. \`frontend/index.html\`ï¼ˆä¿®æ­£ \- ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

\*\*å‰Šé™¤ã™ã‚‹å‡¦ç†\*\*:  
\- \`/\`ãƒ«ãƒ¼ãƒˆã®è¤‡é›‘ãª\`beforeEnter\`ã‚¬ãƒ¼ãƒ‰  
\- \`router.beforeEach\`ã®localStorageä¿å­˜å‡¦ç†ï¼ˆ\`/f/:facilityId\`ã«é–¢ã™ã‚‹éƒ¨åˆ†ï¼‰  
\- \`PWAInstallPrompt.vue\`ã®localStorageä¿å­˜å‡¦ç†

\#\#\# 6.2 ã‚¹ãƒ†ãƒƒãƒ—1: manifestGenerator.tsã‚’ä½œæˆ

\*\*ãƒ•ã‚¡ã‚¤ãƒ«\*\*: \`frontend/src/utils/manifestGenerator.ts\`

\`\`\`typescript  
/\*\*  
 \* å‹•çš„Web App Manifestç”Ÿæˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£  
 \*   
 \* PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ç¾åœ¨ã®æ–½è¨­URLã‚’start\_urlã«è¨­å®šã™ã‚‹ã“ã¨ã§ã€  
 \* PWAèµ·å‹•æ™‚ã«ç›´æ¥æ–½è¨­URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€localStorageã¸ã®ä¾å­˜ã‚’æ’é™¤ã™ã‚‹  
 \*/

export interface DynamicManifest {  
  name: string  
  short\_name: string  
  description: string  
  theme\_color: string  
  start\_url: string  
  scope: string  
  display: string  
  icons: Array\<{  
    src: string  
    sizes: string  
    type: string  
  }\>  
}

/\*\*  
 \* å‹•çš„manifestã‚’ç”Ÿæˆ  
 \* @param facilityId \- æ–½è¨­IDï¼ˆnullã®å ´åˆã¯'/'ã‚’start\_urlã«è¨­å®šï¼‰  
 \* @returns DynamicManifest  
 \*/  
export function generateManifest(facilityId: string | null): DynamicManifest {  
  const startUrl \= facilityId ? \`/f/${facilityId}\` : '/'  
    
  return {  
    name: 'YadOPERA',  
    short\_name: 'YadOPERA',  
    description: 'å°è¦æ¨¡å®¿æ³Šæ–½è¨­å‘ã‘AIå¤šè¨€èªè‡ªå‹•æ¡ˆå†…ã‚·ã‚¹ãƒ†ãƒ ',  
    theme\_color: '\#ffffff',  
    start\_url: startUrl,  
    scope: '/',  
    display: 'standalone',  
    icons: \[  
      {  
        src: '/pwa-192x192.png',  
        sizes: '192x192',  
        type: 'image/png'  
      },  
      {  
        src: '/pwa-512x512.png',  
        sizes: '512x512',  
        type: 'image/png'  
      }  
    \]  
  }  
}

/\*\*  
 \* manifest linkã‚¿ã‚°ã‚’å‹•çš„ã«æ›´æ–°  
 \* @param facilityId \- æ–½è¨­ID  
 \*/  
export function updateManifestLink(facilityId: string | null): void {  
  try {  
    // æ—¢å­˜ã®manifest linkã‚¿ã‚°ã‚’å‰Šé™¤  
    const existingLink \= document.querySelector('link\[rel="manifest"\]')  
    if (existingLink) {  
      existingLink.remove()  
    }  
      
    // å‹•çš„manifestã‚’ç”Ÿæˆ  
    const manifest \= generateManifest(facilityId)  
    const manifestBlob \= new Blob(\[JSON.stringify(manifest)\], { type: 'application/json' })  
    const manifestUrl \= URL.createObjectURL(manifestBlob)  
      
    // æ–°ã—ã„manifest linkã‚¿ã‚°ã‚’è¿½åŠ   
    const link \= document.createElement('link')  
    link.rel \= 'manifest'  
    link.href \= manifestUrl  
    document.head.appendChild(link)  
      
    console.log('\[PWA\] manifestã‚’å‹•çš„ã«æ›´æ–°ã—ã¾ã—ãŸ:', { facilityId, startUrl: manifest.start\_url })  
  } catch (error) {  
    console.error('\[PWA\] manifestã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ:', error)  
  }  
}  
\`\`\`

\#\#\# 6.3 ã‚¹ãƒ†ãƒƒãƒ—2: usePWA.tsã‚’ä¿®æ­£

\*\*ãƒ•ã‚¡ã‚¤ãƒ«\*\*: \`frontend/src/composables/usePWA.ts\`

\*\*å¤‰æ›´å†…å®¹\*\*: localStorageã¸ã®ä¿å­˜å‡¦ç†ã‚’å‰Šé™¤

\`\`\`typescript  
import { ref, onMounted, onUnmounted } from 'vue'

interface BeforeInstallPromptEvent extends Event {  
  prompt: () \=\> Promise\<void\>  
  userChoice: Promise\<{ outcome: 'accepted' | 'dismissed' }\>  
}

export function usePWA() {  
  const deferredPrompt \= ref\<BeforeInstallPromptEvent | null\>(null)  
  const isInstallable \= ref(false)  
  const isInstalled \= ref(false)

  function handleBeforeInstallPrompt(e: Event) {  
    e.preventDefault()  
    deferredPrompt.value \= e as BeforeInstallPromptEvent  
    isInstallable.value \= true  
    console.log('\[PWA\] beforeinstallpromptã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¤œå‡ºã—ã¾ã—ãŸ')  
  }

  function handleAppInstalled() {  
    isInstallable.value \= false  
    deferredPrompt.value \= null  
    isInstalled.value \= true  
    console.log('\[PWA\] PWAãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã—ãŸ')  
    // localStorageã¸ã®ä¿å­˜å‡¦ç†ã‚’å‰Šé™¤ï¼ˆä¸è¦ï¼‰  
  }

  async function install(): Promise\<boolean\> {  
    if (\!deferredPrompt.value) {  
      console.warn('\[PWA\] deferredPromptãŒå­˜åœ¨ã—ã¾ã›ã‚“')  
      return false  
    }

    try {  
      await deferredPrompt.value.prompt()  
      const choiceResult \= await deferredPrompt.value.userChoice  
        
      if (choiceResult.outcome \=== 'accepted') {  
        console.log('\[PWA\] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒPWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’æ‰¿èªã—ã¾ã—ãŸ')  
        return true  
      } else {  
        console.log('\[PWA\] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒPWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’æ‹’å¦ã—ã¾ã—ãŸ')  
        return false  
      }  
    } catch (error) {  
      console.error('\[PWA\] PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ:', error)  
      return false  
    }  
  }

  onMounted(() \=\> {  
    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt)  
    window.addEventListener('appinstalled', handleAppInstalled)

    // æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯  
    if (window.matchMedia('(display-mode: standalone)').matches) {  
      isInstalled.value \= true  
      console.log('\[PWA\] PWAã¯æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã™')  
    }  
  })

  onUnmounted(() \=\> {  
    window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt)  
    window.removeEventListener('appinstalled', handleAppInstalled)  
  })

  return {  
    isInstallable,  
    isInstalled,  
    install  
  }  
}  
\`\`\`

\#\#\# 6.4 ã‚¹ãƒ†ãƒƒãƒ—3: PWAInstallPrompt.vueã‚’ä¿®æ­£

\*\*ãƒ•ã‚¡ã‚¤ãƒ«\*\*: \`frontend/src/components/PWAInstallPrompt.vue\`

\*\*å¤‰æ›´å†…å®¹\*\*:   
1\. localStorageã¸ã®ä¿å­˜å‡¦ç†ã‚’å‰Šé™¤  
2\. manifestã®å‹•çš„æ›´æ–°ã‚’è¿½åŠ 

\`\`\`vue  
\<script setup lang="ts"\>  
import { ref, computed } from 'vue'  
import { useRoute } from 'vue-router'  
import { usePWA } from '@/composables/usePWA'  
import { updateManifestLink } from '@/utils/manifestGenerator'

const route \= useRoute()  
const { isInstallable, install } \= usePWA()

const isDismissed \= ref(false)  
const isInstalling \= ref(false)

const shouldShow \= computed(() \=\> {  
  return isInstallable.value && \!isDismissed.value && route.path.startsWith('/f/')  
})

const handleInstall \= async () \=\> {  
  isInstalling.value \= true  
    
  // manifestã‚’å‹•çš„ã«æ›´æ–°ï¼ˆPWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‰ã«å®Ÿè¡Œï¼‰  
  try {  
    const facilityId \= route.params.facilityId as string  
    updateManifestLink(facilityId)  
    console.log('\[PWA\] manifestã‚’æ›´æ–°ã—ã¾ã—ãŸ:', facilityId)  
      
    // å°‘ã—å¾…æ©Ÿã—ã¦ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‡¦ç†ã‚’å®Ÿè¡Œ  
    // ï¼ˆmanifestã®æ›´æ–°ãŒãƒ–ãƒ©ã‚¦ã‚¶ã«åæ˜ ã•ã‚Œã‚‹ã¾ã§ã®æ™‚é–“ã‚’ç¢ºä¿ï¼‰  
    await new Promise(resolve \=\> setTimeout(resolve, 100))  
  } catch (error) {  
    console.error('\[PWA\] manifestã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ:', error)  
  }  
    
  // PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‡¦ç†  
  try {  
    const success \= await install()  
    if (success) {  
      isDismissed.value \= true  
    }  
  } catch (error) {  
    console.error('\[PWA\] ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¤±æ•—:', error)  
  } finally {  
    isInstalling.value \= false  
  }  
}

const handleDismiss \= () \=\> {  
  isDismissed.value \= true  
}  
\</script\>

\<template\>  
  \<div v-if="shouldShow" class="pwa-install-prompt"\>  
    \<\!-- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®UI \--\>  
    \<div class="prompt-content"\>  
      \<p\>ã“ã®ã‚¢ãƒ—ãƒªã‚’ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ\</p\>  
      \<div class="prompt-buttons"\>  
        \<button @click="handleInstall" :disabled="isInstalling"\>  
          {{ isInstalling ? 'ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­...' : 'ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«' }}  
        \</button\>  
        \<button @click="handleDismiss"\>å¾Œã§\</button\>  
      \</div\>  
    \</div\>  
  \</div\>  
\</template\>

\<style scoped\>  
.pwa-install-prompt {  
  position: fixed;  
  bottom: 0;  
  left: 0;  
  right: 0;  
  background: white;  
  padding: 1rem;  
  box-shadow: 0 \-2px 10px rgba(0, 0, 0, 0.1);  
  z-index: 9999;  
}

.prompt-content {  
  max-width: 600px;  
  margin: 0 auto;  
}

.prompt-buttons {  
  display: flex;  
  gap: 0.5rem;  
  margin-top: 0.5rem;  
}

.prompt-buttons button {  
  flex: 1;  
  padding: 0.5rem 1rem;  
  border: none;  
  border-radius: 4px;  
  cursor: pointer;  
}

.prompt-buttons button:first-child {  
  background: \#007bff;  
  color: white;  
}

.prompt-buttons button:first-child:disabled {  
  background: \#ccc;  
  cursor: not-allowed;  
}

.prompt-buttons button:last-child {  
  background: \#f0f0f0;  
}  
\</style\>  
\`\`\`

\#\#\# 6.5 ã‚¹ãƒ†ãƒƒãƒ—4: router/index.tsã‚’ä¿®æ­£

\*\*ãƒ•ã‚¡ã‚¤ãƒ«\*\*: \`frontend/src/router/index.ts\`

\*\*å¤‰æ›´å†…å®¹\*\*:  
1\. \`/\`ãƒ«ãƒ¼ãƒˆã®è¤‡é›‘ãª\`beforeEnter\`ã‚¬ãƒ¼ãƒ‰ã‚’å‰Šé™¤  
2\. \`router.beforeEach\`ã®localStorageä¿å­˜å‡¦ç†ã‚’å‰Šé™¤

\`\`\`typescript  
import { createRouter, createWebHistory, type RouteRecordRaw } from 'vue-router'  
import { guestRoutes } from './guest'  
import { adminRoutes } from './admin'

const routes: RouteRecordRaw\[\] \= \[  
  {  
    path: '/',  
    redirect: '/admin/login' // ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ  
  },  
  ...guestRoutes,  
  ...adminRoutes,  
  {  
    path: '/:pathMatch(.\*)\*',  
    name: 'NotFound',  
    component: () \=\> import('@/views/Error404.vue'),  
    meta: {  
      layout: undefined  
    }  
  }  
\]

const router \= createRouter({  
  history: createWebHistory(),  
  routes  
})

// router.beforeEachã®ç°¡ç•¥åŒ–  
router.beforeEach(async (to, \_from, next) \=\> {  
  // èªè¨¼ãƒã‚§ãƒƒã‚¯ãªã©ã®å‡¦ç†ã®ã¿  
  // localStorageã¸ã®ä¿å­˜å‡¦ç†ã¯å‰Šé™¤  
    
  next()  
})

export default router  
\`\`\`

\*\*é‡è¦ãªå¤‰æ›´ç‚¹\*\*:  
\- \`/\`ãƒ«ãƒ¼ãƒˆã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ  
\- è¤‡é›‘ãª\`beforeEnter\`ã‚¬ãƒ¼ãƒ‰ã‚’å®Œå…¨ã«å‰Šé™¤  
\- \`router.beforeEach\`ã®localStorageä¿å­˜å‡¦ç†ã‚’å‰Šé™¤

\#\#\# 6.6 ã‚¹ãƒ†ãƒƒãƒ—5: index.htmlã®ä¿®æ­£ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

\*\*ãƒ•ã‚¡ã‚¤ãƒ«\*\*: \`frontend/index.html\`

\*\*å¤‰æ›´å†…å®¹\*\*: é™çš„ãªmanifest linkã‚¿ã‚°ã‚’å‰Šé™¤ï¼ˆå‹•çš„ã«ç”Ÿæˆã™ã‚‹ãŸã‚ï¼‰

\`\`\`html  
\<\!DOCTYPE html\>  
\<html lang="ja"\>  
  \<head\>  
    \<meta charset="UTF-8"\>  
    \<link rel="icon" type="image/svg+xml" href="/vite.svg"\>  
    \<meta name="viewport" content="width=device-width, initial-scale=1.0"\>  
    \<title\>YadOPERA\</title\>  
      
    \<\!-- manifest linkã‚¿ã‚°ã¯å‰Šé™¤ï¼ˆå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ï¼‰ \--\>  
  \</head\>  
  \<body\>  
    \<div id="app"\>\</div\>  
    \<script type="module" src="/src/main.ts"\>\</script\>  
  \</body\>  
\</html\>  
\`\`\`

\#\#\# 6.7 ã‚¹ãƒ†ãƒƒãƒ—6: vite.config.tsã®ä¿®æ­£

\*\*ãƒ•ã‚¡ã‚¤ãƒ«\*\*: \`frontend/vite.config.ts\`

\*\*å¤‰æ›´å†…å®¹\*\*: \`VitePWA\`ã®\`manifest\`ã‚’å‰Šé™¤ï¼ˆå‹•çš„ç”Ÿæˆã«åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã‚ï¼‰

\`\`\`typescript  
import { defineConfig } from 'vite'  
import vue from '@vitejs/plugin-vue'  
import { VitePWA } from 'vite-plugin-pwa'  
import path from 'path'

export default defineConfig({  
  plugins: \[  
    vue(),  
    VitePWA({  
      registerType: 'autoUpdate',  
      workbox: {  
        globPatterns: \['\*\*/\*.{js,css,html,ico,png,svg}'\],  
        navigateFallback: '/index.html',  
        navigateFallbackDenylist: \[/^\\/api\\//\],  
        navigationPreload: false,  
        runtimeCaching: \[  
          {  
            urlPattern: /\\/api\\/v1\\/admin\\/.\*$/,  
            handler: 'NetworkOnly',  
            method: 'GET'  
          },  
          {  
            urlPattern: /\\/api\\/v1\\/facility\\/.\*$/,  
            handler: 'NetworkFirst',  
            options: {  
              cacheName: 'facility-cache',  
              expiration: {  
                maxEntries: 10,  
                maxAgeSeconds: 60 \* 60 \* 24  
              }  
            }  
          }  
        \]  
      }  
      // manifestã¯å‰Šé™¤ï¼ˆå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ï¼‰  
    })  
  \],  
  resolve: {  
    alias: {  
      '@': path.resolve(\_\_dirname, './src')  
    }  
  }  
})  
\`\`\`

\*\*é‡è¦\*\*: \`manifest\`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã§ã€vite-plugin-pwaã«ã‚ˆã‚‹é™çš„ãªmanifestç”Ÿæˆã‚’ç„¡åŠ¹åŒ–

\---

\#\# 7\. æ¤œè¨¼æ–¹æ³•

\#\#\# 7.1 ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®æ¤œè¨¼

\#\#\#\# æ‰‹é †1: Dockerç’°å¢ƒã§ãƒ“ãƒ«ãƒ‰

\`\`\`bash  
\# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰  
cd frontend  
docker-compose run \--rm frontend npm run build

\# ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•  
docker-compose run \--rm \-p 4173:4173 frontend npm run preview  
\`\`\`

\#\#\#\# æ‰‹é †2: ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹

\`\`\`  
http://localhost:4173/f/347  
\`\`\`

\#\#\#\# æ‰‹é †3: é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ç¢ºèª

1\. \*\*Applicationã‚¿ãƒ– â†’ Manifest\*\*  
   \- \`start\_url\`ãŒ\`/f/347\`ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

2\. \*\*Consoleã‚¿ãƒ–\*\*  
   \- \`\[PWA\] manifestã‚’å‹•çš„ã«æ›´æ–°ã—ã¾ã—ãŸ: { facilityId: "347", startUrl: "/f/347" }\`ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

3\. \*\*PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\*\*  
   \- Chrome: ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã®å³å´ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹  
   \- Safari iOS: ã€Œå…±æœ‰ã€â†’ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€

\#\#\#\# æ‰‹é †4: PWAèµ·å‹•

1\. ãƒ›ãƒ¼ãƒ ç”»é¢ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—  
2\. \*\*æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ\*\*: \`/f/347\`ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã—ã€æ–½è¨­ç‹¬è‡ªã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹  
3\. \*\*ç¢ºèªãƒã‚¤ãƒ³ãƒˆ\*\*:  
   \- 404ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªã„ã“ã¨  
   \- ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒšãƒ¼ã‚¸ã¾ãŸã¯è¨€èªé¸æŠãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨

\#\#\# 7.2 ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã®æ¤œè¨¼

\#\#\#\# ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®ç¢ºèª

\`\`\`bash  
\# ãƒ“ãƒ«ãƒ‰ã®ç¢ºèª  
cd frontend  
npm run build

\# distãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç¢ºèª  
ls \-la dist/  
\`\`\`

\#\#\#\# Render.comã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

\`\`\`bash  
\# Gitã«ã‚³ãƒŸãƒƒãƒˆ  
git add .  
git commit \-m "fix: PWAèµ·å‹•æ™‚404ã‚¨ãƒ©ãƒ¼ã®ä¿®æ­£ \- å‹•çš„manifestã«ã‚ˆã‚‹æ ¹æœ¬è§£æ±º"  
git push origin main  
\`\`\`

\#\#\#\# ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª

1\. ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã«ã‚¢ã‚¯ã‚»ã‚¹: \`https://yadopera-frontend-staging.onrender.com/f/347\`  
2\. é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§manifestã‚’ç¢ºèª  
3\. PWAã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
4\. PWAã‚’èµ·å‹•ã—ã€æ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

\#\#\# 7.3 å®Ÿæ©Ÿã§ã®æ¤œè¨¼

\#\#\#\# iPadï¼ˆSafari iOSï¼‰

1\. Safariã§\`https://yadopera-frontend-staging.onrender.com/f/347\`ã«ã‚¢ã‚¯ã‚»ã‚¹  
2\. ã€Œå…±æœ‰ã€â†’ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’å®Ÿè¡Œ  
3\. ãƒ›ãƒ¼ãƒ ç”»é¢ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—  
4\. \*\*æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ\*\*: \`/f/347\`ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã—ã€æ–½è¨­ç‹¬è‡ªã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹

\#\#\#\# Pixelï¼ˆChrome Androidï¼‰

1\. Chromeã§\`https://yadopera-frontend-staging.onrender.com/f/347\`ã«ã‚¢ã‚¯ã‚»ã‚¹  
2\. PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹  
3\. ã€Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—  
4\. ãƒ›ãƒ¼ãƒ ç”»é¢ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—  
5\. \*\*æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ\*\*: \`/f/347\`ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã—ã€æ–½è¨­ç‹¬è‡ªã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹

\#\#\# 7.4 æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

\- \[ \] manifestã®\`start\_url\`ãŒå‹•çš„ã«æ›´æ–°ã•ã‚Œã¦ã„ã‚‹ï¼ˆé–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ç¢ºèªï¼‰  
\- \[ \] PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹  
\- \[ \] PWAèµ·å‹•æ™‚ã«404ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªã„  
\- \[ \] PWAèµ·å‹•æ™‚ã«æ–½è¨­ç‹¬è‡ªã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹  
\- \[ \] Safari iOSã§æ­£å¸¸ã«å‹•ä½œã™ã‚‹  
\- \[ \] Chrome Androidã§æ­£å¸¸ã«å‹•ä½œã™ã‚‹  
\- \[ \] æ—¢å­˜ã®æ©Ÿèƒ½ï¼ˆã‚²ã‚¹ãƒˆå´ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€ç®¡ç†è€…å´ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹

\---

\#\# 8\. ä»˜éŒ²

\#\#\# 8.1 ä¿®æ­£å‰å¾Œã®æ¯”è¼ƒ

\#\#\#\# ä¿®æ­£å‰ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

\`\`\`  
PWAèµ·å‹•  
  â†“  
start\_url: "/" ã«ã‚¢ã‚¯ã‚»ã‚¹  
  â†“  
Service Worker â†’ /index.html ã‚’è¿”ã™  
  â†“  
Vue RouteråˆæœŸåŒ–  
  â†“  
"/" ãƒ«ãƒ¼ãƒˆã® beforeEnter ã‚¬ãƒ¼ãƒ‰å®Ÿè¡Œ  
  â†“  
localStorage.getItem('last\_facility\_url')  
  â†“  
âŒ null ãŒè¿”ã•ã‚Œã‚‹  
  â†“  
next({ name: 'NotFound' })  
  â†“  
âŒ 404ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸è¡¨ç¤º  
\`\`\`

\#\#\#\# ä¿®æ­£å¾Œã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

\`\`\`  
PWAèµ·å‹•  
  â†“  
start\_url: "/f/347" ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹  
  â†“  
Service Worker â†’ /index.html ã‚’è¿”ã™  
  â†“  
Vue RouteråˆæœŸåŒ–  
  â†“  
"/f/:facilityId" ãƒ«ãƒ¼ãƒˆã«ãƒãƒƒãƒ  
  â†“  
âœ… LanguageSelect.vue ã¾ãŸã¯ Welcome.vue ãŒè¡¨ç¤ºã•ã‚Œã‚‹  
\`\`\`

\#\#\# 8.2 æŠ€è¡“çš„ãªæ ¹æ‹ 

\#\#\#\# ãªãœlocalStorageãƒ™ãƒ¼ã‚¹ã§ã¯è§£æ±ºã§ããªã„ã®ã‹

1\. \*\*ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å•é¡Œ\*\*:  
   \- PWAèµ·å‹•æ™‚ã¯\`/\`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ï¼ˆ\`manifest.start\_url\`ã®ä»•æ§˜ï¼‰  
   \- \`router.beforeEach\`ã®ä¿å­˜å‡¦ç†ã¯\`/f/:facilityId\`ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ã¿å®Ÿè¡Œ  
   \- ã“ã®çŸ›ç›¾ã¯è¨­è¨ˆä¸Šè§£æ¶ˆã§ããªã„

2\. \*\*ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶ç´„\*\*:  
   \- Safari iOSã§ã¯\`beforeinstallprompt\`ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãªã„  
   \- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®JavaScriptå‡¦ç†ã‚’å®Ÿè¡Œã§ããªã„  
   \- ã—ãŸãŒã£ã¦ã€localStorageã¸ã®ä¿å­˜ã‚’ä¿è¨¼ã§ããªã„

3\. \*\*éåŒæœŸå‡¦ç†ã®ä¸ç¢ºå®Ÿæ€§\*\*:  
   \- \`localStorage.setItem()\`ã¨PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å®Œäº†ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ä¿è¨¼ã•ã‚Œãªã„  
   \- ãƒ–ãƒ©ã‚¦ã‚¶ã®å®Ÿè£…ã«ä¾å­˜ã™ã‚‹

\#\#\#\# ãªãœå‹•çš„manifestãŒå”¯ä¸€ã®è§£æ±ºç­–ãªã®ã‹

1\. \*\*localStorageã¸ã®ä¾å­˜ã‚’æ’é™¤\*\*:  
   \- \`start\_url\`ã‚’æ–½è¨­URLã«è¨­å®šã™ã‚‹ã“ã¨ã§ã€PWAèµ·å‹•æ™‚ã«ç›´æ¥æ–½è¨­URLã«ã‚¢ã‚¯ã‚»ã‚¹  
   \- localStorageã®èª­ã¿å–ã‚Šãƒ»æ›¸ãè¾¼ã¿ãŒä¸è¦

2\. \*\*ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶ç´„ã‚’å›é¿\*\*:  
   \- manifestã®æ›´æ–°ã¯PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‰ã«å®Œäº†  
   \- ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒã‚¤ãƒ†ã‚£ãƒ–å‡¦ç†ï¼ˆPWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰ã«ä¾å­˜ã—ãªã„

3\. \*\*ç¢ºå®Ÿæ€§\*\*:  
   \- PWAèµ·å‹•æ™‚ã«å¸¸ã«æ–½è¨­URLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹  
   \- ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å•é¡ŒãŒç™ºç”Ÿã—ãªã„

\#\#\# 8.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

\#\#\#\# æ–½è¨­IDã®æ¤œè¨¼

å‹•çš„manifestã§\`start\_url\`ã‚’è¨­å®šã™ã‚‹éš›ã€æ–½è¨­IDã®æ¤œè¨¼ã¯ä¸è¦ã§ã™ã€‚ç†ç”±ï¼š

1\. \*\*manifestã®æ›´æ–°ã¯ã‚²ã‚¹ãƒˆå´ã®ãƒ«ãƒ¼ãƒˆï¼ˆ\`/f/:facilityId\`ï¼‰ã§ã®ã¿å®Ÿè¡Œ\*\*:  
   \- \`PWAInstallPrompt.vue\`ã¯\`GuestLayout\`ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹  
   \- \`shouldShow\`ã®æ¡ä»¶: \`route.path.startsWith('/f/')\`  
   \- ã—ãŸãŒã£ã¦ã€ç®¡ç†è€…å´ã®ãƒ«ãƒ¼ãƒˆã§ã¯å®Ÿè¡Œã•ã‚Œãªã„

2\. \*\*æ–½è¨­IDã®æ¤œè¨¼ã¯\`/f/:facilityId\`ãƒ«ãƒ¼ãƒˆã§å®Ÿæ–½\*\*:  
   \- Vue RouterãŒ\`/f/:facilityId\`ã«ãƒãƒƒãƒã—ãŸéš›ã€ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æ–½è¨­IDã‚’æ¤œè¨¼  
   \- ä¸æ­£ãªæ–½è¨­IDã®å ´åˆã€404ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

3\. \*\*ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼ã¯ç¶­æŒ\*\*:  
   \- \`start\_url\`ã¯å¸¸ã«\`/f/:facilityId\`å½¢å¼  
   \- ç®¡ç†è€…å´ã®ãƒ«ãƒ¼ãƒˆï¼ˆ\`/admin/\*\`ï¼‰ã¯è¨­å®šã•ã‚Œãªã„

\#\#\#\# XSSå¯¾ç­–

\- æ–½è¨­IDã¯\`route.params.facilityId\`ã‹ã‚‰å–å¾—  
\- Vue RouterãŒè‡ªå‹•çš„ã«ã‚µãƒ‹ã‚¿ã‚¤ã‚º  
\- \`updateManifestLink()\`å†…ã§è¿½åŠ ã®æ¤œè¨¼ã¯ä¸è¦

\#\#\# 8.4 åˆ¶ç´„äº‹é …ã¨å¯¾å¿œæ–¹é‡

\#\#\#\# åˆ¶ç´„1: è¤‡æ•°æ–½è¨­ã¸ã®åˆ‡ã‚Šæ›¿ãˆã«ã¯å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦

\*\*å½±éŸ¿\*\*:  
\- ã‚²ã‚¹ãƒˆãŒè¤‡æ•°ã®æ–½è¨­ã«æ»åœ¨ã™ã‚‹å ´åˆã€æ–½è¨­ã”ã¨ã«PWAã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

\*\*å¯¾å¿œæ–¹é‡\*\*:  
\- ã‚²ã‚¹ãƒˆã¯é€šå¸¸ã€æ»åœ¨ä¸­ã®1ã¤ã®æ–½è¨­ã®ã¿ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€ã“ã®åˆ¶ç´„ã¯è¨±å®¹å¯èƒ½  
\- å°†æ¥çš„ã«è¤‡æ•°æ–½è¨­å¯¾å¿œãŒå¿…è¦ãªå ´åˆã€ä»¥ä¸‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¤œè¨:  
  \- æ–½è¨­é¸æŠç”»é¢ã‚’è¿½åŠ   
  \- localStorageãƒ™ãƒ¼ã‚¹ã®æš«å®šå¯¾å¿œï¼ˆãŸã ã—ã€Safari iOSã§ã¯å‹•ä½œã—ãªã„å¯èƒ½æ€§ãŒé«˜ã„ï¼‰

\#\#\#\# åˆ¶ç´„2: Blob URLã‚’ä½¿ç”¨ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯åŠ¹ã‹ãªã„ï¼‰

\*\*å½±éŸ¿\*\*:  
\- manifestã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ã‹ãªã„  
\- ã—ã‹ã—ã€manifestã¯éå¸¸ã«å°ã•ã„ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚‹ãŸã‚ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿ã¯ç„¡è¦–ã§ãã‚‹

\*\*å¯¾å¿œæ–¹é‡\*\*:  
\- ç¾çŠ¶ã®å®Ÿè£…ã§å•é¡Œãªã—  
\- å°†æ¥çš„ã«ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®å‹•çš„manifestç”ŸæˆãŒå¿…è¦ãªå ´åˆã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ç§»è¡Œã‚’æ¤œè¨

\#\#\# 8.5 ä»Šå¾Œã®æ”¹å–„æ¡ˆ

\#\#\#\# Phase 3ä»¥é™ã§ã®æ¤œè¨äº‹é …

1\. \*\*ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®å‹•çš„manifestç”Ÿæˆ\*\*:  
   \- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆFastAPIï¼‰ã§å‹•çš„ã«manifestã‚’ç”Ÿæˆ  
   \- \`/api/v1/manifest?facility\_id=347\`ã®ã‚ˆã†ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½œæˆ  
   \- ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ´»ç”¨å¯èƒ½

2\. \*\*è¤‡æ•°æ–½è¨­å¯¾å¿œ\*\*:  
   \- æ–½è¨­é¸æŠç”»é¢ã®è¿½åŠ   
   \- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°ã®æ–½è¨­ã‚’ç™»éŒ²ãƒ»åˆ‡ã‚Šæ›¿ãˆå¯èƒ½

3\. \*\*Progressive Enhancement\*\*:  
   \- localStorageã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦ä½¿ç”¨  
   \- å‹•çš„manifestãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ–ãƒ©ã‚¦ã‚¶ã¸ã®å¯¾å¿œ

\#\#\# 8.6 FAQ

\#\#\#\# Q1: ãªãœæœ€åˆã‹ã‚‰localStorageã‚’ä½¿ã‚ãªã„è¨­è¨ˆã«ã—ãªã‹ã£ãŸã®ã‹ï¼Ÿ

\*\*A\*\*: åˆæœŸè¨­è¨ˆã§ã¯ã€PWAã®\`start\_url\`ã¯å›ºå®šï¼ˆ\`/\`ï¼‰ã§ã€localStorageã«æœ€å¾Œã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸæ–½è¨­URLã‚’ä¿å­˜ã™ã‚‹ã“ã¨ã§ã€æŸ”è»Ÿãªæ–½è¨­åˆ‡ã‚Šæ›¿ãˆã‚’å®Ÿç¾ã—ã‚ˆã†ã¨ã—ã¾ã—ãŸã€‚ã—ã‹ã—ã€ä»¥ä¸‹ã®å•é¡ŒãŒç™ºè¦šï¼š

1\. Safari iOSã®åˆ¶ç´„ï¼ˆ\`beforeinstallprompt\`ã‚¤ãƒ™ãƒ³ãƒˆéå¯¾å¿œï¼‰  
2\. éåŒæœŸå‡¦ç†ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œ  
3\. PWAèµ·å‹•æ™‚ã®URLï¼ˆ\`/\`ï¼‰ã¨ä¿å­˜å‡¦ç†ã®å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ä¸ä¸€è‡´

ã“ã‚Œã‚‰ã®å•é¡Œã‚’æ ¹æœ¬çš„ã«è§£æ±ºã™ã‚‹ãŸã‚ã«ã€å‹•çš„manifestã«ã‚ˆã‚‹è¨­è¨ˆã«å¤‰æ›´ã—ã¾ã—ãŸã€‚

\#\#\#\# Q2: localStorageãƒ™ãƒ¼ã‚¹ã®æš«å®šå¯¾å¿œã¯æ¤œè¨ã—ãªã„ã®ã‹ï¼Ÿ

\*\*A\*\*: æ¤œè¨ã—ã¾ã—ãŸãŒã€ä»¥ä¸‹ã®ç†ç”±ã§æ¨å¥¨ã—ã¾ã›ã‚“ï¼š

1\. \*\*æ ¹æœ¬è§£æ±ºã«ãªã‚‰ãªã„\*\*: Safari iOSã§ã®å•é¡Œã¯è§£æ±ºã§ããªã„  
2\. \*\*è¤‡é›‘æ€§ã®å¢—åŠ \*\*: è¤‡æ•°ã®ä¿å­˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹  
3\. \*\*ä¸ç¢ºå®Ÿæ€§\*\*: ãƒ–ãƒ©ã‚¦ã‚¶ã®å®Ÿè£…ã«ä¾å­˜ã™ã‚‹

å¤§åŸå‰‡ã€Œæ ¹æœ¬è§£æ±º \> æš«å®šè§£æ±ºã€ã«åŸºã¥ãã€å‹•çš„manifestã«ã‚ˆã‚‹æ ¹æœ¬è§£æ±ºã‚’æ¨å¥¨ã—ã¾ã™ã€‚

\#\#\#\# Q3: å‹•çš„manifestã¯ã™ã¹ã¦ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã®ã‹ï¼Ÿ

\*\*A\*\*: ã¯ã„ã€ä»¥ä¸‹ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ï¼š

\- Chromeï¼ˆAndroid/Desktopï¼‰  
\- Safariï¼ˆiOS/macOSï¼‰  
\- Firefox  
\- Edge

Blob URLã‚’ä½¿ç”¨ã—ãŸå‹•çš„ãªmanifest linkã‚¿ã‚°ã®æ›´æ–°ã¯ã€Webæ¨™æº–ã«æº–æ‹ ã—ã¦ãŠã‚Šã€ã™ã¹ã¦ã®ä¸»è¦ãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ä½œã—ã¾ã™ã€‚

\#\#\#\# Q4: PWAã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹éš›ã€å¤ã„manifestãŒæ®‹ã‚‰ãªã„ã®ã‹ï¼Ÿ

\*\*A\*\*: å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚ç†ç”±ï¼š

1\. PWAã‚’ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¯å¤ã„manifestã‚’å‰Šé™¤  
2\. å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«æ–°ã—ã„manifestãŒä½¿ç”¨ã•ã‚Œã‚‹  
3\. Blob URLã¯ä¸€æ™‚çš„ãªã‚‚ã®ã§ã‚ã‚Šã€æ°¸ç¶šåŒ–ã•ã‚Œãªã„

\#\#\# 8.7 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

\#\#\#\# å•é¡Œ1: PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã‚‚404ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹

\*\*åŸå› \*\*:  
\- manifestã®æ›´æ–°ãŒPWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‰ã«å®Œäº†ã—ã¦ã„ãªã„

\*\*è§£æ±ºç­–\*\*:  
1\. \`PWAInstallPrompt.vue\`ã®\`handleInstall\`ã«å¾…æ©Ÿæ™‚é–“ã‚’è¿½åŠ :  
   \`\`\`typescript  
   await new Promise(resolve \=\> setTimeout(resolve, 100))  
   \`\`\`  
2\. å¾…æ©Ÿæ™‚é–“ã‚’200msã«å¢—ã‚„ã™ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

\#\#\#\# å•é¡Œ2: é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§manifestã®start\_urlãŒæ›´æ–°ã•ã‚Œã¦ã„ãªã„

\*\*åŸå› \*\*:  
\- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ®‹ã£ã¦ã„ã‚‹  
\- ã¾ãŸã¯ã€\`updateManifestLink()\`ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„

\*\*è§£æ±ºç­–\*\*:  
1\. é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãã€Application â†’ Clear storage â†’ Clear site data  
2\. ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰  
3\. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§\`\[PWA\] manifestã‚’å‹•çš„ã«æ›´æ–°ã—ã¾ã—ãŸ\`ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

\#\#\#\# å•é¡Œ3: Safari iOSã§manifestãŒæ›´æ–°ã•ã‚Œãªã„

\*\*åŸå› \*\*:  
\- Safari iOSã®å®Ÿè£…ãŒä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¨ç•°ãªã‚‹å¯èƒ½æ€§

\*\*è§£æ±ºç­–\*\*:  
1\. Safari iOSã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§ç¢ºèª  
2\. Safari iOSã‚’å†èµ·å‹•  
3\. ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆã€å¾…æ©Ÿæ™‚é–“ã‚’500msã«å¢—ã‚„ã™

\#\#\# 8.8 å‚è€ƒè³‡æ–™

\#\#\#\# PWAé–¢é€£

\- \[Web App Manifest \- MDN\](https://developer.mozilla.org/en-US/docs/Web/Manifest)  
\- \[PWA Installation \- web.dev\](https://web.dev/install-criteria/)  
\- \[beforeinstallprompt \- MDN\](https://developer.mozilla.org/en-US/docs/Web/API/BeforeInstallPromptEvent)

\#\#\#\# Vue.jsé–¢é€£

\- \[Vue Router \- Navigation Guards\](https://router.vuejs.org/guide/advanced/navigation-guards.html)  
\- \[Vue.js Composables\](https://vuejs.org/guide/reusability/composables.html)

\#\#\#\# Service Workeré–¢é€£

\- \[Service Worker API \- MDN\](https://developer.mozilla.org/en-US/docs/Web/API/Service\_Worker\_API)  
\- \[Workbox \- Google Developers\](https://developers.google.com/web/tools/workbox)

\---

\#\# çµè«–

\#\#\# æ ¹æœ¬åŸå› 

PWAã®\`start\_url: '/'\`ã¨localStorageä¿å­˜å‡¦ç†ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒæ ¹æœ¬çš„ã«ä¸ä¸€è‡´ã§ã‚ã‚‹ã“ã¨ãŒåŸå› ã€‚Safari iOSã®åˆ¶ç´„ã¨éåŒæœŸå‡¦ç†ã®ä¸ç¢ºå®Ÿæ€§ã«ã‚ˆã‚Šã€localStorageãƒ™ãƒ¼ã‚¹ã®è¨­è¨ˆã§ã¯æ ¹æœ¬çš„ã«è§£æ±ºã§ããªã„ã€‚

\#\#\# å”¯ä¸€ã®è§£æ±ºç­–

\*\*å‹•çš„manifestã«ã‚ˆã‚‹æ ¹æœ¬è§£æ±º\*\*: PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«\`start\_url\`ã‚’ç¾åœ¨ã®æ–½è¨­URLï¼ˆ\`/f/:facilityId\`ï¼‰ã«å‹•çš„è¨­å®šã™ã‚‹ã“ã¨ã§ã€localStorageã¸ã®ä¾å­˜ã‚’å®Œå…¨ã«æ’é™¤ã—ã€PWAèµ·å‹•æ™‚ã«ç›´æ¥æ–½è¨­URLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã€‚

\#\#\# å®Ÿè£…ã®å„ªå…ˆåº¦

\*\*æœ€å„ªå…ˆ\*\*: æœ¬ä¿®æ­£æ¡ˆã‚’å³åº§ã«å®Ÿè£…ã—ã€ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚

\#\#\# æœŸå¾…ã•ã‚Œã‚‹çµæœ

\- âœ… PWAèµ·å‹•æ™‚ã«404ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„  
\- âœ… Safari iOS/Chrome Androidä¸¡å¯¾å¿œ  
\- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’ç¶­æŒ  
\- âœ… ã‚·ãƒ³ãƒ—ãƒ«ã§ç¢ºå®Ÿãªè¨­è¨ˆ

\---

\*\*Document Version\*\*: v1.0    
\*\*Author\*\*: Claude (Anthropic)    
\*\*Last Updated\*\*: 2025å¹´12æœˆ22æ—¥ 16æ™‚45åˆ†00ç§’    
\*\*Status\*\*: âœ… \*\*å®Œäº† \- å³åº§ã«å®Ÿè£…å¯èƒ½\*\*