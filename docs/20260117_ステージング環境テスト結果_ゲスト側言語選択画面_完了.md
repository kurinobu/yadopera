# ステージング環境テスト結果 - ゲスト側言語選択画面プラン対応言語フィルタリング

**作成日時**: 2026年01月17日  
**目的**: ステージング環境でのゲスト側言語選択画面プラン対応言語フィルタリングのテスト結果  
**状態**: ✅ **すべてのテスト成功**

---

## 1. テスト環境

### 1.1 APIヘルスチェック

**ステージング環境API**: ✅ 正常動作
- URL: `https://yadopera-backend-staging.onrender.com`
- ヘルスチェック: ✅ 成功
```json
{
    "status": "healthy",
    "database": "connected",
    "redis": "connected"
}
```

### 1.2 テスト用ユーザー情報

以下のユーザーIDを使用してテストを実行しました:

| プラン | メールアドレス | パスワード | 施設slug |
|--------|---------------|-----------|----------|
| Free | test31@example.com | testpassword123 | freeホテル-adf12fdb |
| Mini | test41@example.com | testpassword123 | miniホテル-df9f397b |
| Small | test51@example.com | testpassword123 | smallホテル-0f176cb5 |
| Standard | test61@example.com | testpassword123 | standardホテル-6b6d426a |
| Premium | test71@example.com | testpassword123 | premiumホテル-215ea322 |

---

## 2. テスト結果

### 2.1 APIテスト結果

**テストスクリプト**: `backend/test_staging_facility_available_languages_with_users.py`

**結果**: ✅ **すべてのテストが成功**

```
テスト結果サマリー
============================================================
✅ 成功: 5/5
❌ 失敗: 0/5
⚠️  エラー: 0/5
```

### 2.2 各プランのテスト結果

#### Freeプラン
- **施設slug**: `freeホテル-adf12fdb`
- **plan_type**: `Free`
- **available_languages**: `['ja']`
- **結果**: ✅ 成功

#### Miniプラン
- **施設slug**: `miniホテル-df9f397b`
- **plan_type**: `Mini`
- **available_languages**: `['ja', 'en']`
- **結果**: ✅ 成功

#### Smallプラン
- **施設slug**: `smallホテル-0f176cb5`
- **plan_type**: `Small`
- **available_languages**: `['ja', 'en', 'zh-TW']`
- **結果**: ✅ 成功

#### Standardプラン
- **施設slug**: `standardホテル-6b6d426a`
- **plan_type**: `Standard`
- **available_languages**: `['ja', 'en', 'zh-TW', 'fr']`
- **結果**: ✅ 成功

#### Premiumプラン
- **施設slug**: `premiumホテル-215ea322`
- **plan_type**: `Premium`
- **available_languages**: `['ja', 'en', 'zh-TW', 'fr', 'ko']`
- **結果**: ✅ 成功

### 2.3 languageパラメータテスト

**Premiumプランでのlanguageパラメータテスト**:

- ✅ 日本語 (ja): 3件のFAQ取得
- ✅ 英語 (en): 3件のFAQ取得
- ✅ 中国語 (zh-TW): 3件のFAQ取得

---

## 3. 検証結果

### 3.1 プラン別の利用可能言語

すべてのプランで、期待される言語リストが正しく返されることを確認しました:

| プラン | 期待される言語 | 実際の言語 | 結果 |
|--------|--------------|-----------|------|
| Free | `['ja']` | `['ja']` | ✅ |
| Mini | `['ja', 'en']` | `['ja', 'en']` | ✅ |
| Small | `['ja', 'en', 'zh-TW']` | `['ja', 'en', 'zh-TW']` | ✅ |
| Standard | `['ja', 'en', 'zh-TW', 'fr']` | `['ja', 'en', 'zh-TW', 'fr']` | ✅ |
| Premium | `['ja', 'en', 'zh-TW', 'fr', 'ko']` | `['ja', 'en', 'zh-TW', 'fr', 'ko']` | ✅ |

### 3.2 plan_typeの確認

すべてのプランで、正しい`plan_type`が返されることを確認しました:

- Freeプラン: `plan_type: "Free"` ✅
- Miniプラン: `plan_type: "Mini"` ✅
- Smallプラン: `plan_type: "Small"` ✅
- Standardプラン: `plan_type: "Standard"` ✅
- Premiumプラン: `plan_type: "Premium"` ✅

### 3.3 languageパラメータの動作確認

Premiumプランで`language`パラメータを指定した場合、正しくFAQが取得されることを確認しました:

- `language=ja`: 日本語のFAQが取得される ✅
- `language=en`: 英語のFAQが取得される ✅
- `language=zh-TW`: 中国語のFAQが取得される ✅

---

## 4. 結論

### 4.1 テスト結果サマリー

- ✅ **すべてのテストが成功** (5/5)
- ✅ **プラン別の利用可能言語が正しく返される**
- ✅ **plan_typeが正しく設定されている**
- ✅ **languageパラメータが正しく動作する**

### 4.2 実装確認

以下の実装が正しく動作していることを確認しました:

1. **Backend**: 施設情報取得APIに`plan_type`と`available_languages`が正しく含まれている
2. **Backend**: Premiumプランの言語リストがStandardプラン＋韓国語（`['ja', 'en', 'zh-TW', 'fr', 'ko']`）に修正されている
3. **Backend**: `language`パラメータが正しく処理され、選択した言語の翻訳が優先的に取得される

### 4.3 次のステップ

1. ✅ ステージング環境のAPIテスト: 完了
2. ⏳ ブラウザテスト: 実行可能（各プランの施設slugを使用）

---

## 5. ブラウザテスト用URL

以下のURLでブラウザテストを実行できます:

- **Freeプラン**: `https://yadopera-frontend-staging.onrender.com/f/freeホテル-adf12fdb`
- **Miniプラン**: `https://yadopera-frontend-staging.onrender.com/f/miniホテル-df9f397b`
- **Smallプラン**: `https://yadopera-frontend-staging.onrender.com/f/smallホテル-0f176cb5`
- **Standardプラン**: `https://yadopera-frontend-staging.onrender.com/f/standardホテル-6b6d426a`
- **Premiumプラン**: `https://yadopera-frontend-staging.onrender.com/f/premiumホテル-215ea322`

---

## 6. 参考情報

- **テストスクリプト**: `backend/test_staging_facility_available_languages_with_users.py`
- **ステージング環境API**: `https://yadopera-backend-staging.onrender.com`
- **ステージング環境Frontend**: `https://yadopera-frontend-staging.onrender.com`

