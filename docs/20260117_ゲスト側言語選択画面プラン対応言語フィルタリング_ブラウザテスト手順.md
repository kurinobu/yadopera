# ゲスト側言語選択画面プラン対応言語フィルタリング - ブラウザテスト手順

**作成日時**: 2026年01月17日  
**目的**: ゲスト側の言語選択画面でプランに応じた言語フィルタリングのブラウザテスト手順  
**状態**: 📋 **テスト手順書作成完了**

---

## 1. テスト環境の準備

### 1.1 Docker環境の確認

**確認コマンド**:
```bash
cd /Users/kurinobu/projects/yadopera
docker-compose ps
```

**期待される結果**:
- `yadopera-backend`: Up（ポート8000）
- `yadopera-frontend`: Up（ポート5173）
- `yadopera-postgres`: Up（ポート5433）
- `yadopera-redis`: Up（ポート6379）

### 1.2 サービス起動確認

**Backend確認**:
```bash
curl http://localhost:8000/api/v1/health
```

**期待される結果**:
```json
{"status":"healthy","database":"connected","redis":"connected"}
```

**Frontend確認**:
```bash
curl http://localhost:5173
```

**期待される結果**: HTMLが返される

---

## 2. テスト用施設データの確認

### 2.1 各プランの施設データ

以下の施設データを使用してテストを実行します：

| プラン | Slug | 期待される言語 |
|--------|------|---------------|
| Free | `test-facility-free-4975ca89` | 日本語のみ（`["ja"]`） |
| Mini | `test-facility-mini-b7695aea` | 日本語＋英語（`["ja", "en"]`） |
| Small | `test-facility-small-492548ab` | 日本語＋英語＋中国語（`["ja", "en", "zh-TW"]`） |
| Standard | `test-facility-standa-4caf15b3` | 日本語＋英語＋中国語＋フランス語（`["ja", "en", "zh-TW", "fr"]`） |
| Premium | `test-facility-premiu-9455eb18` | 全言語対応（`["ja", "en", "zh-TW", "fr", "es", "de", "ko", "th", "vi"]`） |

**注意**: 現時点では`SUPPORTED_LANGUAGES`は英語のみのため、すべてのプランで英語のみが表示されます。将来的に`SUPPORTED_LANGUAGES`に他の言語が追加された場合、プランに応じた言語が正しく表示されます。

---

## 3. ブラウザテスト手順

### 3.1 テスト1: Freeプランでの言語表示確認

**目的**: Freeプランで日本語のみが表示されることを確認

**手順**:
1. ブラウザで `http://localhost:5173/f/test-facility-free-4975ca89` にアクセス
2. 言語選択画面が表示されることを確認
3. ブラウザの開発者ツール（F12）を開く
4. Networkタブで `/api/v1/facility/test-facility-free-4975ca89` のレスポンスを確認
5. レスポンスに `plan_type: "Free"` と `available_languages: ["ja"]` が含まれていることを確認
6. 言語選択画面で表示されている言語を確認

**期待される結果**:
- APIレスポンス: `plan_type: "Free"`, `available_languages: ["ja"]`
- 言語選択画面: 英語のみが表示される（`SUPPORTED_LANGUAGES`に日本語がないため）

**注意**: 現時点では`SUPPORTED_LANGUAGES`は英語のみのため、日本語は表示されません。将来的に`SUPPORTED_LANGUAGES`に日本語が追加された場合、日本語のみが表示されます。

### 3.2 テスト2: Miniプランでの言語表示確認

**目的**: Miniプランで日本語＋英語が表示されることを確認

**手順**:
1. ブラウザで `http://localhost:5173/f/test-facility-mini-b7695aea` にアクセス
2. 言語選択画面が表示されることを確認
3. ブラウザの開発者ツール（F12）を開く
4. Networkタブで `/api/v1/facility/test-facility-mini-b7695aea` のレスポンスを確認
5. レスポンスに `plan_type: "Mini"` と `available_languages: ["ja", "en"]` が含まれていることを確認
6. 言語選択画面で表示されている言語を確認

**期待される結果**:
- APIレスポンス: `plan_type: "Mini"`, `available_languages: ["ja", "en"]`
- 言語選択画面: 英語のみが表示される（`SUPPORTED_LANGUAGES`に日本語がないため）

### 3.3 テスト3: Smallプランでの言語表示確認

**目的**: Smallプランで日本語＋英語＋中国語が表示されることを確認

**手順**:
1. ブラウザで `http://localhost:5173/f/test-facility-small-492548ab` にアクセス
2. 言語選択画面が表示されることを確認
3. ブラウザの開発者ツール（F12）を開く
4. Networkタブで `/api/v1/facility/test-facility-small-492548ab` のレスポンスを確認
5. レスポンスに `plan_type: "Small"` と `available_languages: ["ja", "en", "zh-TW"]` が含まれていることを確認
6. 言語選択画面で表示されている言語を確認

**期待される結果**:
- APIレスポンス: `plan_type: "Small"`, `available_languages: ["ja", "en", "zh-TW"]`
- 言語選択画面: 英語のみが表示される（`SUPPORTED_LANGUAGES`に日本語・中国語がないため）

### 3.4 テスト4: Standardプランでの言語表示確認

**目的**: Standardプランで日本語＋英語＋中国語＋フランス語が表示されることを確認

**手順**:
1. ブラウザで `http://localhost:5173/f/test-facility-standa-4caf15b3` にアクセス
3. 言語選択画面が表示されることを確認
4. ブラウザの開発者ツール（F12）を開く
5. Networkタブで `/api/v1/facility/{standard-facility-slug}` のレスポンスを確認
6. レスポンスに `plan_type: "Standard"` と `available_languages: ["ja", "en", "zh-TW", "fr"]` が含まれていることを確認
7. 言語選択画面で表示されている言語を確認

**期待される結果**:
- APIレスポンス: `plan_type: "Standard"`, `available_languages: ["ja", "en", "zh-TW", "fr"]`
- 言語選択画面: 英語のみが表示される（`SUPPORTED_LANGUAGES`に他の言語がないため）

### 3.5 テスト5: Premiumプランでの言語表示確認

**目的**: Premiumプランで全言語が表示されることを確認

**手順**:
1. ブラウザで `http://localhost:5173/f/test-facility-premiu-9455eb18` にアクセス
3. 言語選択画面が表示されることを確認
4. ブラウザの開発者ツール（F12）を開く
5. Networkタブで `/api/v1/facility/{premium-facility-slug}` のレスポンスを確認
6. レスポンスに `plan_type: "Premium"` と `available_languages: ["ja", "en", "zh-TW", "fr", "es", "de", "ko", "th", "vi"]` が含まれていることを確認
7. 言語選択画面で表示されている言語を確認

**期待される結果**:
- APIレスポンス: `plan_type: "Premium"`, `available_languages: ["ja", "en", "zh-TW", "fr", "es", "de", "ko", "th", "vi"]`
- 言語選択画面: 英語のみが表示される（`SUPPORTED_LANGUAGES`に他の言語がないため）

### 3.6 テスト6: エラーハンドリング確認

**目的**: 施設情報取得失敗時にデフォルトで英語が表示されることを確認

**手順**:
1. ブラウザで `http://localhost:5173/f/non-existent-facility` にアクセス
2. ブラウザの開発者ツール（F12）を開く
3. Consoleタブでエラーメッセージを確認
4. 言語選択画面で表示されている言語を確認

**期待される結果**:
- APIレスポンス: 404エラー
- エラーメッセージ: "施設情報の取得に失敗しました"
- 言語選択画面: デフォルトで英語が表示される（既存の動作を維持）

### 3.7 テスト7: 言語選択時の動作確認

**目的**: 言語選択時に正しくWelcome画面に遷移することを確認

**手順**:
1. ブラウザで `http://localhost:5173/f/test-facility-mini-b7695aea` にアクセス
2. 言語選択画面で英語を選択
3. Welcome画面に遷移することを確認
4. URLに `?lang=en` が含まれていることを確認

**期待される結果**:
- Welcome画面に遷移する
- URL: `http://localhost:5173/f/test-facility-mini-b7695aea/welcome?lang=en`

---

## 4. テスト結果の記録

### 4.1 テスト結果テンプレート

| テスト番号 | プラン | APIレスポンス | 言語選択画面 | 結果 | 備考 |
|-----------|--------|--------------|-------------|------|------|
| テスト1 | Free | `plan_type: "Free"`, `available_languages: ["ja"]` | 英語のみ | ✅/❌ | |
| テスト2 | Mini | `plan_type: "Mini"`, `available_languages: ["ja", "en"]` | 英語のみ | ✅/❌ | |
| テスト3 | Small | `plan_type: "Small"`, `available_languages: ["ja", "en", "zh-TW"]` | 英語のみ | ✅/❌ | |
| テスト4 | Standard | `plan_type: "Standard"`, `available_languages: ["ja", "en", "zh-TW", "fr"]` | 英語のみ | ✅/❌ | |
| テスト5 | Premium | `plan_type: "Premium"`, `available_languages: ["ja", "en", "zh-TW", "fr", "es", "de", "ko", "th", "vi"]` | 英語のみ | ✅/❌ | |
| テスト6 | エラー | 404エラー | デフォルトで英語 | ✅/❌ | |
| テスト7 | Mini | - | Welcome画面に遷移 | ✅/❌ | |

### 4.2 確認事項

- [ ] 各プランでAPIレスポンスに`plan_type`と`available_languages`が含まれている
- [ ] 各プランで`available_languages`が正しい値になっている
- [ ] エラー時にデフォルトで英語が表示される
- [ ] 言語選択時にWelcome画面に正しく遷移する
- [ ] 既存の機能（Welcome、Chat）に影響がない

---

## 5. 注意事項

### 5.1 現時点の制限事項

**`SUPPORTED_LANGUAGES`は英語のみ**:
- 現時点では`SUPPORTED_LANGUAGES`は英語のみのため、すべてのプランで英語のみが表示されます
- 将来的に`SUPPORTED_LANGUAGES`に他の言語が追加された場合、プランに応じた言語が正しく表示されます

**例**:
- Freeプラン: `available_languages: ["ja"]` が返されるが、`SUPPORTED_LANGUAGES`に日本語がないため、英語のみが表示される
- Miniプラン: `available_languages: ["ja", "en"]` が返されるが、`SUPPORTED_LANGUAGES`に日本語がないため、英語のみが表示される

### 5.2 将来的な拡張

**`SUPPORTED_LANGUAGES`に他の言語を追加する場合**:
1. `frontend/src/utils/constants.ts`の`SUPPORTED_LANGUAGES`に言語を追加
2. 各プランで、`available_languages`に含まれる言語のみが表示される

**例**: `SUPPORTED_LANGUAGES`に日本語を追加した場合
- Freeプラン: 日本語のみが表示される
- Miniプラン: 日本語＋英語が表示される

---

## 6. トラブルシューティング

### 6.1 APIレスポンスに`plan_type`や`available_languages`が含まれていない

**原因**: Backendの実装が反映されていない可能性

**対処法**:
1. Dockerコンテナを再起動: `docker-compose restart backend`
2. Backendのログを確認: `docker-compose logs backend --tail 50`

### 6.2 言語選択画面でエラーが表示される

**原因**: 施設情報取得に失敗している可能性

**対処法**:
1. ブラウザの開発者ツール（F12）でConsoleタブを確認
2. NetworkタブでAPIリクエストのステータスを確認
3. Backendのログを確認: `docker-compose logs backend --tail 50`

### 6.3 すべてのプランで同じ言語が表示される

**原因**: `SUPPORTED_LANGUAGES`が英語のみのため

**対処法**:
- これは正常な動作です。現時点では`SUPPORTED_LANGUAGES`は英語のみのため、すべてのプランで英語のみが表示されます
- 将来的に`SUPPORTED_LANGUAGES`に他の言語が追加された場合、プランに応じた言語が正しく表示されます

---

**Document Version**: v1.0  
**Author**: Auto (AI Assistant)  
**Last Updated**: 2026年01月17日  
**Status**: 📋 **テスト手順書作成完了**

