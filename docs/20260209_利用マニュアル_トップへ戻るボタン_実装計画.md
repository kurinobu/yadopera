# 課題6: 利用マニュアルのトップへ戻るボタン 実装計画

**作成日**: 2026年2月9日  
**対象**: Phase 2 残存課題「6. 利用マニュアルのトップへ戻るボタン実装」  
**参照**: `docs/Phase2_実装ステップ計画_20250114.md` 課題6（1309行目〜）、要約定義書・アーキテクチャ設計書・大原則

---

## 1. 前提の整理

### 1.1 要約定義書・アーキテクチャ・経緯

- **目的**: 宿泊施設管理者がYadOPERAを効果的に利用できるよう、操作手順・機能説明・トラブルシューティングをまとめた利用マニュアルを提供する。
- **現況**: 利用マニュアルは全12章実装済み（2026-01-17）。目次UXはシンプル化修正済み（2026-01-18）。トップへ戻るボタンのみ未実装。
- **大原則**（要約定義書 0. 大原則）:
  1. 根本解決 > 暫定解決
  2. **シンプル構造 > 複雑構造**
  3. **統一・同一化 > 特殊独自**（既存パターン・規約に従う）
  4. 具体的 > 一般
  5. 拙速 < 安全確実
  6. Docker環境必須 > ローカル直接実行

### 1.2 Phase 2 課題6の定義（計画書より）

- **問題**: 長いマニュアルをスクロールした後、トップに戻るボタンがない。ユーザビリティ低下。
- **影響範囲**: `Manual.vue`, `ManualContent.vue`（計画書では `ManualScrollToTop.vue` 新規＋Manual.vue 統合）。
- **優先度**: 低（UX改善のため有用）。
- **所要時間**: 約2時間（0.25日）。

---

## 2. コードベース現況

### 2.1 利用マニュアルページ構成

| ファイル | 役割 |
|----------|------|
| `frontend/src/views/admin/Manual.vue` | マニュアルページ。ヘッダー・モバイル目次トグル・目次（ManualToc）・本文（ManualContent）。**トップへ戻るボタンは未実装**。 |
| `frontend/src/components/admin/ManualContent.vue` | 12章のセクション・サブセクションを描画。スクロールコンテナではない。 |
| `frontend/src/components/admin/ManualToc.vue` | 目次。折りたたみ・リンクジャンプ。 |

### 2.2 スクロールが発生する場所（重要）

- **スクロールコンテナ**: `AdminLayout.vue` の `<main class="flex-1 overflow-y-auto p-6">` である。
- マニュアル本文はこの `<main>` のスロット内に描画されるため、**実際にスクロールするのは `window` ではなくこの `main` 要素**。
- そのため「トップへ戻る」は **この `main` 要素を `scrollTop = 0` にスムーススクロールする**必要がある。`window.scrollTo` だけでは効果がない。

### 2.3 既存の固定ボタン（統一・同一化の参照先）

- **ヘルプボタン**: `frontend/src/components/help/HelpButton.vue`
  - `Teleport to="body"` で body 直下に描画。
  - クラス: `fixed bottom-6 right-6 z-50`。円形 14x14、indigo、hover で scale-110。
  - `aria-label="ヘルプ"`, `title="ヘルプを表示"`。
- トップへ戻るボタンは **ヘルプボタンと重ならない位置**に置く必要がある（右下は既に使用中）。

### 2.4 共有スクリーンショットから分かること

- 管理画面「ご利用マニュアル」は縦長でスクロールバーあり。
- 右下に青い円形のヘルプボタン（`fixed bottom-6 right-6 z-50`）が既に存在。
- トップへ戻るボタンは、**左下**に配置するのが自然（統一感を保ちつつ重ならない）。

---

## 3. 実装方針（大原則準拠）

- **統一・同一化**: ヘルプボタンと同様に `Teleport to="body"` ＋ `fixed` ＋ Tailwind、円形ボタン・ホバー表現を踏襲。配置のみ「右下」→「左下」で差別化。
- **シンプル構造**: 専用コンポーネント 1 本（`ManualScrollToTop.vue`）に責務を限定。表示はマニュアルページのみ（`Manual.vue` でだけ使う）。
- **具体的**: スクロール監視・クリック時のスクロール先は「AdminLayout の main」に明示的に合わせる（後述の `data-admin-main` で取得）。

### 3.1 スクロールコンテナの取得方法

- **案A**: `ManualScrollToTop` 内で `document.querySelector('[data-admin-main]')` で取得する。  
  → **採用**: AdminLayout の `<main>` に `data-admin-main` を付与するだけなので変更が少なく、マニュアルページ以外では当該要素が無い場合はフォールバックで `document.documentElement` を使用可能。
- **案B**: provide/inject で scroll コンテナを渡す。  
  → レイアウトと子の結合が強くなり、シンプルさの点で案Aを優先。

**結論**: AdminLayout の `<main>` に `data-admin-main` を付与し、`ManualScrollToTop` では `querySelector('[data-admin-main]')` で取得。取得できない場合（将来レイアウト変更時など）は `window` をフォールバックとする。

### 3.2 表示条件・閾値

- 計画書どおり「スクロール位置が一定以上（例: 300px）で表示」。
- 閾値は **300px** とする（変更しやすいよう定数で定義）。

### 3.3 ボタン配置

- **位置**: `fixed bottom-6 left-6 z-50`（ヘルプは right-6 のため重ならない）。
- アイコン: 上向き矢印（トップへ戻るの一般的な表現）。
- アクセシビリティ: `aria-label="トップへ戻る"`, `title="トップへ戻る"`。

### 3.4 スタイル・ダークモード

- Tailwind でヘルプボタンと同系統（円形・影・hover）にしつつ、色は「トップへ戻る」用にグレー系（`gray-600` / `gray-700`）でヘルプの indigo と区別。
- ダークモード: `dark:bg-gray-600 dark:hover:bg-gray-500` 等で対応。

---

## 4. 実装ステップ（案）

### ステップ1: AdminLayout の main にスクロール用属性を付与（約10分）

- **ファイル**: `frontend/src/layouts/AdminLayout.vue`
- **変更**: `<main class="flex-1 overflow-y-auto p-6">` を  
  `<main class="flex-1 overflow-y-auto p-6" data-admin-main>` に変更。
- **理由**: トップへ戻るが「どの要素をスクロールするか」をコード上で明確にし、将来のレイアウト変更にも対応しやすくする。

### ステップ2: ManualScrollToTop.vue の新規作成（約1時間）

- **パス**: `frontend/src/components/admin/ManualScrollToTop.vue`
- **責務**:
  1. スクロールコンテナの取得: `document.querySelector('[data-admin-main]')`、無ければ `window` を利用。
  2. スクロール監視: コンテナが `main` の場合は `scroll` イベント、`window` の場合は `window` の `scroll` を監視。
  3. 閾値 300px 以上で表示、未満で非表示（フェードイン/アウトは transition で簡易実装）。
  4. クリック時: 取得したコンテナが要素なら `element.scrollTo({ top: 0, behavior: 'smooth' })`、`window` なら `window.scrollTo({ top: 0, behavior: 'smooth' })`。
- **テンプレート**: `Teleport to="body"`、`fixed bottom-6 left-6 z-50`、上向き矢印 SVG、`aria-label` / `title`。
- **スタイル**: Tailwind、ダークモード対応。表示/非表示は `v-show` ＋ `transition`。

### ステップ3: Manual.vue への組み込み（約15分）

- **ファイル**: `frontend/src/views/admin/Manual.vue`
- **変更**:
  - `ManualScrollToTop` を import し、テンプレートの `manual-container` の末尾（`</div>` の直後でも、同じ階層で問題ない位置）に `<ManualScrollToTop />` を追加。
- マニュアルページでのみ表示されるようにする（ルートが `/admin/manual` のときだけ描画する必要はない。Manual.vue がマウントされているときだけ表示されれば十分）。

### ステップ4: スタイル・アクセシビリティ・動作確認（約30分）

- ボタンの見た目（ライト/ダーク）、ヘルプボタンとの重なりなしを確認。
- スクロール 300px 以上で表示・未満で非表示になること、クリックでトップにスムーススクロールすることを確認。
- キーボード操作（Tab でフォーカス、Enter で実行）と `aria-label` の読み上げを確認。

### ステップ5: Docker 環境でのブラウザ確認（約15分）

- 大原則「Docker環境必須」に従い、docker-compose でフロントを起動し、`/admin/manual` で上記を再確認。

---

## 5. 実装ファイル一覧

| 種別 | ファイル |
|------|----------|
| 新規 | `frontend/src/components/admin/ManualScrollToTop.vue` |
| 修正 | `frontend/src/views/admin/Manual.vue`（ManualScrollToTop の import と 1 行追加） |
| 修正 | `frontend/src/layouts/AdminLayout.vue`（`data-admin-main` の付与のみ） |

`ManualContent.vue` は変更しない（計画書の「影響範囲」に含まれているが、今回の機能は「表示＋クリックでスクロール」のみで足りるため）。

---

## 6. 完了条件

- マニュアルページで下方向に 300px 以上スクロールすると、左下にトップへ戻るボタンが表示される。
- クリックすると、メインコンテンツがトップまでスムーススクロールする。
- ヘルプボタン（右下）と重ならず、ダークモードでも視認・操作できる。
- Docker 環境で動作確認済みである。
- 大原則（シンプル構造・統一・同一化・具体的・安全確実・Docker で検証）を満たしている。

---

## 7. 注意事項

- **指示があるまで実装しない**: 本計画は提案であり、実装は指示があった時点で行う。
- **z-index**: ヘルプボタンが `z-50` のため、トップへ戻るも `z-50` でよい。左右で分かれるため競合しない。
- **モバイル**: `bottom-6 left-6` はスマホでもはみ出さない想定。必要なら後から `left-4` 等に変更可能。

---

**Document Version**: 1.0  
**Status**: 提案・計画のみ（未実装）
