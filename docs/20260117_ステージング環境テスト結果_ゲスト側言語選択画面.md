# ステージング環境テスト結果 - ゲスト側言語選択画面プラン対応言語フィルタリング

**作成日時**: 2026年01月17日  
**目的**: ステージング環境でのゲスト側言語選択画面プラン対応言語フィルタリングのテスト結果  
**状態**: ⚠️ **テスト用施設データ不足**

---

## 1. テスト環境

### 1.1 APIヘルスチェック

**ステージング環境API**: ✅ 正常動作
- URL: `https://yadopera-backend-staging.onrender.com`
- ヘルスチェック: ✅ 成功
```json
{
    "status": "healthy",
    "database": "connected",
    "redis": "connected"
}
```

### 1.2 テスト用施設データ

**問題**: ❌ テスト用施設データが存在しない

以下のslugでテストを実行しましたが、すべて404エラーが発生しました:
- `test-facility-free-4975ca89` (Freeプラン)
- `test-facility-mini-b7695aea` (Miniプラン)
- `test-facility-small-492548ab` (Smallプラン)
- `test-facility-standa-4caf15b3` (Standardプラン)
- `test-facility-premiu-9455eb18` (Premiumプラン)

---

## 2. テスト結果

### 2.1 APIテスト結果

**テストスクリプト**: `backend/test_staging_facility_available_languages.py`

**結果**: ❌ すべてのテストが失敗（404エラー）

```
テスト結果サマリー
============================================================
✅ 成功: 0/5
❌ 失敗: 5/5
⚠️  エラー: 0/5

詳細:
  ❌ Free: []
  ❌ Mini: []
  ❌ Small: []
  ❌ Standard: []
  ❌ Premium: []
```

**エラーメッセージ**:
```json
{
    "error": {
        "code": "NOT_FOUND",
        "message": "Facility not found",
        "details": {}
    }
}
```

---

## 3. 問題の原因

ステージング環境にテスト用施設データが存在しないため、APIテストが実行できませんでした。

---

## 4. 推奨事項

### 4.1 テスト用施設データの作成

以下のいずれかの方法でテスト用施設データを作成してください:

1. **既存の施設データを使用**
   - ステージング環境に既存の施設データがある場合は、そのslugを使用してテストを実行

2. **テスト用施設データを作成**
   - `backend/create_staging_test_data.py`を実行してテスト用施設データを作成
   - または、手動で各プランの施設データを作成

3. **既存の施設データを確認**
   - ステージング環境のデータベースを確認し、既存の施設データのslugを取得

### 4.2 テスト実行手順

1. ステージング環境のデータベース接続情報を取得
2. 環境変数`DATABASE_URL`を設定
3. テスト用施設データを作成（または既存データを確認）
4. テストスクリプトを実行

---

## 5. 次のステップ

1. ✅ ステージング環境のAPIヘルスチェック: 成功
2. ⚠️  テスト用施設データの作成: 必要
3. ⏳ APIテストの実行: テスト用施設データ作成後に実行
4. ⏳ ブラウザテストの実行: テスト用施設データ作成後に実行

---

## 6. 参考情報

- **テストスクリプト**: `backend/test_staging_facility_available_languages.py`
- **データベース確認スクリプト**: `backend/scripts/check_staging_db.py`
- **テストデータ作成スクリプト**: `backend/create_staging_test_data.py`

