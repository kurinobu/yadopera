# 残りテスト準備 - まとめ

**作成日時**: 2026年1月14日 17:15:00  
**目的**: 残りのテストデータ準備とテスト項目の整理  
**状態**: 準備完了

---

## 1. 完了した修正・準備

### 1.1 AI自動応答数の修正

**問題**: MiniプランでAI自動応答数が40件のデータを挿入したが、ダッシュボードには50件と表示される

**原因**: `get_ai_automation`メソッドが「会話数」を「AI自動応答数」として返していた

**修正**: AI自動応答数を「エスカレーションされなかった会話のAI自動応答メッセージ数」として正しくカウントするように修正

**結果**: ✅ 修正完了

---

### 1.2 テストデータの準備

#### Freeプラン（30件超過）
- ✅ 35件の質問を作成（テスト2-2用）

#### Smallプラン（警告範囲）
- ✅ 190件の質問を作成（テスト2-5用、95% = オレンジ表示）

#### Standardプラン（黄色テスト用）
- ✅ 225件の質問を作成（75% = 黄色表示）

---

## 2. テスト項目の整理

### 2.1 完了したテスト

1. ✅ **テスト2-1**: Freeプラン（30件以内） - 15件
2. ✅ **テスト2-3**: Miniプラン - 50件
3. ✅ **テスト2-6**: Smallプラン（超過） - 220件
4. ✅ **テスト2-7**: Standard/Premiumプラン - 表示確認完了

---

### 2.2 残りのテスト

#### テスト2-2: Freeプラン（30件超過）
- **データ**: ✅ 準備完了（35件）
- **期待結果**:
  - ✅ 「FAQのみ対応中」バッジが表示される（赤色）
  - ✅ プログレスバーは表示されない
  - ✅ ステータスが「faq_only」である

#### テスト2-4: Smallプラン（上限内）
- **データ**: ⚠️ 準備が必要（100件以下、例: 100件）
- **期待結果**:
  - ✅ プログレスバーが表示される
  - ✅ 使用率に応じた色分けが正しい（0-70%: 緑）
  - ✅ 「あと○○件で上限です」または「残り○○件です」メッセージが表示される

#### テスト2-5: Smallプラン（警告範囲）
- **データ**: ✅ 準備完了（190件、95% = オレンジ）
- **期待結果**:
  - ✅ プログレスバーがオレンジ色で表示される
  - ✅ 「⚠️ まもなく上限です（残り○○件）」メッセージが表示される
  - ✅ ステータスが「warning」である

#### 色分けテスト（黄色：71-90%）
- **データ**: ✅ 準備完了（Standardプラン: 225件、75% = 黄色）
- **期待結果**:
  - ✅ プログレスバーが黄色で表示される
  - ✅ 使用率が71-90%の範囲で正しく表示される

#### 色分けテスト（オレンジ：91-99%）
- **データ**: ✅ 準備完了（Smallプラン: 190件、95% = オレンジ）
- **期待結果**:
  - ✅ プログレスバーがオレンジ色で表示される
  - ✅ 使用率が91-99%の範囲で正しく表示される

---

## 3. 抜け落ちているテストの指摘

### 3.1 テスト2-4: Smallプラン（上限内）

**現状**: データが準備されていない

**対応**: Smallプランで100件のデータを作成する必要があります

---

### 3.2 「ステータスが「normal」である」の説明

**質問**: 「ステータスが「normal」である」の意味が分からない

**説明**:
- `status`は`MonthlyUsageResponse`のフィールドで、以下の値を取ります:
  - `'normal'`: 通常状態（上限内で警告なし）
  - `'warning'`: 警告状態（上限の91-99%）
  - `'overage'`: 超過状態（上限を超過）
  - `'faq_only'`: FAQのみ対応中（Freeプランで30件超過）

**テスト2-1での意味**:
- Freeプランで15件（30件以内）の場合、`status = 'normal'`が返される
- これは「通常状態」を意味し、プログレスバーが緑色で表示される

---

## 4. 残りのテストデータ準備

### 4.1 Smallプラン（上限内：100件）のデータ作成

**必要**: テスト2-4用に100件のデータを作成

**手順**:
1. Smallプランの既存データを削除
2. 100件の質問を作成
3. 適切なAI自動応答数とエスカレーション数を設定

---

## 5. テスト実行順序

### 推奨順序

1. **テスト2-2**: Freeプラン（30件超過） - データ準備完了 ✅
2. **テスト2-4**: Smallプラン（上限内） - データ準備が必要 ⚠️
3. **テスト2-5**: Smallプラン（警告範囲） - データ準備完了 ✅
4. **色分けテスト（黄色）**: Standardプラン（225件） - データ準備完了 ✅
5. **色分けテスト（オレンジ）**: Smallプラン（190件） - データ準備完了 ✅

---

**Document Version**: v1.0  
**Author**: Auto (AI Assistant)  
**Last Updated**: 2026年1月14日 17:15:00  
**Status**: 準備完了

