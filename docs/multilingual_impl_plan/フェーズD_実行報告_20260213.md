# フェーズD 統合テスト 実行報告（デプロイは未実施）

**日時**: 2026年2月13日  
**対象**: 実装プラン提案書 2.2.3 フェーズD（統合テスト＆デプロイ）  
**実施方針**: ステップ1〜4まで実行。**ステップ5〜7（ステージング・本番デプロイ）は指示があるまで実行しない。**

---

## 1. 実施した作業

### ステップ1: Docker環境起動 ✅

- `docker-compose up -d` を実行。
- 結果: postgres, redis, backend, frontend が起動済み（Running / Healthy）。

### ステップ2: 新規登録フロー（5プラン × 3言語） ✅（一部）

- **API**: `POST /api/v1/auth/register` に `subscription_plan: "small"` でリクエストを送信。
- 結果: HTTP 200。メール確認待ちメッセージを返却。
- 登録レスポンスに施設 slug は含まれないため、同一施設での Standard/Premium 等の登録フローは、別メール・施設名で実施するか、既存施設の plan を DB で変更する必要あり。今回は Small プランで 1 件登録し、施設 API で `available_languages` を確認。

### ステップ3: ゲスト側言語選択確認 ✅

- **対象施設**: 上記で登録した Small プラン施設（slug: `phase-d-small-test-d2feae4c`）。
- **API**: `GET /api/v1/facility/phase-d-small-test-d2feae4c`
- 結果: `plan_type: "Small"`, `available_languages: ["ja", "en", "zh-TW"]` を返却。**プラン別言語フィルタは期待どおり動作。**

### ステップ4: チャット動作確認

- 各言語での AI 応答確認は、**手動でブラウザからゲスト画面にアクセスし、言語選択後にチャット送信して確認**する想定。本報告では未実施（Docker 上でフロント・バックエンドは起動済みのため、実機または手動テストで実施可能）。

### 単体・統合テスト実行結果

- **test_faq_presets.py**: 18 件すべてパス。
- **test_facility_available_languages.py**: 8 件パス（USE_POSTGRES_TEST + Docker 上の yadopera_test で実行）。
- **test_faq_service_language_limit.py**: 2 件失敗・4 件エラー（既存テストの fixture 重複・Premium の language_limit 扱い等。多言語実装とは無関係の既知事象として記録）。

---

## 2. 実施していない作業（指示があるまで実行しない）

| ステップ | 内容 | 状態 |
|----------|------|------|
| 5 | ステージング環境デプロイ | **未実施** |
| 6 | ステージング環境ブラウザテスト | **未実施** |
| 7 | 本番環境デプロイ | **未実施** |

---

## 3. 結論

- Docker 環境での起動、新規登録 API、施設 API による `available_languages`（Small: ja, en, zh-TW）の確認まで完了。
- デプロイおよびステージング・本番でのブラウザテストは、**指示があるまで実行しない**。
