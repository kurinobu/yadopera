# 多言語実装 ローカルブラウザテスト準備

**作成日**: 2026年2月13日  
**目的**: 翻訳文修正後、ローカル環境で即座にブラウザテストを実行できるようテスト環境を整え、アクセスURLを提示する。

---

## 1. テスト環境の起動

### 1.1 Docker の起動（必須）

```bash
cd /Users/kurinobu/projects/yadopera
docker-compose up -d
```

- **postgres** (port 5433), **redis** (6379), **backend** (8000), **frontend** (5173) が起動します。
- 起動確認: `docker-compose ps` で各コンテナが `Up` または `running` であること。

### 1.2 バックエンドの反映（翻訳修正後）

`backend/app/data/faq_presets.py` を修正した場合は、バックエンドを再起動してください。

```bash
docker-compose restart backend
```

---

## 2. アクセスURL一覧

| 用途 | URL | 備考 |
|------|-----|------|
| **フロントエンド（トップ）** | **http://localhost:5173** | ブラウザテストの起点。 |
| **ゲスト：5言語テスト（Premium）** | **http://localhost:5173/f/test-hotel-premium-d4bdfcae** | **ja, en, zh-TW, fr, ko すべてテスト用。** |
| **ゲスト：4言語テスト（Standard）** | http://localhost:5173/f/test-hotel-standard-17d4c0ca | ja, en, zh-TW, fr テスト用。 |
| **ゲスト：言語選択（任意slug）** | http://localhost:5173/f/{施設slug} | プランにより表示言語数が異なる。 |
| **ゲスト：ウェルカム** | http://localhost:5173/f/{施設slug}/welcome?lang=**ja** など | 言語クエリで表示言語。 |
| **ゲスト：チャット** | http://localhost:5173/f/{施設slug}/chat | 選択言語でAIチャット。 |
| **管理者ログイン** | http://localhost:5173/admin/login | 施設管理者ログイン。 |
| **新規登録** | http://localhost:5173/admin/register | 施設登録（プラン選択可）。 |
| **バックエンドAPI（ヘルス）** | http://localhost:8000/api/v1/health | 200 で稼働確認。 |
| **施設情報API（例）** | http://localhost:8000/api/v1/facility/{施設slug} | `available_languages` 確認用。 |

---

## 3. 多言語ブラウザテスト用の施設URL（即時アクセス用）

**重要**: 今回の実装では **5言語（ja, en, zh-TW, fr, ko）** を追加しています。**フランス語（fr）と韓国語（ko）までテストするには、Small プランでは不十分です。** Standard または Premium プランの施設URLでテストしてください。

以下の施設 slug は、Docker 上の DB に既に存在する施設の例です。

| プラン | 表示される言語 | 施設 slug（例） | ゲスト言語選択URL |
|--------|----------------|-----------------|--------------------|
| **Premium** | **5言語（ja, en, zh-TW, fr, ko）** すべて | `test-hotel-premium-d4bdfcae` | **http://localhost:5173/f/test-hotel-premium-d4bdfcae** |
| **Standard** | 4言語（ja, en, zh-TW, **fr**） | `test-hotel-standard-17d4c0ca` | **http://localhost:5173/f/test-hotel-standard-17d4c0ca** |
| Small | 3言語（ja, en, zh-TW）のみ | `phase-d-small-test-d2feae4c` | http://localhost:5173/f/phase-d-small-test-d2feae4c |

- **フランス語・韓国語を含む全実装のテスト**: 上記 **Premium** のURLを開き、言語選択で Français・한국어 が表示されること、および選択後にチャットで各言語のFAQ・AI応答が返ることを確認してください。
- **フランス語までテスト**: **Standard** のURLで Français まで確認可能です。
- Small のみでは zh-TW までしか表示されず、**fr・ko はテストできません。**

**新規で施設を登録する場合**

1. http://localhost:5173/admin/register で登録（subscription_plan は small / standard / premium 等を選択）。
2. 登録後、DBで該当施設の `slug` を確認するか、メール確認完了後に管理者ログインし、施設設定やQRコード画面からゲスト用URLを確認。
3. ゲスト用URLは `http://localhost:5173/f/{slug}` の形式です。

---

## 4. 推奨テスト手順（多言語・5言語すべて）

1. **環境起動**: `docker-compose up -d` → 必要に応じて `docker-compose restart backend`
2. **ゲスト言語選択（5言語すべて）**: ブラウザで **http://localhost:5173/f/test-hotel-premium-d4bdfcae** を開く
3. **表示確認**: 日本語・English・繁體中文・**Français**・**한국어** の5言語が表示されること
4. **各言語でフロー確認**: 上記5言語をそれぞれ選択 → ウェルカム → チャットで質問送信し、**フランス語・韓国語を含め**該当言語で回答が返ることを確認
5. **Standard（4言語）**: http://localhost:5173/f/test-hotel-standard-17d4c0ca で ja, en, zh-TW, fr が表示・動作することを確認
6. **Small（3言語）**: 必要に応じて Small のURLで ja, en, zh-TW のみ表示されることを確認

---

## 5. ブラウザテスト用 チャット質問例文（各言語3つ）

ゲスト画面で言語を選択したあと、チャット欄に以下をコピー＆ペーストして送信し、**該当言語で回答が返る**ことを確認してください。FAQプリセットと対応しているため、AIが回答を返しやすい用例です。

### 繁体中国語（zh-TW）— 3例

| # | 質問文（コピー用） | 想定カテゴリ |
|---|-------------------|--------------|
| 1 | 晚上有安靜規定嗎？ | 夜間静音ルール |
| 2 | 淋浴隨時可以使用嗎？ | シャワー利用 |
| 3 | 最近車站怎麼走？ | 最寄り駅 |

### フランス語（fr）— 3例

| # | 質問文（コピー用） | 想定カテゴリ |
|---|-------------------|--------------|
| 1 | Y a-t-il des règles de calme la nuit ? | 夜間静音ルール |
| 2 | Puis-je utiliser la douche à tout moment ? | シャワー利用 |
| 3 | Comment aller à la gare la plus proche ? | 最寄り駅 |

### 韓国語（ko）— 3例

| # | 質問文（コピー用） | 想定カテゴリ |
|---|-------------------|--------------|
| 1 | 밤에 정숙 규칙이 있나요? | 夜間静音ルール |
| 2 | 샤워는 언제든 사용할 수 있나요? | シャワー利用 |
| 3 | 가장 가까운 역까지 어떻게 가나요? | 最寄り駅 |

**使い方**: 各言語を選択 → チャット画面で上記の文を1つずつ送信 → 同じ言語で回答が返ることを確認。

---

## 6. 状態

- 翻訳文の修正（zh-TW 敬語「您」の追加）とバックアップは完了済み。
- バックエンドは再起動済みのため、**上記URLを開くだけでローカルブラウザテストを即時実行可能**です。
- テスト準備は以上で完了です。§5 の例文でチャット応答の言語一致を確認してください。
