# 翻訳手引書＆多言語実装プラン提案書 — 評価報告

**評価日**: 2026年2月13日  
**評価対象**: `docs/multilingual_impl_plan/実装プラン提案書_20260207.md`  
**基準文書**: 要約定義書 v0.3、アーキテクチャ設計書 v0.3、Phase3_現況と残存課題_実装計画_20260209.md、関連引き継ぎ書・多言語計画書  
**目的**: 多言語実装を実行できるか、矛盾・抜け落ち・順序誤りがないかを評価する。**実装は指示があるまで行わない。**

---

## 1. 目的・全体像・経緯・現況・大原則の把握結果

### 1.1 目的・全体像（要約定義書・Phase3文書より）

- **やどぺら**: 小規模宿泊施設向け外国人ゲスト対応自動化SaaS。QRコードでAIが24時間多言語自動応答。
- **フェーズ**: Phase 0〜1 完了、Phase 2 完了、**Phase 3 実行中（PoC実施）**、Phase 4 未着手（本格展開準備）。
- **多言語の位置づけ（公式）**: 要約定義書 7章 Phase 4 に「**多言語対応（アンケート結果に基づく優先言語）**」と明記。Phase3_現況と残存課題では「**多言語対応（3言語追加・Phase 4 必須）**」「予測作業時間: 5〜7日（40〜56時間）」と記載。

### 1.2 大原則（要約定義書 §0）

1. 根本解決 > 暫定解決  
2. シンプル構造 > 複雑構造  
3. 統一・同一化 > 特殊独自  
4. 具体的 > 一般  
5. 拙速 < 安全確実  
6. **Docker環境必須** > ローカル直接実行  

提案書は大原則（特に §6 Docker環境必須）に言及しており整合している。

### 1.3 ブランチ・デプロイ（要約定義書 v0.3.1）

- **main**: 本番（Render.com）
- **develop**: ステージング（Railway Hobby）
- **feature/\***: 機能開発  

提案書の「develop → main マージ」「ステージングで2〜3日実機テスト」はこれと一致している。

---

## 2. コードベース調査結果（実態）

### 2.1 Docker環境

- **docker-compose.yml**: postgres（pgvector/pg15）、redis、backend（FastAPI）、frontend（Vite）の4サービス。ポート 5433/6379/8000/5173。  
- **結論**: 本番同等のDocker環境は整っており、提案書の「Docker環境必須」「docker-compose up -d」は実行可能。

### 2.2 バックエンド実態

| 対象 | 状態 | 備考 |
|------|------|------|
| **plan_limits.py** | 3言語対応済み | small: `["ja","en","zh-TW"]`、standard: `["ja","en","zh-TW","fr"]`、premium: `languages: None`。 |
| **facility_service.py** | Premiumで5言語 | Premium時は `available_languages = ["ja","en","zh-TW","fr","ko"]` を固定設定。 |
| **filter_faq_presets_by_plan()** | 実装済み | プラン別 `languages` でプリセットの `translations` をフィルタ。 |
| **auth_service.py** | 既存ロジックで可 | `_setup_default_faqs` で `filter_faq_presets_by_plan(FAQ_PRESETS, subscription_plan)` を呼び出し。プリセットに zh-TW/fr/ko が含まれればそのまま利用可能。 |
| **faq_presets.py** | **未対応** | 30FAQ × **2言語（ja, en）のみ**。zh-TW, fr, ko の翻訳が無い。 |
| **API /facility/{slug}** | 対応済み | `facility_info.available_languages` を返却。 |
| **faq_translations / facilities** | スキーマ対応済み | `language VARCHAR(10)`、`languages TEXT[]` で3言語追加に変更不要。 |

**結論**: 実装で必要なのは **faq_presets.py への 30FAQ×3言語（zh-TW, fr, ko）= 90翻訳の追加**。plan_limits・facility_service・auth_service・API・DB は既に多言語を前提とした実装になっている。

### 2.3 フロントエンド実態

- **constants.ts**: 9言語定義済み（ja, en, zh-TW, fr, ko, es, de, th, vi）。  
- **LanguageSelect.vue**: `response.facility.available_languages` でフィルタして表示。バックエンドが正しく返せば修正不要。  
- **結論**: 提案書の「フロントエンド修正不要の見込み」は現状のコードと一致している。

### 2.4 テスト

- **backend/tests/test_facility_available_languages.py**: Free/Mini/Small/Standard/Premium の `available_languages` を検証するテストが既に存在（zh-TW, fr, ko を期待）。  
- 提案書の「単体テスト実装」「統合テスト」は、既存テストの拡張・Docker上での実行として実行可能。

---

## 3. 矛盾の有無

### 3.1 【要修正】Phase 3 と Phase 4 の記載の矛盾

| 文書 | 記載 |
|------|------|
| **要約定義書 7章** | Phase 4: 本格展開準備に「**多言語対応（アンケート結果に基づく優先言語）**」 |
| **Phase3_現況と残存課題 §5.2** | 「**多言語対応（3言語追加・Phase 4 必須）**」「予測作業時間: 5〜7日」 |
| **実装プラン提案書** | 末尾「**実装フェーズ: Phase 3（多言語対応）**」、§2.2.1「Phase 3実装予定」 |
| **多言語実装計画書（修正版）** | §1.4「**Phase 3（PoC実施中）で実装**」 |

**評価**: 公式の要約定義書および Phase3_現況文書では多言語は **Phase 4 必須**。提案書と多言語実装計画書は **Phase 3** としているため、**フェーズの記載が矛盾**している。

**推奨**:  
- 実装プラン提案書上は「**Phase 4 必須項目である多言語対応（3言語追加）**」と明記する。  
- あるいは「Phase 4 必須を Phase 3 で先行実施する」と読み取れるように、Phase 4 との関係を1行で注記する。  
- いずれにしても、要約定義書・Phase3_現況文書との整合を取る修正を推奨する。

### 3.2 その他の矛盾

- **翻訳手引書の言語**: honyaku-tebikisho.md は「英語・繁体中国語」を対象としている。実装は **繁体中国語・フランス語・韓国語** の3言語追加。手引書にフランス語・韓国語が含まれていないが、手引書は「施設管理者がFAQを翻訳する際のガイド」であり、**システム側の初期プリセット（FAQ_PRESETS）とは別の目的**なので、矛盾というより「手引書の対象言語と実装で追加する言語の差」として付録や注記で補足するとよい。
- **INITIAL_FAQ_COUNTS**: 提案書は「30個のFAQ」「90翻訳」としている。plan_limits.py では **INITIAL_FAQ_COUNTS は全プラン20件**で、`filter_faq_presets_by_plan` は優先度順の上位20件を使用。30個のプリセットのうち20件が新規登録で投入される。この「30プリセット中20件を使用」の関係は提案書に明示がないが、実装可否には影響しない（30個すべてに5言語分の翻訳を用意すれば、フィルタ後も20件×プラン別言語で問題ない）。

---

## 4. 抜け落ちの有無

### 4.1 軽微な抜け・補足推奨

| 項目 | 内容 | 推奨 |
|------|------|------|
| **Phase 4 との関係** | 上記のとおり、Phase 4 必須である旨の明記がない。 | 提案書に「Phase 4 必須」または「Phase 4 を前倒し」の1行を追加。 |
| **既存施設への影響** | 既存登録施設は faq_presets の変更のみでは自動で zh-TW/fr/ko が付かない。 | 「既存施設は対象外（新規登録時のみ）」または「既存施設への一括付与は別タスク」と一文あるとよい。 |
| **embedding 生成** | 新言語の faq_translations 登録時に embedding を生成する既存フロー（faq_service 等）の記載が薄い。 | 既存の create_faq / 埋め込み生成に任せる前提であれば「既存ロジックで embedding 生成」と一言あると安心。 |
| **言語コード表記** | zh-TW / fr / ko は API・DB・constants と統一されている。 | 特になし。 |

### 4.2 提案書に含まれており妥当なもの

- 翻訳手引書の目的・開発チーム向けQAプロセス（別紙1）の推奨。  
- フェーズA（翻訳）→ B（バックエンド）→ C（フロント確認）→ D（統合・デプロイ）の順序。  
- Docker 必須・ステージングで実機テスト・develop → main の流れ。  
- リスクと対策（翻訳品質・バックエンド・フロント・デプロイ）。  
- 既存の plan_limits / auth_service / facility_service / LanguageSelect を「動作確認のみ」とする判断。

---

## 5. 順序の適否

- **翻訳作業 → FAQ_PRESETS 追加 → 動作確認・単体テスト → 統合テスト → ステージングデプロイ → 本番** の順で問題ない。  
- 依存関係: 翻訳が無いと faq_presets に追加できない。バックエンド変更（実質 faq_presets.py）の後にフロント確認・統合テストでよい。  
- **順序間違えはない**。

---

## 6. 多言語実装の実行可否

| 観点 | 判定 | 補足 |
|------|------|------|
| **矛盾** | 要修正 | Phase 3 / Phase 4 の表記を要約定義書・Phase3_現況文書に合わせる修正を推奨。 |
| **抜け** | 軽微 | Phase 4 明記・既存施設の扱い・embedding の言及を足すとより明確。 |
| **順序** | 問題なし | 翻訳→実装→検証→デプロイの流れで実行可能。 |
| **コード・環境** | 実行可能 | Docker・plan_limits・facility_service・API・フロントは既に前提を満たしている。不足は faq_presets.py の90翻訳のみ。 |

**総合**: **矛盾の修正（Phase 表記）と軽微な補足を反映すれば、多言語実装は実行可能**。実装そのものは「faq_presets.py への zh-TW/fr/ko の90翻訳追加」が中心で、既存コードと整合している。

---

## 7. 推奨アクション（実装は行わず文書のみ）

1. **実装プラン提案書の修正**  
   - 「実装フェーズ: Phase 3（多言語対応）」を「**Phase 4 必須（多言語対応・3言語追加）**」または「Phase 4 必須項目を Phase 3 で先行実施」に合わせて修正。  
   - 要約定義書・Phase3_現況と残存課題との参照を1箇所で明示する。

2. **軽微な追記**  
   - 既存施設は新規登録時のみプリセットが効く旨（または既存施設は別対応とする旨）。  
   - 新言語の embedding は既存の FAQ 登録フローで生成される旨。

3. **翻訳手引書**  
   - 施設管理者向けは「英語・繁体中国語」のままでも可。フランス語・韓国語を施設が自分で翻訳する場合は、付録で対象言語を「繁体中国語・フランス語・韓国語」に拡張する選択肢を記載するとよい。

4. **実装**  
   - **指示があるまで実装は行わない**（ご指示どおり）。

---

---

## 8. 文書修正・実装準備の完了（2026年2月13日）

評価に基づき以下を実施済み。**実装は指示があるまで行わない。**

- **実装プラン提案書**の修正・補足  
  - Phase 4 必須の明記、既存施設・embedding の補足、翻訳手引書と言語の注記、§8 実装準備チェックリストの追加。
- **実装準備メモ**の作成  
  - `実装準備メモ_20260213.md` に、実施済み内容・中心作業・参照文書・指示後の流れを記載。

実装準備は整っている。指示後に `実装プラン提案書_20260207.md` §8.3 および `実装準備メモ_20260213.md` に従って着手可能。

---

**Document Version**: 1.1  
**評価者**: AI Assistant  
**Status**: 評価完了。文書修正・実装準備完了。実装は未実施。
