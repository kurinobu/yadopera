# ã‚„ã©ãºã‚‰ v0.1 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸

**ä½œæˆæ—¥**: 2025å¹´11æœˆ18æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v0.1 (MVPä»•æ§˜)  
**å¯¾è±¡**: ã‚„ã©ãºã‚‰ - å°è¦æ¨¡å®¿æ³Šæ–½è¨­å‘ã‘å¤–å›½äººã‚²ã‚¹ãƒˆå¯¾å¿œè‡ªå‹•åŒ–SaaS

---

## ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#2-ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [UX/UIãƒ•ãƒ­ãƒ¼å›³](#3-uxuiãƒ•ãƒ­ãƒ¼å›³)
4. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#4-ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
5. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#5-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
6. [APIè¨­è¨ˆ](#6-apiè¨­è¨ˆ)
7. [èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£](#7-èªè¨¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)
8. [AIå¯¾è©±ã‚¨ãƒ³ã‚¸ãƒ³è¨­è¨ˆ](#8-aiå¯¾è©±ã‚¨ãƒ³ã‚¸ãƒ³è¨­è¨ˆ)
9. [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°](#9-ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°)
10. [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ](#10-ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ)
11. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶](#11-ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶)
12. [é–‹ç™ºè¦ç´„](#12-é–‹ç™ºè¦ç´„)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ã‚·ã‚¹ãƒ†ãƒ ã®ç›®çš„

å°è¦æ¨¡å®¿æ³Šæ–½è¨­ã®å¤–å›½äººã‚²ã‚¹ãƒˆå¯¾å¿œã‚’è‡ªå‹•åŒ–ã—ã€ãƒ•ãƒ­ãƒ³ãƒˆæ¥­å‹™ã‚’90%å‰Šæ¸›ã™ã‚‹ã€‚

### 1.2 ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ã‚²ã‚¹ãƒˆå´UI    â”‚ (Vue.js 3 + Tailwind CSS)
â”‚  QRã‚³ãƒ¼ãƒ‰èª­å–å¾Œ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTPS
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç®¡ç†è€…å´UI    â”‚ (Vue.js 3 + Tailwind CSS)
â”‚  æ–½è¨­ç®¡ç†ç”»é¢   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTPS
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      FastAPI Backend        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ REST APIâ”‚  AI Engine  â”‚  â”‚
â”‚  â”‚ /api/v1/â”‚  (GPT-4o-m) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL 15  â”‚     â”‚ OpenAI API   â”‚
â”‚   (Render.com)  â”‚     â”‚ GPT-4o-mini  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
|---------|------|-----------|
| Frontend | Vue.js | 3.4+ |
| CSS Framework | Tailwind CSS | 3.4+ |
| HTTP Client | Axios | 1.6+ |
| Backend | FastAPI | 0.109+ |
| ORM | SQLAlchemy | 2.0+ |
| Migration | Alembic | 1.13+ |
| Database | PostgreSQL | 15+ |
| AI | OpenAI API | GPT-4o-mini |
| Hosting | Render.com | Pro Plan |
| Language | Python | 3.11+ |

---

## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 2.1 ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Presentation Layer              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Guest UI    â”‚  â”‚  Admin UI    â”‚    â”‚
â”‚  â”‚  (Vue.js 3)  â”‚  â”‚  (Vue.js 3)  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ HTTPS/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Application Layer              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚      FastAPI Application       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ Routers  â”‚  â”‚ Middleware â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Business Layer                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Services â”‚  â”‚  AI Chat Engine  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Data Access Layer              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Repository â”‚  â”‚  SQLAlchemy ORM â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Database / External APIs        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PostgreSQL   â”‚  â”‚  OpenAI API    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

#### ã‚²ã‚¹ãƒˆè³ªå• â†’ AIå¿œç­”ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ Guestâ”‚
â””â”€â”€â”€â”¬â”€â”€â”˜
    â”‚ 1. QRã‚³ãƒ¼ãƒ‰èª­å–
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vue.js (Guest)â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ 2. POST /api/v1/chat/message
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastAPI Router    â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ 3. ChatService.process_message()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Chat Engine            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Layer 1: Template   â”‚   â”‚
â”‚ â”‚ Match (FAQ)         â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚ No Match     â”‚
â”‚            â†“              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Layer 2: Category   â”‚   â”‚
â”‚ â”‚ Classification      â”‚   â”‚
â”‚ â”‚ (GPT-4o-mini)       â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â†“              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Layer 3: AI         â”‚   â”‚
â”‚ â”‚ Generated Response  â”‚   â”‚
â”‚ â”‚ (GPT-4o-mini)       â”‚â”€â”€â”€â”¼â”€â”€â†’ OpenAI API
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ 4. Save to DB
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL    â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ 5. Return response
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vue.js (Guest)â”‚
â”‚ Display answerâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. UX/UIãƒ•ãƒ­ãƒ¼å›³

### 3.1 ã‚²ã‚¹ãƒˆå´ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QRã‚³ãƒ¼ãƒ‰æ²ç¤º   â”‚
â”‚  (entrance/     â”‚
â”‚   room/kitchen) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ã‚¹ãƒãƒ›ã§èª­å–
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¨€èªé¸æŠç”»é¢               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ‡¬ğŸ‡§ English (MVP)    â”‚  â”‚
â”‚  â”‚  ğŸ‡¹ğŸ‡¼ ç¹ä½“ä¸­æ–‡ (Phase2)â”‚  â”‚
â”‚  â”‚  ğŸ‡«ğŸ‡· FranÃ§ais (Phase3)â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ã‚¿ãƒƒãƒ—
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ‘‹ Welcome to [å®¿å]!     â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚ ã‚ˆãã‚ã‚‹è³ªå• TOP3          â”‚  â”‚
â”‚  â”‚ â€¢ WiFi password?          â”‚  â”‚
â”‚  â”‚ â€¢ Check-in time?          â”‚  â”‚
â”‚  â”‚ â€¢ Nearest station?        â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ’¬ Ask anything!    â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚ ğŸ†˜ Emergency: [é›»è©±ç•ªå·]  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ è³ªå•å…¥åŠ›
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Guest: Where is the      â”‚  â”‚
â”‚  â”‚        laundry room?     â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚
â”‚  â”‚ Bot:  The laundry room   â”‚  â”‚
â”‚  â”‚       is on the 2nd...   â”‚  â”‚
â”‚  â”‚       [3ç§’ä»¥å†…å¿œç­”]       â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â”‚ Type your message... â”‚  â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”‚  [AIå›ç­”ä¸å¯ã®å ´åˆ]              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Sorry, I couldn't answer.â”‚  â”‚
â”‚  â”‚ ğŸ“ Contact staff?        â”‚  â”‚
â”‚  â”‚ [Yes] [No]               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç®¡ç†ç”»é¢ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢   â”‚
â”‚  Email/Password â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“Š é€±æ¬¡ã‚µãƒãƒªãƒ¼             â”‚  â”‚
â”‚  â”‚  ç·è³ªå•æ•°: 127ä»¶            â”‚  â”‚
â”‚  â”‚  è‡ªå‹•å¿œç­”ç‡: 88%            â”‚  â”‚
â”‚  â”‚  [å††ã‚°ãƒ©ãƒ•] ã‚«ãƒ†ã‚´ãƒªåˆ¥å†…è¨³  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ’¬ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆ     â”‚  â”‚
â”‚  â”‚  [æœ€æ–°10ä»¶ã®ä¼šè©±ã‚’è¡¨ç¤º]    â”‚  â”‚
â”‚  â”‚  â€¢ Guest(EN): WiFi?        â”‚  â”‚
â”‚  â”‚    Bot: Password is...     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ âš ï¸ æœªè§£æ±ºè³ªå• (3ä»¶)         â”‚  â”‚
â”‚  â”‚  â€¢ Late checkout possible? â”‚  â”‚
â”‚  â”‚    [FAQè¿½åŠ ]               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼                    â”‚
â”‚  â€¢ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰                  â”‚
â”‚  â€¢ FAQç®¡ç† â†                      â”‚
â”‚  â€¢ å®¿æƒ…å ±è¨­å®š                      â”‚
â”‚  â€¢ QRã‚³ãƒ¼ãƒ‰ç™ºè¡Œ                    â”‚
â”‚  â€¢ ä¼šè©±å±¥æ­´                        â”‚
â”‚  â€¢ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FAQç®¡ç†ç”»é¢                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [+ æ–°è¦FAQè¿½åŠ ]             â”‚  â”‚
â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚ ã‚«ãƒ†ã‚´ãƒª: Check-in (5ä»¶)    â”‚  â”‚
â”‚  â”‚ â€¢ What time is check-in?   â”‚  â”‚
â”‚  â”‚   â†’ Check-in is 3pm-10pm   â”‚  â”‚
â”‚  â”‚   [ç·¨é›†] [å‰Šé™¤]            â”‚  â”‚
â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚ ã‚«ãƒ†ã‚´ãƒª: Facilities (8ä»¶)  â”‚  â”‚
â”‚  â”‚ â€¢ WiFi password?           â”‚  â”‚
â”‚  â”‚   â†’ Password is: guest2024 â”‚  â”‚
â”‚  â”‚   [ç·¨é›†] [å‰Šé™¤]            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 QRã‚³ãƒ¼ãƒ‰è¨­ç½®ä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚„ã©ãºã‚‰ QRã‚³ãƒ¼ãƒ‰          â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                   â”‚      â”‚
â”‚  â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     â”‚      â”‚
â”‚  â”‚   â–ˆâ–ˆ       â–ˆâ–ˆ     â”‚      â”‚
â”‚  â”‚   â–ˆâ–ˆ  QR   â–ˆâ–ˆ     â”‚      â”‚
â”‚  â”‚   â–ˆâ–ˆ       â–ˆâ–ˆ     â”‚      â”‚
â”‚  â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     â”‚      â”‚
â”‚  â”‚                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                             â”‚
â”‚  ğŸ“± Scan for assistance     â”‚
â”‚  ğŸŒ English support         â”‚
â”‚                             â”‚
â”‚  è¨­ç½®å ´æ‰€: entrance         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

### 4.1 å…¨ä½“æ§‹é€ 

```
products/
â””â”€â”€ tabipera/
    â”œâ”€â”€ backend/
    â”‚   â”œâ”€â”€ app/
    â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”œâ”€â”€ main.py                    # FastAPI application entry
    â”‚   â”‚   â”œâ”€â”€ config.py                  # ç’°å¢ƒå¤‰æ•°ãƒ»è¨­å®š
    â”‚   â”‚   â”œâ”€â”€ database.py                # DBæ¥ç¶šè¨­å®š
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ api/                       # APIå±¤
    â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ deps.py                # ä¾å­˜æ€§æ³¨å…¥
    â”‚   â”‚   â”‚   â””â”€â”€ v1/
    â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”‚       â”œâ”€â”€ router.py          # APIãƒ«ãƒ¼ã‚¿ãƒ¼çµ±åˆ
    â”‚   â”‚   â”‚       â”œâ”€â”€ auth.py            # èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    â”‚   â”‚   â”‚       â”œâ”€â”€ chat.py            # ã‚²ã‚¹ãƒˆä¼šè©±ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    â”‚   â”‚   â”‚       â”œâ”€â”€ facilities.py      # æ–½è¨­ç®¡ç†ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    â”‚   â”‚   â”‚       â”œâ”€â”€ faqs.py            # FAQç®¡ç†ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    â”‚   â”‚   â”‚       â”œâ”€â”€ conversations.py   # ä¼šè©±å±¥æ­´ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    â”‚   â”‚   â”‚       â””â”€â”€ qrcodes.py         # QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ models/                    # SQLAlchemyãƒ¢ãƒ‡ãƒ«
    â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ facility.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ faq.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ conversation.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ message.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ escalation.py
    â”‚   â”‚   â”‚   â””â”€â”€ user.py                # ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ schemas/                   # Pydanticã‚¹ã‚­ãƒ¼ãƒ
    â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ facility.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ faq.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ conversation.py
    â”‚   â”‚   â”‚   â””â”€â”€ auth.py
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ services/                  # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
    â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ auth_service.py        # èªè¨¼ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
    â”‚   â”‚   â”‚   â”œâ”€â”€ chat_service.py        # AIå¯¾è©±å‡¦ç†
    â”‚   â”‚   â”‚   â”œâ”€â”€ facility_service.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ faq_service.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ conversation_service.py
    â”‚   â”‚   â”‚   â””â”€â”€ qrcode_service.py
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ ai/                        # AIé–¢é€£
    â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ engine.py              # AIå¯¾è©±ã‚¨ãƒ³ã‚¸ãƒ³
    â”‚   â”‚   â”‚   â”œâ”€â”€ prompts.py             # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    â”‚   â”‚   â”‚   â”œâ”€â”€ classifier.py          # ã‚«ãƒ†ã‚´ãƒªåˆ†é¡
    â”‚   â”‚   â”‚   â””â”€â”€ openai_client.py       # OpenAI APIãƒ©ãƒƒãƒ‘ãƒ¼
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ core/                      # ã‚³ã‚¢æ©Ÿèƒ½
    â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”‚   â”œâ”€â”€ security.py            # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ç­‰
    â”‚   â”‚   â”‚   â”œâ”€â”€ jwt.py                 # JWTç”Ÿæˆãƒ»æ¤œè¨¼
    â”‚   â”‚   â”‚   â””â”€â”€ exceptions.py          # ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€â”€ utils/                     # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    â”‚   â”‚       â”œâ”€â”€ __init__.py
    â”‚   â”‚       â”œâ”€â”€ logger.py
    â”‚   â”‚       â”œâ”€â”€ email.py               # ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é€šçŸ¥
    â”‚   â”‚       â””â”€â”€ session.py             # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
    â”‚   â”‚
    â”‚   â”œâ”€â”€ alembic/                       # DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    â”‚   â”‚   â”œâ”€â”€ versions/
    â”‚   â”‚   â”œâ”€â”€ env.py
    â”‚   â”‚   â””â”€â”€ script.py.mako
    â”‚   â”‚
    â”‚   â”œâ”€â”€ tests/                         # ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
    â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”œâ”€â”€ conftest.py
    â”‚   â”‚   â”œâ”€â”€ test_auth.py
    â”‚   â”‚   â”œâ”€â”€ test_chat.py
    â”‚   â”‚   â””â”€â”€ test_ai_engine.py
    â”‚   â”‚
    â”‚   â”œâ”€â”€ .env.example
    â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”œâ”€â”€ requirements.txt
    â”‚   â”œâ”€â”€ alembic.ini
    â”‚   â”œâ”€â”€ Dockerfile
    â”‚   â””â”€â”€ README.md
    â”‚
    â”œâ”€â”€ frontend/
    â”‚   â”œâ”€â”€ public/
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â””â”€â”€ favicon.ico
    â”‚   â”‚
    â”‚   â”œâ”€â”€ src/
    â”‚   â”‚   â”œâ”€â”€ main.js                    # Vue entry point
    â”‚   â”‚   â”œâ”€â”€ App.vue
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ router/                    # Vue Router
    â”‚   â”‚   â”‚   â””â”€â”€ index.js
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ stores/                    # Pinia (çŠ¶æ…‹ç®¡ç†)
    â”‚   â”‚   â”‚   â”œâ”€â”€ auth.js
    â”‚   â”‚   â”‚   â”œâ”€â”€ chat.js
    â”‚   â”‚   â”‚   â””â”€â”€ facility.js
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ api/                       # APIé€šä¿¡
    â”‚   â”‚   â”‚   â”œâ”€â”€ axios.js               # Axiosè¨­å®š
    â”‚   â”‚   â”‚   â”œâ”€â”€ auth.js
    â”‚   â”‚   â”‚   â”œâ”€â”€ chat.js
    â”‚   â”‚   â”‚   â”œâ”€â”€ facilities.js
    â”‚   â”‚   â”‚   â””â”€â”€ faqs.js
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ views/                     # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    â”‚   â”‚   â”‚   â”œâ”€â”€ guest/                 # ã‚²ã‚¹ãƒˆå´
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LanguageSelect.vue
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Welcome.vue
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Chat.vue
    â”‚   â”‚   â”‚   â”‚
    â”‚   â”‚   â”‚   â””â”€â”€ admin/                 # ç®¡ç†ç”»é¢
    â”‚   â”‚   â”‚       â”œâ”€â”€ Login.vue
    â”‚   â”‚   â”‚       â”œâ”€â”€ Dashboard.vue
    â”‚   â”‚   â”‚       â”œâ”€â”€ FaqManagement.vue
    â”‚   â”‚   â”‚       â”œâ”€â”€ FacilitySettings.vue
    â”‚   â”‚   â”‚       â”œâ”€â”€ ConversationHistory.vue
    â”‚   â”‚   â”‚       â””â”€â”€ QRCodeGenerator.vue
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ components/                # å†åˆ©ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    â”‚   â”‚   â”‚   â”œâ”€â”€ common/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Button.vue
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Input.vue
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.vue
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Loading.vue
    â”‚   â”‚   â”‚   â”‚
    â”‚   â”‚   â”‚   â”œâ”€â”€ guest/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatMessage.vue
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ QuickQuestions.vue
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ EscalationButton.vue
    â”‚   â”‚   â”‚   â”‚
    â”‚   â”‚   â”‚   â””â”€â”€ admin/
    â”‚   â”‚   â”‚       â”œâ”€â”€ Sidebar.vue
    â”‚   â”‚   â”‚       â”œâ”€â”€ StatsCard.vue
    â”‚   â”‚   â”‚       â”œâ”€â”€ CategoryChart.vue
    â”‚   â”‚   â”‚       â””â”€â”€ ChatHistoryList.vue
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ composables/               # Vue Composition API
    â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.js
    â”‚   â”‚   â”‚   â”œâ”€â”€ useChat.js
    â”‚   â”‚   â”‚   â””â”€â”€ useSession.js
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ utils/                     # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    â”‚   â”‚   â”‚   â”œâ”€â”€ constants.js
    â”‚   â”‚   â”‚   â”œâ”€â”€ validators.js
    â”‚   â”‚   â”‚   â””â”€â”€ formatters.js
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€â”€ assets/                    # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
    â”‚   â”‚       â”œâ”€â”€ styles/
    â”‚   â”‚       â”‚   â””â”€â”€ tailwind.css
    â”‚   â”‚       â””â”€â”€ images/
    â”‚   â”‚
    â”‚   â”œâ”€â”€ .env.example
    â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”œâ”€â”€ package.json
    â”‚   â”œâ”€â”€ vite.config.js
    â”‚   â”œâ”€â”€ tailwind.config.js
    â”‚   â””â”€â”€ README.md
    â”‚
    â”œâ”€â”€ docs/                              # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    â”‚   â”œâ”€â”€ architecture.md                # æœ¬ãƒ•ã‚¡ã‚¤ãƒ«
    â”‚   â”œâ”€â”€ api_specification.md
    â”‚   â”œâ”€â”€ deployment.md
    â”‚   â””â”€â”€ user_manual.md
    â”‚
    â”œâ”€â”€ docker-compose.yml                 # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨
    â”œâ”€â”€ .gitignore
    â””â”€â”€ README.md
```

### 4.2 ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®è²¬å‹™

#### Backend

| ãƒ•ã‚¡ã‚¤ãƒ« | è²¬å‹™ |
|---------|------|
| `main.py` | FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ã€CORSãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¨­å®š |
| `config.py` | ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ã€è¨­å®šç®¡ç† |
| `database.py` | PostgreSQLæ¥ç¶šã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† |
| `api/v1/chat.py` | ã‚²ã‚¹ãƒˆä¼šè©±APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ |
| `services/chat_service.py` | AIå¯¾è©±å‡¦ç†ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ |
| `ai/engine.py` | 3å±¤æ§‹é€ ã®AIå¯¾è©±ã‚¨ãƒ³ã‚¸ãƒ³å®Ÿè£… |
| `core/security.py` | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ã€æ¤œè¨¼ |
| `core/jwt.py` | JWTç”Ÿæˆã€æ¤œè¨¼ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ |

#### Frontend

| ãƒ•ã‚¡ã‚¤ãƒ« | è²¬å‹™ |
|---------|------|
| `main.js` | Vueã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ– |
| `router/index.js` | ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å®šç¾© |
| `stores/chat.js` | ãƒãƒ£ãƒƒãƒˆçŠ¶æ…‹ç®¡ç† (Pinia) |
| `api/axios.js` | Axiosè¨­å®šã€ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ |
| `views/guest/Chat.vue` | ã‚²ã‚¹ãƒˆå´ãƒãƒ£ãƒƒãƒˆUI |
| `views/admin/Dashboard.vue` | ç®¡ç†ç”»é¢ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ |
| `composables/useSession.js` | ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ |

---

## 5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 5.1 ERå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     users       â”‚ (ç®¡ç†è€…)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID) PK    â”‚
â”‚ email           â”‚
â”‚ hashed_password â”‚
â”‚ is_active       â”‚
â”‚ created_at      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      facilities         â”‚ (æ–½è¨­)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID) PK            â”‚
â”‚ user_id (FK)            â”‚â”€â”€â†’ users.id
â”‚ name                    â”‚
â”‚ email                   â”‚
â”‚ phone                   â”‚
â”‚ address                 â”‚
â”‚ wifi_password           â”‚
â”‚ checkin_time            â”‚
â”‚ checkout_time           â”‚
â”‚ house_rules (TEXT)      â”‚
â”‚ local_info (TEXT)       â”‚
â”‚ is_active               â”‚
â”‚ created_at              â”‚
â”‚ updated_at              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N              1:N
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“           â†“           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     faqs     â”‚ â”‚  conversations   â”‚ â”‚  password_resets  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID) PK â”‚ â”‚ id (UUID) PK     â”‚ â”‚ id (UUID) PK      â”‚
â”‚ facility_id  â”‚ â”‚ facility_id (FK) â”‚ â”‚ user_id (FK)      â”‚
â”‚ category     â”‚ â”‚ session_id (UUID)â”‚ â”‚ token             â”‚
â”‚ question_en  â”‚ â”‚ language         â”‚ â”‚ expires_at        â”‚
â”‚ answer_en    â”‚ â”‚ location         â”‚ â”‚ used              â”‚
â”‚ is_active    â”‚ â”‚ started_at       â”‚ â”‚ created_at        â”‚
â”‚ created_at   â”‚ â”‚ last_activity_at â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ updated_at   â”‚ â”‚ ended_at         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ is_active        â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ 1:N
                          â†“
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚      messages        â”‚
                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                 â”‚ id (UUID) PK         â”‚
                 â”‚ conversation_id (FK) â”‚
                 â”‚ role (ENUM)          â”‚
                 â”‚ content (TEXT)       â”‚
                 â”‚ tokens_used (INT)    â”‚
                 â”‚ response_time_ms     â”‚
                 â”‚ created_at           â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ 1:1 (optional)
                            â†“
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚    escalations       â”‚
                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                 â”‚ id (UUID) PK         â”‚
                 â”‚ conversation_id (FK) â”‚
                 â”‚ message_id (FK)      â”‚
                 â”‚ question (TEXT)      â”‚
                 â”‚ language             â”‚
                 â”‚ resolved             â”‚
                 â”‚ resolved_at          â”‚
                 â”‚ created_at           â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©è©³ç´°

#### users (ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼)

```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    hashed_password VARCHAR(255) NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_users_email ON users(email);
```

#### facilities (å®¿æ³Šæ–½è¨­)

```sql
CREATE TABLE facilities (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    phone VARCHAR(50),
    address TEXT,
    wifi_password VARCHAR(100),
    checkin_time TIME,
    checkout_time TIME,
    house_rules TEXT,
    local_info TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_facilities_user_id ON facilities(user_id);
CREATE INDEX idx_facilities_is_active ON facilities(is_active);
```

#### faqs (FAQ)

```sql
CREATE TYPE faq_category AS ENUM (
    'checkin',
    'checkout', 
    'facility',
    'rules',
    'local',
    'trouble'
);

CREATE TABLE faqs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    facility_id UUID NOT NULL REFERENCES facilities(id) ON DELETE CASCADE,
    category faq_category NOT NULL,
    question_en TEXT NOT NULL,
    answer_en TEXT NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    priority INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_faqs_facility_id ON faqs(facility_id);
CREATE INDEX idx_faqs_category ON faqs(category);
CREATE INDEX idx_faqs_is_active ON faqs(is_active);
```

#### conversations (ä¼šè©±ã‚»ãƒƒã‚·ãƒ§ãƒ³)

```sql
CREATE TABLE conversations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    facility_id UUID NOT NULL REFERENCES facilities(id) ON DELETE CASCADE,
    session_id UUID NOT NULL UNIQUE,
    language VARCHAR(10) DEFAULT 'en',
    location VARCHAR(50),
    started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_activity_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ended_at TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE
);

CREATE INDEX idx_conversations_facility_id ON conversations(facility_id);
CREATE INDEX idx_conversations_session_id ON conversations(session_id);
CREATE INDEX idx_conversations_last_activity ON conversations(last_activity_at);
```

#### messages (ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)

```sql
CREATE TYPE message_role AS ENUM ('user', 'assistant', 'system');

CREATE TABLE messages (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    conversation_id UUID NOT NULL REFERENCES conversations(id) ON DELETE CASCADE,
    role message_role NOT NULL,
    content TEXT NOT NULL,
    tokens_used INTEGER,
    response_time_ms INTEGER,
    ai_model VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_messages_conversation_id ON messages(conversation_id);
CREATE INDEX idx_messages_created_at ON messages(created_at);
```

#### escalations (ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)

```sql
CREATE TABLE escalations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    conversation_id UUID NOT NULL REFERENCES conversations(id) ON DELETE CASCADE,
    message_id UUID REFERENCES messages(id) ON DELETE SET NULL,
    question TEXT NOT NULL,
    language VARCHAR(10),
    resolved BOOLEAN DEFAULT FALSE,
    resolved_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_escalations_conversation_id ON escalations(conversation_id);
CREATE INDEX idx_escalations_resolved ON escalations(resolved);
```

#### password_resets (ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ)

```sql
CREATE TABLE password_resets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    token VARCHAR(255) UNIQUE NOT NULL,
    expires_at TIMESTAMP NOT NULL,
    used BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_password_resets_token ON password_resets(token);
CREATE INDEX idx_password_resets_user_id ON password_resets(user_id);
```

### 5.3 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†

#### Alembicã‚³ãƒãƒ³ãƒ‰

```bash
# æ–°è¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
alembic revision --autogenerate -m "create initial tables"

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
alembic upgrade head

# ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
alembic downgrade -1

# ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
alembic current
```

---

## 6. APIè¨­è¨ˆ

### 6.1 RESTful API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

#### èªè¨¼ç³» (`/api/v1/auth`)

| Method | Endpoint | èª¬æ˜ | èªè¨¼ |
|--------|----------|------|------|
| POST | `/auth/register` | æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ² | ä¸è¦ |
| POST | `/auth/login` | ãƒ­ã‚°ã‚¤ãƒ³ | ä¸è¦ |
| POST | `/auth/refresh` | ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ | JWT |
| POST | `/auth/logout` | ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ | JWT |
| POST | `/auth/password-reset-request` | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆè¦æ±‚ | ä¸è¦ |
| POST | `/auth/password-reset-confirm` | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç¢ºå®š | ä¸è¦ |

#### ã‚²ã‚¹ãƒˆä¼šè©±ç³» (`/api/v1/chat`)

| Method | Endpoint | èª¬æ˜ | èªè¨¼ |
|--------|----------|------|------|
| POST | `/chat/start` | ä¼šè©±ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ | ä¸è¦ |
| POST | `/chat/message` | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ | ã‚»ãƒƒã‚·ãƒ§ãƒ³ |
| POST | `/chat/escalate` | ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | ã‚»ãƒƒã‚·ãƒ§ãƒ³ |
| GET | `/chat/session/{session_id}` | ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±å–å¾— | ã‚»ãƒƒã‚·ãƒ§ãƒ³ |

#### æ–½è¨­ç®¡ç†ç³» (`/api/v1/facilities`)

| Method | Endpoint | èª¬æ˜ | èªè¨¼ |
|--------|----------|------|------|
| GET | `/facilities/me` | è‡ªæ–½è¨­æƒ…å ±å–å¾— | JWT |
| PUT | `/facilities/me` | è‡ªæ–½è¨­æƒ…å ±æ›´æ–° | JWT |
| GET | `/facilities/{facility_id}/public` | å…¬é–‹æ–½è¨­æƒ…å ±å–å¾— | ä¸è¦ |

#### FAQç®¡ç†ç³» (`/api/v1/faqs`)

| Method | Endpoint | èª¬æ˜ | èªè¨¼ |
|--------|----------|------|------|
| GET | `/faqs` | FAQä¸€è¦§å–å¾— | JWT |
| POST | `/faqs` | FAQä½œæˆ | JWT |
| PUT | `/faqs/{faq_id}` | FAQæ›´æ–° | JWT |
| DELETE | `/faqs/{faq_id}` | FAQå‰Šé™¤ | JWT |
| GET | `/faqs/by-facility/{facility_id}` | æ–½è¨­åˆ¥FAQå–å¾— | ä¸è¦ |

#### ä¼šè©±å±¥æ­´ç³» (`/api/v1/conversations`)

| Method | Endpoint | èª¬æ˜ | èªè¨¼ |
|--------|----------|------|------|
| GET | `/conversations` | ä¼šè©±å±¥æ­´ä¸€è¦§ | JWT |
| GET | `/conversations/{conversation_id}` | ä¼šè©±è©³ç´°å–å¾— | JWT |
| GET | `/conversations/stats/weekly` | é€±æ¬¡çµ±è¨ˆå–å¾— | JWT |
| GET | `/conversations/escalations` | æœªè§£æ±ºè³ªå•ä¸€è¦§ | JWT |

#### QRã‚³ãƒ¼ãƒ‰ç³» (`/api/v1/qrcodes`)

| Method | Endpoint | èª¬æ˜ | èªè¨¼ |
|--------|----------|------|------|
| POST | `/qrcodes/generate` | QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ | JWT |
| GET | `/qrcodes/download/{qr_id}` | QRã‚³ãƒ¼ãƒ‰PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ | JWT |

### 6.2 APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹è©³ç´°

#### POST `/api/v1/chat/start`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```json
{
  "facility_id": "uuid",
  "language": "en",
  "location": "entrance"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (200 OK)**
```json
{
  "session_id": "uuid",
  "facility": {
    "name": "Tokyo Guesthouse",
    "welcome_message": "Welcome to Tokyo Guesthouse!"
  },
  "top_questions": [
    "What is the WiFi password?",
    "What time is check-in?",
    "Where is the nearest station?"
  ]
}
```

#### POST `/api/v1/chat/message`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```json
{
  "session_id": "uuid",
  "message": "Where is the laundry room?"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (200 OK)**
```json
{
  "message_id": "uuid",
  "response": "The laundry room is located on the 2nd floor, next to the kitchen. It's available 24/7. Washing machine costs Â¥200 per load.",
  "response_time_ms": 1850,
  "source": "ai_generated",
  "category": "facility"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (AIå›ç­”ä¸å¯æ™‚)**
```json
{
  "message_id": "uuid",
  "response": "Sorry, I couldn't answer your question accurately. Would you like to contact the staff?",
  "response_time_ms": 1200,
  "source": "escalation_needed",
  "can_escalate": true
}
```

#### POST `/api/v1/auth/login`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```json
{
  "email": "owner@guesthouse.com",
  "password": "secure_password"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (200 OK)**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 3600,
  "user": {
    "id": "uuid",
    "email": "owner@guesthouse.com"
  }
}
```

#### GET `/api/v1/conversations/stats/weekly`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```
Headers:
  Authorization: Bearer {access_token}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (200 OK)**
```json
{
  "period": {
    "start": "2025-11-11T00:00:00Z",
    "end": "2025-11-18T00:00:00Z"
  },
  "total_questions": 127,
  "auto_response_rate": 0.88,
  "average_response_time_ms": 2150,
  "category_breakdown": {
    "checkin": 35,
    "facility": 48,
    "rules": 12,
    "local": 25,
    "trouble": 7
  },
  "top_questions": [
    {
      "question": "WiFi password?",
      "count": 23
    },
    {
      "question": "Check-in time?",
      "count": 18
    }
  ],
  "unresolved_count": 8
}
```

### 6.3 ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹

#### æ¨™æº–ã‚¨ãƒ©ãƒ¼ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```json
{
  "error": {
    "code": "ERROR_CODE",
    "message": "Human readable error message",
    "details": {
      "field": "Additional context"
    }
  }
}
```

#### ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä¸€è¦§

| HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | èª¬æ˜ |
|---------------|-------------|------|
| 400 | INVALID_REQUEST | ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒä¸æ­£ |
| 401 | UNAUTHORIZED | èªè¨¼ãŒå¿…è¦ |
| 403 | FORBIDDEN | ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãªã— |
| 404 | NOT_FOUND | ãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„ |
| 422 | VALIDATION_ERROR | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ |
| 429 | RATE_LIMIT_EXCEEDED | ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…é |
| 500 | INTERNAL_ERROR | ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã‚¨ãƒ©ãƒ¼ |
| 503 | SERVICE_UNAVAILABLE | ã‚µãƒ¼ãƒ“ã‚¹ä¸€æ™‚åœæ­¢ |

---

## 7. èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 7.1 èªè¨¼ãƒ•ãƒ­ãƒ¼

#### ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ 1. POST /api/v1/auth/login
     â”‚    {email, password}
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastAPI        â”‚
â”‚ auth.py        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 2. Verify password
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ security.py    â”‚
â”‚ verify_passwordâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 3. Generate JWT
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ jwt.py         â”‚
â”‚ create_tokens  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 4. Return tokens
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚
â”‚ Store:  â”‚
â”‚ - access_token â”‚
â”‚ - refresh_tokenâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ã‚²ã‚¹ãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Guest   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ 1. Scan QR code
     â”‚    /f/{facility_id}?location=entrance
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vue Router     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 2. POST /api/v1/chat/start
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastAPI        â”‚
â”‚ chat.py        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 3. Create session_id
     â”‚    Store in conversations table
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚
â”‚ Store session_id in Cookie:â”‚
â”‚ - Name: tabipera_session   â”‚
â”‚ - HttpOnly: false          â”‚
â”‚ - Secure: true (prod)      â”‚
â”‚ - SameSite: Lax            â”‚
â”‚ - Max-Age: 86400 (24h)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 JWTè¨­å®š

#### ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³

```python
ACCESS_TOKEN_EXPIRE_MINUTES = 60  # 1æ™‚é–“

payload = {
    "sub": user.id,
    "email": user.email,
    "exp": datetime.utcnow() + timedelta(minutes=60),
    "type": "access"
}
```

#### ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³

```python
REFRESH_TOKEN_EXPIRE_DAYS = 7  # 7æ—¥é–“

payload = {
    "sub": user.id,
    "exp": datetime.utcnow() + timedelta(days=7),
    "type": "refresh"
}
```

### 7.3 ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

#### Cookieè¨­å®š

```javascript
// Vue.jså´ã§ã®Cookieä¿å­˜ (js-cookieä½¿ç”¨)
Cookies.set('tabipera_session', sessionId, {
  expires: 1,        // 1æ—¥
  secure: true,      // HTTPS only (æœ¬ç•ª)
  sameSite: 'Lax'
})
```

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯

```python
# app/utils/session.py

def is_session_valid(session_id: str, db: Session) -> bool:
    """
    ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæœ‰åŠ¹ã‹ãƒã‚§ãƒƒã‚¯
    - å­˜åœ¨ç¢ºèª
    - 24æ™‚é–“ä»¥å†…ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£
    """
    conversation = db.query(Conversation).filter(
        Conversation.session_id == session_id,
        Conversation.is_active == True,
        Conversation.last_activity_at > datetime.utcnow() - timedelta(hours=24)
    ).first()
    
    return conversation is not None
```

### 7.4 ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ 1. POST /auth/password-reset-request
     â”‚    {email}
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastAPI                â”‚
â”‚ Generate reset token   â”‚
â”‚ Send email             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 2. Email with link
     â”‚    /reset-password?token=xxx
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User    â”‚
â”‚ Click linkâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ 3. POST /auth/password-reset-confirm
     â”‚    {token, new_password}
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastAPI                â”‚
â”‚ Verify token           â”‚
â”‚ Update password        â”‚
â”‚ Mark token as used     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.5 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

#### CORSè¨­å®š

```python
# app/main.py

app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "https://tabipera.com",
        "https://admin.tabipera.com"
    ],
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE"],
    allow_headers=["*"],
)
```

#### ãƒ¬ãƒ¼ãƒˆåˆ¶é™

```python
# app/api/deps.py

from slowapi import Limiter
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)

# ãƒãƒ£ãƒƒãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: 60å›/åˆ†
@limiter.limit("60/minute")
async def chat_message(...):
    ...

# èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: 5å›/åˆ†
@limiter.limit("5/minute")
async def login(...):
    ...
```

#### SQL Injectionå¯¾ç­–

- SQLAlchemy ORMä½¿ç”¨ (ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒª)
- Raw SQLã¯ä½¿ç”¨ã—ãªã„

#### XSSå¯¾ç­–

- Vue.jsã®è‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ©Ÿèƒ½
- `v-html`ã¯ä½¿ç”¨ã—ãªã„

---

## 8. AIå¯¾è©±ã‚¨ãƒ³ã‚¸ãƒ³è¨­è¨ˆ

### 8.1 3å±¤æ§‹é€ ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

```python
# app/ai/engine.py

class ChatEngine:
    def process_message(
        self, 
        message: str, 
        facility_id: str, 
        session_id: str
    ) -> ChatResponse:
        """
        3å±¤æ§‹é€ ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†
        """
        
        # Layer 1: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒãƒƒãƒãƒ³ã‚°
        template_response = self._match_template(message, facility_id)
        if template_response:
            return ChatResponse(
                response=template_response,
                source="template",
                category=self._detect_category(message)
            )
        
        # Layer 2: ã‚«ãƒ†ã‚´ãƒªåˆ†é¡
        category = self._classify_category(message)
        
        # Layer 3: AIç”Ÿæˆå¿œç­”
        ai_response = self._generate_ai_response(
            message=message,
            facility_id=facility_id,
            category=category
        )
        
        if ai_response.confidence < 0.7:
            # ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            return ChatResponse(
                response=self._get_escalation_message(),
                source="escalation_needed",
                can_escalate=True
            )
        
        return ChatResponse(
            response=ai_response.text,
            source="ai_generated",
            category=category
        )
```

### 8.2 Layer 1: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒãƒƒãƒãƒ³ã‚°

```python
def _match_template(self, message: str, facility_id: str) -> Optional[str]:
    """
    FAQå®Œå…¨ä¸€è‡´ãƒã‚§ãƒƒã‚¯
    - æ–‡å­—åˆ—æ­£è¦åŒ– (å°æ–‡å­—åŒ–ã€è¨˜å·å‰Šé™¤)
    - éƒ¨åˆ†ä¸€è‡´ (80%ä»¥ä¸Šã®é¡ä¼¼åº¦)
    """
    normalized_message = self._normalize_text(message)
    
    faqs = self.db.query(FAQ).filter(
        FAQ.facility_id == facility_id,
        FAQ.is_active == True
    ).all()
    
    for faq in faqs:
        normalized_question = self._normalize_text(faq.question_en)
        similarity = self._calculate_similarity(
            normalized_message, 
            normalized_question
        )
        
        if similarity >= 0.8:
            return faq.answer_en
    
    return None
```

### 8.3 Layer 2: ã‚«ãƒ†ã‚´ãƒªåˆ†é¡

```python
def _classify_category(self, message: str) -> str:
    """
    GPT-4o-miniã§ã‚«ãƒ†ã‚´ãƒªåˆ†é¡
    """
    prompt = f"""
Classify this guest question into ONE category:
- checkin: Check-in/out procedures, key handover
- facility: WiFi, shower, kitchen, laundry
- rules: House rules, garbage, noise, smoking
- local: Nearby stations, convenience stores, restaurants
- trouble: Lost key, broken equipment, emergency

Question: {message}

Respond with ONLY the category name.
"""
    
    response = self.openai_client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[{"role": "user", "content": prompt}],
        max_tokens=10,
        temperature=0
    )
    
    return response.choices[0].message.content.strip().lower()
```

### 8.4 Layer 3: AIç”Ÿæˆå¿œç­”

```python
def _generate_ai_response(
    self, 
    message: str, 
    facility_id: str, 
    category: str
) -> AIResponse:
    """
    æ–½è¨­æƒ…å ±ã‚’å«ã‚ãŸAIå¿œç­”ç”Ÿæˆ
    """
    facility = self._get_facility_info(facility_id)
    faqs = self._get_relevant_faqs(facility_id, category)
    
    prompt = self._build_prompt(facility, faqs, message)
    
    response = self.openai_client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[{"role": "user", "content": prompt}],
        max_tokens=200,
        temperature=0.7
    )
    
    return AIResponse(
        text=response.choices[0].message.content,
        confidence=self._calculate_confidence(response),
        tokens_used=response.usage.total_tokens
    )
```

### 8.5 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```python
# app/ai/prompts.py

SYSTEM_PROMPT = """
You are a helpful assistant for {facility_name}, a guesthouse in {location}.

## Your role:
- Answer guests' questions about check-in/out, facilities, house rules, and local area.
- Be friendly, concise (under 200 characters), and helpful.
- If you cannot answer confidently, suggest contacting staff.

## Facility Information:
{facility_info}

## FAQs:
{faqs}

## Guest's question:
{question}

## Response in English:
"""

def build_prompt(
    facility: Facility, 
    faqs: List[FAQ], 
    question: str
) -> str:
    """ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ"""
    
    facility_info = f"""
- Address: {facility.address}
- Phone: {facility.phone}
- WiFi: {facility.wifi_password}
- Check-in: {facility.checkin_time}
- Check-out: {facility.checkout_time}
- House Rules: {facility.house_rules}
- Local Info: {facility.local_info}
"""
    
    faq_text = "\n".join([
        f"Q: {faq.question_en}\nA: {faq.answer_en}"
        for faq in faqs
    ])
    
    return SYSTEM_PROMPT.format(
        facility_name=facility.name,
        location="Osaka",  # æ–½è¨­ã‹ã‚‰å–å¾—
        facility_info=facility_info,
        faqs=faq_text,
        question=question
    )
```

### 8.6 ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢è¨ˆç®—

```python
def _calculate_confidence(self, response) -> float:
    """
    AIå¿œç­”ã®ä¿¡é ¼åº¦ã‚’è¨ˆç®—
    - å¿œç­”é•·ã•
    - æ›–æ˜§ãªè¡¨ç¾ã®æœ‰ç„¡
    - ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨ç‡
    """
    text = response.choices[0].message.content.lower()
    
    # æ›–æ˜§ãªè¡¨ç¾ã‚’ãƒã‚§ãƒƒã‚¯
    uncertain_phrases = [
        "i'm not sure",
        "i don't know",
        "maybe",
        "probably",
        "might be"
    ]
    
    if any(phrase in text for phrase in uncertain_phrases):
        return 0.5
    
    # å¿œç­”é•·ã•ãƒã‚§ãƒƒã‚¯ (æ¥µç«¯ã«çŸ­ã„ = è‡ªä¿¡ãªã—)
    if len(text) < 20:
        return 0.6
    
    return 0.9
```

---

## 9. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 9.1 ã‚¨ãƒ©ãƒ¼éšå±¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTPException (FastAPI)    â”‚ â† ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ (4xx)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AppException (Custom)      â”‚ â† ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AIException (Custom)       â”‚ â† AIå‡¦ç†ã‚¨ãƒ©ãƒ¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DatabaseException (Custom) â”‚ â† DBå‡¦ç†ã‚¨ãƒ©ãƒ¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–å®šç¾©

```python
# app/core/exceptions.py

class AppException(Exception):
    """ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åŸºåº•ä¾‹å¤–"""
    def __init__(self, message: str, code: str):
        self.message = message
        self.code = code
        super().__init__(self.message)

class AIException(AppException):
    """AIå‡¦ç†é–¢é€£ä¾‹å¤–"""
    pass

class DatabaseException(AppException):
    """ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£ä¾‹å¤–"""
    pass

class AuthenticationException(AppException):
    """èªè¨¼é–¢é€£ä¾‹å¤–"""
    pass
```

### 9.3 OpenAI APIéšœå®³æ™‚ã®å¯¾å¿œ

```python
# app/ai/openai_client.py

class OpenAIClient:
    def __init__(self):
        self.client = OpenAI(api_key=settings.OPENAI_API_KEY)
        self.fallback_message = {
            "en": (
                "Sorry, the automatic support system is "
                "temporarily unavailable.\n"
                "Please contact the staff directly for assistance."
            ),
            "ja": (
                "ç¾åœ¨ã€è‡ªå‹•æ¡ˆå†…ã‚·ã‚¹ãƒ†ãƒ ãŒä¸€æ™‚çš„ã«åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚\n"
                "ãŠæ‰‹æ•°ã§ã™ãŒã‚¹ã‚¿ãƒƒãƒ•ã¸ç›´æ¥ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚"
            )
        }
    
    def generate_response(
        self, 
        prompt: str, 
        language: str = "en"
    ) -> str:
        """
        AIå¿œç­”ç”Ÿæˆ (ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ã)
        """
        try:
            response = self.client.chat.completions.create(
                model="gpt-4o-mini",
                messages=[{"role": "user", "content": prompt}],
                timeout=5.0  # 5ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
            )
            return response.choices[0].message.content
        
        except OpenAIError as e:
            # ãƒ­ã‚°è¨˜éŒ²
            logger.error(f"OpenAI API error: {e}")
            
            # ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨˜éŒ²
            self._record_fallback_event()
            
            # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿”å´
            return self.fallback_message.get(language, self.fallback_message["en"])
        
        except Exception as e:
            logger.critical(f"Unexpected error in AI generation: {e}")
            return self.fallback_message.get(language, self.fallback_message["en"])
    
    def _record_fallback_event(self):
        """ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ­ã‚°"""
        logger.warning(
            "AI API error: fallback_message_triggered",
            extra={
                "timestamp": datetime.utcnow().isoformat(),
                "event": "openai_fallback"
            }
        )
```

### 9.4 ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©

```python
# app/main.py

from fastapi import FastAPI, Request
from fastapi.responses import JSONResponse

app = FastAPI()

@app.exception_handler(AppException)
async def app_exception_handler(request: Request, exc: AppException):
    """ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©"""
    return JSONResponse(
        status_code=400,
        content={
            "error": {
                "code": exc.code,
                "message": exc.message
            }
        }
    )

@app.exception_handler(Exception)
async def general_exception_handler(request: Request, exc: Exception):
    """äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©"""
    logger.error(f"Unhandled exception: {exc}", exc_info=True)
    return JSONResponse(
        status_code=500,
        content={
            "error": {
                "code": "INTERNAL_ERROR",
                "message": "An unexpected error occurred. Please try again later."
            }
        }
    )
```

---

## 10. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### 10.1 Render.comæ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Render.com                  â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Web Service (FastAPI)        â”‚ â”‚
â”‚  â”‚  - Region: Oregon (US-West)   â”‚ â”‚
â”‚  â”‚  - Instance: Standard         â”‚ â”‚
â”‚  â”‚  - Auto-deploy: main branch   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PostgreSQL (Managed)         â”‚ â”‚
â”‚  â”‚  - Version: 15                â”‚ â”‚
â”‚  â”‚  - Plan: Starter              â”‚ â”‚
â”‚  â”‚  - Storage: 1GB               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Static Site (Vue.js)         â”‚ â”‚
â”‚  â”‚  - Build: npm run build       â”‚ â”‚
â”‚  â”‚  - Publish: dist/             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 ç’°å¢ƒå¤‰æ•°è¨­å®š

#### Backend (.env)

```bash
# Database
DATABASE_URL=postgresql://user:pass@host:5432/tabipera

# JWT
SECRET_KEY=your-secret-key-min-32-chars
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=60
REFRESH_TOKEN_EXPIRE_DAYS=7

# OpenAI
OPENAI_API_KEY=sk-proj-xxxxx

# Email (ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç”¨)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=noreply@tabipera.com
SMTP_PASSWORD=xxxxx

# CORS
FRONTEND_URL=https://tabipera.com
ADMIN_URL=https://admin.tabipera.com

# Environment
ENVIRONMENT=production
DEBUG=false
```

#### Frontend (.env.production)

```bash
VITE_API_BASE_URL=https://api.tabipera.com
VITE_ENVIRONMENT=production
```

### 10.3 ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Developer   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ git push origin main
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GitHub     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Webhook
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Render.com               â”‚
â”‚  1. Pull latest code      â”‚
â”‚  2. Build Docker image    â”‚
â”‚  3. Run migrations        â”‚
â”‚  4. Health check          â”‚
â”‚  5. Switch traffic        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.4 Dockerfile

#### Backend

```dockerfile
# backend/Dockerfile

FROM python:3.11-slim

WORKDIR /app

# Install dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy application
COPY ./app ./app
COPY alembic.ini .
COPY ./alembic ./alembic

# Run migrations and start server
CMD alembic upgrade head && \
    uvicorn app.main:app --host 0.0.0.0 --port $PORT
```

#### Frontend

```dockerfile
# frontend/Dockerfile

FROM node:18-alpine AS build

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

# Serve static files
FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### 10.5 ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```python
# app/api/v1/router.py

@router.get("/health")
async def health_check(db: Session = Depends(get_db)):
    """
    ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    - DBæ¥ç¶šç¢ºèª
    - OpenAI APIæ¥ç¶šç¢ºèª
    """
    try:
        # DBæ¥ç¶šãƒã‚§ãƒƒã‚¯
        db.execute("SELECT 1")
        
        # OpenAI API ãƒã‚§ãƒƒã‚¯
        client = OpenAI(api_key=settings.OPENAI_API_KEY)
        client.models.list()
        
        return {
            "status": "healthy",
            "database": "connected",
            "openai": "connected"
        }
    except Exception as e:
        logger.error(f"Health check failed: {e}")
        return JSONResponse(
            status_code=503,
            content={
                "status": "unhealthy",
                "error": str(e)
            }
        )
```

---

## 11. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶

### 11.1 ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ç›®æ¨™

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ç›®æ¨™ | æœ€å¤§ |
|--------------|------|------|
| `/chat/message` | 2ç§’ä»¥å†… | 3ç§’ |
| `/auth/login` | 500msä»¥å†… | 1ç§’ |
| `/faqs` (ä¸€è¦§) | 200msä»¥å†… | 500ms |
| `/conversations/stats` | 1ç§’ä»¥å†… | 2ç§’ |

### 11.2 æœ€é©åŒ–æˆ¦ç•¥

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒª

```python
# N+1å•é¡Œå¯¾ç­–: Eager Loading

# Bad
conversations = db.query(Conversation).all()
for conv in conversations:
    messages = conv.messages  # è¿½åŠ ã‚¯ã‚¨ãƒªç™ºç”Ÿ

# Good
conversations = db.query(Conversation) \
    .options(joinedload(Conversation.messages)) \
    .all()
```

#### OpenAI APIå‘¼ã³å‡ºã—

```python
# ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
response = client.chat.completions.create(
    model="gpt-4o-mini",
    messages=[...],
    timeout=5.0  # 5ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
)

# ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° (å°†æ¥)
response = client.chat.completions.create(
    model="gpt-4o-mini",
    messages=[...],
    stream=True
)
```

#### ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°

```python
# Redis (Phase 2ã§æ¤œè¨)
# - FAQå¿œç­”ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
# - æ–½è¨­æƒ…å ±ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
```

---

## 12. é–‹ç™ºè¦ç´„

### 12.1 ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

#### Python (Backend)

- **ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼**: Black
- **ãƒªãƒ³ã‚¿ãƒ¼**: Flake8, Pylint
- **å‹ãƒ’ãƒ³ãƒˆ**: å¿…é ˆ (Python 3.11+)
- **å‘½åè¦å‰‡**:
  - é–¢æ•°: `snake_case`
  - ã‚¯ãƒ©ã‚¹: `PascalCase`
  - å®šæ•°: `UPPER_SNAKE_CASE`

```python
# Good
def process_chat_message(message: str, session_id: str) -> ChatResponse:
    """
    ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†ã™ã‚‹
    
    Args:
        message: ã‚²ã‚¹ãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        session_id: ã‚»ãƒƒã‚·ãƒ§ãƒ³ID
        
    Returns:
        ChatResponse: AIå¿œç­”
    """
    ...
```

#### JavaScript (Frontend)

- **ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼**: Prettier
- **ãƒªãƒ³ã‚¿ãƒ¼**: ESLint
- **å‘½åè¦å‰‡**:
  - å¤‰æ•°ãƒ»é–¢æ•°: `camelCase`
  - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: `PascalCase`
  - å®šæ•°: `UPPER_SNAKE_CASE`

```javascript
// Good
const fetchChatHistory = async (sessionId) => {
  try {
    const response = await api.get(`/conversations/${sessionId}`)
    return response.data
  } catch (error) {
    console.error('Failed to fetch chat history:', error)
    throw error
  }
}
```

### 12.2 Gitè¦ç´„

#### ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥

```
main (æœ¬ç•ª)
  â†‘
develop (é–‹ç™º)
  â†‘
feature/xxx (æ©Ÿèƒ½é–‹ç™º)
hotfix/xxx (ç·Šæ€¥ä¿®æ­£)
```

#### ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```
<type>: <subject>

<body>

Types:
- feat: æ–°æ©Ÿèƒ½
- fix: ãƒã‚°ä¿®æ­£
- docs: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- style: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- refactor: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- test: ãƒ†ã‚¹ãƒˆè¿½åŠ 
- chore: ãƒ“ãƒ«ãƒ‰ãƒ»è¨­å®šå¤‰æ›´
```

ä¾‹:
```
feat: Add password reset functionality

- Implement password reset request endpoint
- Add email sending service
- Create password reset confirmation endpoint
```

### 12.3 ãƒ†ã‚¹ãƒˆè¦ç´„

#### Backend

```python
# tests/test_chat.py

import pytest
from app.ai.engine import ChatEngine

@pytest.fixture
def chat_engine():
    return ChatEngine()

def test_template_matching(chat_engine):
    """ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒãƒƒãƒãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ"""
    message = "What is the WiFi password?"
    facility_id = "test-facility-uuid"
    
    response = chat_engine._match_template(message, facility_id)
    
    assert response is not None
    assert "guest2024" in response

def test_category_classification(chat_engine):
    """ã‚«ãƒ†ã‚´ãƒªåˆ†é¡ã®ãƒ†ã‚¹ãƒˆ"""
    message = "Where is the laundry room?"
    
    category = chat_engine._classify_category(message)
    
    assert category == "facility"
```

#### Frontend

```javascript
// tests/Chat.spec.js

import { mount } from '@vue/test-utils'
import Chat from '@/views/guest/Chat.vue'

describe('Chat.vue', () => {
  it('sends message on button click', async () => {
    const wrapper = mount(Chat)
    
    await wrapper.find('input').setValue('Hello')
    await wrapper.find('button').trigger('click')
    
    expect(wrapper.vm.messages).toHaveLength(1)
    expect(wrapper.vm.messages[0].content).toBe('Hello')
  })
})
```

### 12.4 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¦ç´„

#### APIä»•æ§˜æ›¸

- OpenAPI 3.0å½¢å¼
- FastAPIã®è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ä½¿ç”¨
- `/docs` (Swagger UI)
- `/redoc` (ReDoc)

#### ã‚³ãƒ¼ãƒ‰ã‚³ãƒ¡ãƒ³ãƒˆ

```python
# è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã«ã®ã¿ã‚³ãƒ¡ãƒ³ãƒˆ
# è‡ªæ˜ãªã‚³ãƒ¼ãƒ‰ã«ã¯ã‚³ãƒ¡ãƒ³ãƒˆä¸è¦

# Good: è¤‡é›‘ãªå‡¦ç†ã®èª¬æ˜
# Calculate similarity using Levenshtein distance
# with 80% threshold for FAQ matching
similarity = self._calculate_similarity(text1, text2)

# Bad: è‡ªæ˜ãªã‚³ãƒ¼ãƒ‰ã¸ã®ä¸è¦ãªã‚³ãƒ¡ãƒ³ãƒˆ
# Get user by ID
user = db.query(User).filter(User.id == user_id).first()
```

---

## ä»˜éŒ²

### A. å‚è€ƒURL

- FastAPI: https://fastapi.tiangolo.com/
- Vue.js 3: https://vuejs.org/
- SQLAlchemy: https://www.sqlalchemy.org/
- OpenAI API: https://platform.openai.com/docs
- Render.com: https://render.com/docs

### B. é–‹ç™ºç’°å¢ƒæ§‹ç¯‰æ‰‹é †

```bash
# Backend
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
alembic upgrade head
uvicorn app.main:app --reload

# Frontend
cd frontend
npm install
npm run dev
```

### C. æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ç’°å¢ƒå¤‰æ•°è¨­å®šå®Œäº†
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- [ ] SSLè¨¼æ˜æ›¸è¨­å®š
- [ ] CORSè¨­å®šç¢ºèª
- [ ] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å‹•ä½œç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç›£è¦–è¨­å®š
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š
- [ ] OpenAI APIã‚­ãƒ¼å‹•ä½œç¢ºèª

---

**ä½œæˆè€…**: Air  
**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ18æ—¥
