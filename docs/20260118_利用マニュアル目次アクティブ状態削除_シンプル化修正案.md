# 利用マニュアル目次アクティブ状態削除 シンプル化修正案

**作成日時**: 2026年01月18日  
**対象課題**: 目次のアクティブ状態表示機能の削除（シンプル化）  
**優先度**: 中（UX改善のため重要）  
**所要時間**: 約15分

---

## 1. 修正方針

### 1.1 基本方針

**シンプル化**: アクティブ状態の表示機能を完全に削除し、シンプルな目次にする

**理由**:
- 複雑な`IntersectionObserver`ロジックが不要になる
- `activeSection`の管理が不要になる
- コードが大幅にシンプルになる
- 工数が少ない
- ホバー時の視覚的フィードバックのみで十分

### 1.2 削除する機能

1. **アクティブ状態の表示**:
   - `activeSection`プロップの削除
   - `active`クラスの条件分岐の削除
   - `.active`スタイルの削除

2. **スクロール監視機能**:
   - `IntersectionObserver`の削除
   - `section-change`イベントの削除
   - `handleSectionChange`関数の削除

3. **アクティブな章の自動展開機能**:
   - `watch`による`activeSection`の監視の削除
   - アクティブな章を自動展開する機能の削除

### 1.3 残す機能

1. **折りたたみ/展開機能**: 維持
2. **スクロール機能**: 維持（クリックで該当章にスクロール）
3. **ホバー時の視覚的フィードバック**: 維持（既存のスタイル）

---

## 2. 修正ステップ計画

### ステップ1: バックアップ作成（5分）

```bash
# ManualToc.vueのバックアップ
cp frontend/src/components/admin/ManualToc.vue frontend/src/components/admin/ManualToc.vue.bak_$(date +%Y%m%d_%H%M%S)

# ManualContent.vueのバックアップ
cp frontend/src/components/admin/ManualContent.vue frontend/src/components/admin/ManualContent.vue.bak_$(date +%Y%m%d_%H%M%S)

# Manual.vueのバックアップ
cp frontend/src/views/admin/Manual.vue frontend/src/views/admin/Manual.vue.bak_$(date +%Y%m%d_%H%M%S)
```

### ステップ2: ManualToc.vueの修正（5分）

**削除する内容**:
1. `activeSection`プロップの削除
2. `active`クラスの条件分岐の削除（11行目）
3. `watch`による`activeSection`の監視の削除（95-103行目）
4. `.active`スタイルの削除（185-189行目、210-214行目）

**修正後のコード**:
```vue
<!-- 章タイトルテキスト（クリックでスクロール） -->
<button
  class="manual-toc-item-title flex-1 text-left"
  @click="handleSectionClick(section.id)"
>
  <span class="font-medium">{{ section.title }}</span>
</button>
```

```typescript
interface Props {
  sections: ManualSection[]
  isMobile?: boolean
}

// watchの削除（95-103行目を削除）
```

```css
/* .activeスタイルを削除（185-189行目、210-214行目を削除） */
```

### ステップ3: ManualContent.vueの修正（3分）

**削除する内容**:
1. `IntersectionObserver`の削除（109-153行目）
2. `section-change`イベントの削除（47-49行目）

**修正後のコード**:
```typescript
// IntersectionObserver関連のコードをすべて削除
// emitの定義も削除
```

### ステップ4: Manual.vueの修正（2分）

**削除する内容**:
1. `activeSection`の削除（1577行目）
2. `handleSectionChange`関数の削除（1579-1581行目）
3. `@section-change`イベントハンドラーの削除（54行目）
4. `:activeSection`プロップの削除（42行目、49行目）

**修正後のコード**:
```vue
<ManualToc :sections="sections" :isMobile="true" />
<ManualToc :sections="sections" />
<ManualContent :sections="sections" />
```

```typescript
// activeSectionとhandleSectionChangeを削除
```

### ステップ5: 構文チェック（5分）

```bash
cd frontend
npm run type-check  # または vue-tsc --noEmit
npm run lint
```

### ステップ6: ブラウザテスト（10分）

**テスト項目**:
1. **折りたたみ/展開の動作確認**:
   - アイコンボタンをクリックして、折りたたみ/展開が正しく動作することを確認

2. **リンクジャンプの動作確認**:
   - 章タイトルテキストをクリックして、該当章にスクロールすることを確認

3. **ホバー時の視覚的フィードバック確認**:
   - ホバー時に背景色が変わることを確認

4. **モバイルでの動作確認**:
   - モバイル表示で正しく動作することを確認

**所要時間**: 約30分（0.5時間）

---

## 3. 修正内容の詳細

### 3.1 ManualToc.vueの修正

**削除する行**:
- 11行目: `activeSection === section.id ? 'active' : ''`
- 53行目: `activeSubsection === subsection.id ? 'active' : ''`
- 82行目: `activeSection: string`（Propsから削除）
- 92行目: `const activeSubsection = ref<string>('')`
- 95-103行目: `watch`による`activeSection`の監視
- 121行目: `activeSubsection.value = subsectionId`
- 185-189行目: `.manual-toc-item-title.active`スタイル
- 210-214行目: `.manual-toc-subitem.active`スタイル

**修正後のProps**:
```typescript
interface Props {
  sections: ManualSection[]
  isMobile?: boolean
}
```

### 3.2 ManualContent.vueの修正

**削除する行**:
- 47-49行目: `emit`の定義
- 52行目: `let observer: IntersectionObserver | null = null`
- 109-153行目: `onMounted`内の`IntersectionObserver`関連コード
- 149-153行目: `onUnmounted`内の`observer.disconnect()`

**修正後のコード**:
```typescript
// emitの定義を削除
// IntersectionObserver関連のコードをすべて削除
// onMountedとonUnmountedは削除（または空にする）
```

### 3.3 Manual.vueの修正

**削除する行**:
- 42行目: `:activeSection="activeSection"`
- 49行目: `:activeSection="activeSection"`
- 54行目: `@section-change="handleSectionChange"`
- 1577行目: `const activeSection = ref('intro')`
- 1579-1581行目: `handleSectionChange`関数

**修正後のコード**:
```vue
<ManualToc :sections="sections" :isMobile="true" />
<ManualToc :sections="sections" />
<ManualContent :sections="sections" />
```

---

## 4. 他の機能やUIへの影響調査

### 4.1 影響を受ける可能性のある機能

**調査結果**: **影響なし**

**理由**:
1. **他のコンポーネントへの影響**: なし
   - `ManualToc.vue`、`ManualContent.vue`、`Manual.vue`は独立したコンポーネント
   - 他のコンポーネントから直接参照されていない

2. **既存機能への影響**: なし
   - 折りたたみ/展開機能は維持
   - スクロール機能は維持
   - ホバー時の視覚的フィードバックは維持

### 4.2 競合・干渉の可能性

**調査結果**: **競合・干渉なし**

**理由**:
1. **機能の削除**: 機能を削除するだけなので、競合・干渉は発生しない
2. **スタイリングの独立性**: スタイルは`scoped`で定義されているため、他のコンポーネントに影響しない

---

## 5. 大原則の遵守確認

### 5.1 大原則との整合性

1. **根本解決 > 暫定解決**: ✅
   - 問題の根本原因（複雑な`IntersectionObserver`ロジック）を削除
   - 一時的な回避策ではなく、根本的な解決を実施

2. **シンプル構造 > 複雑構造**: ✅
   - 複雑な`IntersectionObserver`ロジックを削除
   - コードが大幅にシンプルになる

3. **統一・同一化 > 特殊独自**: ✅
   - 既存のパターン（ホバー時の視覚的フィードバック）を維持
   - 特殊な実装（アクティブ状態の表示）を削除

4. **具体的 > 一般**: ✅
   - 具体的な実装方法を明確に記載
   - コード例を提供している

5. **拙速 < 安全確実**: ✅
   - テストを省略せず、十分な検証を行う
   - ブラウザテストを実施

6. **Docker環境必須**: ✅
   - すべての修正・テストはDocker環境で実行する

---

## 6. 期待される効果

### 6.1 コードのシンプル化

1. **コード量の削減**:
   - `ManualToc.vue`: 約20行削減
   - `ManualContent.vue`: 約45行削減
   - `Manual.vue`: 約5行削減
   - **合計: 約70行削減**

2. **複雑度の削減**:
   - `IntersectionObserver`のロジックが不要になる
   - `activeSection`の管理が不要になる
   - イベントハンドリングが不要になる

### 6.2 UX改善

1. **シンプルな表示**:
   - アクティブ状態の表示がなくなり、シンプルになる
   - ホバー時の視覚的フィードバックのみで十分

2. **操作性の向上**:
   - 複雑なロジックがなくなり、動作が予測しやすくなる
   - バグが発生する可能性が低くなる

---

## 7. まとめ

### 7.1 修正内容の要約

**修正方針**:
- アクティブ状態の表示機能を完全に削除
- `IntersectionObserver`を削除
- `activeSection`の管理を削除
- シンプルな目次にする

**修正ファイル**:
- `frontend/src/components/admin/ManualToc.vue`
- `frontend/src/components/admin/ManualContent.vue`
- `frontend/src/views/admin/Manual.vue`

**所要時間**: 約30分（0.5時間）

### 7.2 削除する機能と残す機能

**削除する機能**:
- アクティブ状態の表示（ブルー表示）
- スクロール監視機能（`IntersectionObserver`）
- アクティブな章の自動展開機能

**残す機能**:
- 折りたたみ/展開機能
- スクロール機能（クリックで該当章にスクロール）
- ホバー時の視覚的フィードバック

---

**Document Version**: v1.0  
**Author**: Auto (AI Assistant)  
**Last Updated**: 2026年01月18日  
**Status**: ✅ **調査分析完了・修正案提示完了（修正は指示があるまで実施しない）**

