# やどぺら v0.3 要約定義書

**作成日**: 2025年11月21日  
**最終更新日**: 2025年12月21日 15時41分32秒  
**バージョン**: v0.3.7  
**ベース**: v0.21要約定義書

---

## 変更履歴 v0.21 → v0.3

1. **市場規模・地域拡大戦略**: 段階的拡大計画明確化（Expansion Phase A: 福岡・沖縄、Expansion Phase B: 北海道・金沢）、潜在市場500-1000施設
2. **PoC施設数最適化**: 5-7施設 → 3施設に絞り込み、品質重視
3. **FAQ自動学習機能MVP化**: 未解決質問からのFAQ追加機能をMVPに前倒し
4. **夜間対応設計追加**: 翌朝対応予約機能、自動返信メッセージ
5. **信頼度スコア改善**: 質問具体性スコア、過去解決率、ゲストフィードバック追加
6. **セッション統合機能**: デバイス間セッション統合トークン導入
7. **収益モデル多様化**: 従量課金オプション、セットアップ代行サービス追加
8. **安全カテゴリ強制エスカレーション**: 医療・安全情報は閾値無視で即エスカレーション
9. **多言語優先度調査**: やどびとユーザーアンケートによる優先言語決定プロセス追加
10. **競合モニタリング体制**: 四半期レビュー制度化
11. **宿泊事業者向けFAQ＋AIサポート**: Phase 2（PoC準備）で管理画面内AIヘルプチャット実装（実装時期変更: 当初はExpansion Phase A予定だったが、PoC期間中のサポート工数削減のため前倒し）
12. **データ保持ポリシー詳細化**: GDPR準拠の3ヶ月自動削除バッチ処理

## 変更履歴 v0.3 → v0.3.1（2025-11-25）

13. **ブランチ戦略とデプロイ戦略**: オプション2採用（サブドメインでのテストURL作成）
    - ステージング環境: Railway Hobby（PostgreSQL + Redis、契約済み）
    - 本番環境: Render.com（PostgreSQL Managed + Redis Cloud）
    - ブランチ構成: `main`（本番）、`develop`（ステージング）、`feature/*`（開発）
14. **実装フェーズ明確化**: 
    - ステージング環境構築: Phase 1 Week 4
    - 本番環境構築: Phase 4（本格展開準備）

## 変更履歴 v0.3.2 → v0.3.3（2025-12-20）

15. **Phase 2機能追加**: 
    - 開発者管理ページ：契約宿泊管理者のエラーやスコアなどが閲覧できる統括ページ
    - デモサイト：PoC契約に向け、参加希望者が閲覧できるデモサイト（テスト用IDとパスワード）
    - 宿泊施設管理者向けFAQ：宿泊管理者が困惑しないよう本システムと同様のFAQを設置
16. **Phase 3機能追加**: 
    - 本番向けランディングページ作成：SNSなどから誘引するページで申し込み受付できるページ
17. **Phase 4機能追加**: 
    - 新規登録ページ作成：Stripe実装直前に実装予定。現在はログインページしか作成されていない

## 変更履歴 v0.3.7 → v0.3.8（2025-12-23）

1. **ランディングページの料金プラン表示変更完了**:
   - ランディングページの料金プラン表示を新仕様（v0.3.6）に更新完了
   - `landing/index.html`を修正し、`develop`ブランチと`main`ブランチの両方にプッシュ済み
   - GitHub Pagesでデプロイ完了（`main`ブランチから自動デプロイ）
   - **修正内容**:
     - 料金プラン表示の更新（6箇所）: Free, Mini, Small, Standard, Premiumプランの表示を新仕様に更新
     - 「同時利用言語数」の概念を明示（Free: 1言語、Mini: 2言語、Small: 3言語、Standard: 4言語、Premium: 無制限）
     - 全プランで表示項目を統一（同時利用言語数 → 想定 → 価格/質問数 → FAQ登録数 → 規模目安）
     - Freeプランの説明を追加（「国内・日本語のみ※選択不可」）
     - FAQ Q7を更新（「Freeプランは無料、Miniプランは¥1,980/月〜」）
     - 応募締切日を更新（「※ 応募締切: 2025年12月31日（予定）」→「※ 応募締切: 2026年1月20日（予定）」）
   - **コミット情報**:
     - `develop`ブランチ: コミット `ec55304` - "Update: ランディングページの料金プラン表示変更と応募締切日更新"
     - `main`ブランチ: コミット `fcd0e96` - "Update: ランディングページの料金プラン表示変更と応募締切日更新"
   - **デプロイ状況**: GitHub Pagesでデプロイ完了、デプロイURL: `https://yadopera.com/`

---

## 変更履歴 v0.3.6 → v0.3.7（2025-12-22）

1. **セッション有効期限延長問題の防止策1実装完了**:
   - `backend/app/utils/session.py`を新規作成（`is_session_valid()`関数を実装）
   - `backend/app/services/chat_service.py`を修正（セッション有効期限チェックを統合）
   - `backend/app/api/v1/chat.py`を修正（エスカレーション時のセッション有効期限チェックを追加）
   - `started_at`ベースの固定有効期限を実装（セッション開始時刻から24時間の固定有効期限）
   - 再アクセスによる延長を防止
   - 24時間経過後はセッションを無効化（`ended_at`を設定）
   - Redisキャッシュを使用（高速化）
   - 参照文書: `docs/Phase1_Phase2_セッション有効期限延長問題_防止策1実装_完全調査分析_修正案_20251222.md`

2. **宿泊管理者ダッシュボードグラフ削除問題対応完了**:
   - `frontend/src/components/admin/CategoryChart.vue`を修正
   - 円グラフ部分（10-37行目）のみをコメントアウト（マスク）
   - タイトル、説明文、凡例、合計は表示を維持
   - 円グラフ用の未使用変数をコメントアウト（TypeScriptエラー解消）
   - レイアウト調整（凡例部分に`mt-6`クラスを追加）
   - 参照文書: `docs/Phase1_Phase2_宿泊管理者ダッシュボードグラフ削除問題_完全調査分析_修正案_20251221.md`

---

## 変更履歴 v0.3.4 → v0.3.5（2025-12-21）

22. **FAQ登録数カウント方法修正（Phase 2実施）**: 
    - FAQ登録数を「意味（インテント）」単位で1件としてカウントするように修正
    - データベーススキーマ変更: `faqs`テーブルから`language`, `question`, `answer`, `embedding`を削除し、`intent_key`を追加
    - `faq_translations`テーブルを新規作成（`faq_id`, `language`, `question`, `answer`, `embedding`を含む）
    - 多言語対応してもFAQ登録数が増えない設計に変更（「今何時ですか？」と「what time is it now?」は1件としてカウント）
    - 料金プランの「FAQ登録数」の意味を明確化（インテント単位でカウント）

---

## 変更履歴 v0.3.3 → v0.3.4（2025-12-21）

18. **Phase 2残存課題追加**: 
    - セッション有効期限延長問題：防止策1（`started_at`ベースの固定有効期限）、防止策3（チェックアウト時刻を考慮した有効期限）を推奨
    - 宿泊管理者ダッシュボードグラフ削除問題：グラフだけをマスクする必要がある
    - PWAインストールプロンプトのボタンの動作問題：スマホのホーム画面にアイコンが表示されるが、アイコンをタップすると404エラーが発生する問題
    - ランディングページの料金プラン表示変更：新しい料金プラン（Mini/Small/Standard/Premium）を反映
19. **Phase 3機能追加**: 
    - 管理者ダッシュボードページに月次サマリー統計カードをメインで実装：管理者は月次統計と料金が一番の関心課題なので、のちにStripeとリンク
    - プラン超過時の挙動の実装：管理者選択制（通常継続（従量課金）/AI停止・FAQ限定モード）
    - QRコードデザイン変更（2025-12-22追加）：QRコードの中央に「YadOPERA」テキストを配置、QRコードの下部に情報を追加（設置場所、生成日時、施設名など）。PNG/PDF/SVG形式すべてに対応
21. **月次サマリー統計カード仕様追加**: 
    - 総質問数、AI自動対応数、自動応答率、エスカレーション数、想定人手対応時間削減、平均AI信頼度、ゲスト満足度（👍率）の詳細仕様を追加

---

## 0. 大原則（開発・実装の基本方針）

**実装や修正の基本は要約定義書やアーキテクチャ設計書などを準拠し、方向性は以下の優先順位を遵守する：**

1. **根本解決 > 暫定解決**
   - 一時的な回避策ではなく、根本原因を解決する
   - パッチワーク的な修正を避け、設計レベルでの解決を優先

2. **シンプル構造 > 複雑構造**
   - 過度に複雑な実装を避け、理解しやすく保守しやすい構造を選択
   - 不要な抽象化や過剰な設計を避ける

3. **統一・同一化 > 特殊独自**
   - 既存のパターンや規約に従い、統一された実装を優先
   - 特殊な実装や独自の方法を避け、標準的なアプローチを採用

4. **具体的 > 一般**
   - 抽象的な説明ではなく、具体的な実装方法や手順を明確にする
   - 曖昧な表現を避け、実行可能な具体的な内容を記載

5. **拙速 < 安全確実**
   - 速度よりも安全性と確実性を優先
   - テストを省略せず、十分な検証を行ってから本番環境に反映

6. **Docker環境必須 > ローカル直接実行**
   - **Dockerを使わない修正もテストも意味がない**
   - すべての修正・テストはDocker環境（docker-compose）で実行する
   - ローカル環境で直接実行した修正やテストは無効であり、再実施が必要
   - Docker環境での動作確認が完了してから、ステージング環境へのデプロイを検討する
   - この原則は、環境の違いによる不具合を防ぎ、本番環境に近い状態での検証を保証するために必須

**この大原則は、すべての開発・実装・修正作業において最優先で遵守する。**

---

## 1. 事業サマリー

### サービス概要
**やどぺら** = 「宿」 + 「ぺらぺら（流暢に話す）」

小規模宿泊施設向け外国人ゲスト対応自動化SaaS。QRコードをスマホで読み取るだけで、AIが24時間多言語自動応答。

### コアバリュー
**ゲスト側**
- アプリ不要、QRコードのみ
- 好きな言語で24時間質問可能
- 平均3秒以内レスポンス
- ダークモード対応
- デバイス間セッション統合

**宿側**
- 外国人ゲスト対応70%自動化（MVP目標、Phase 2で85%+）
- 月額¥3,980〜 または 従量課金¥1,980+¥30/質問
- 初期費用¥0（セットアップ代行オプション¥30,000〜）
- 導入ハードル低（QRコード掲示+基本設定）
- 20-30件FAQテンプレート提供
- 未解決質問からワンクリックFAQ追加

### 競合優位性
- やどびとネットワーク（実数200施設）
- RAG（検索拡張生成）で48%コスト削減
- 小規模施設特化（15-60床）、大手PMSが対応しきれないニッチ
- 四半期ごとの競合動向モニタリング体制

---

## 2. ターゲット・市場

### ターゲット顧客
- **施設タイプ**: ゲストハウス・ホステル（15-60床）
- **外国人ゲスト比率**: 30%以上
- **スタッフ体制**: 1-3名
- **初期地域**: 京都・大阪・東京
- **拡大地域（Expansion Phase A）**: 福岡・沖縄
- **拡大地域（Expansion Phase B）**: 北海道・金沢

### 市場規模（段階的拡大）

| フェーズ | 地域 | 推定施設数 | 累計潜在市場 |
|----------|------|-----------|-------------|
| Phase 1 | 京都・大阪・東京 | 100-150施設 | 100-150施設 |
| Expansion Phase A | +福岡・沖縄 | +80-120施設 | 180-270施設 |
| Expansion Phase B | +北海道・金沢・広島 | +100-150施設 | 280-420施設 |
| 長期 | 全国展開 | +200-300施設 | **500-700施設** |

**やどびと実数**: 200施設（初期営業チャネル）

### 顧客の課題
1. 英語対応スタッフ確保困難（採用コスト月給¥250,000+）
2. 夜間・無人時間帯の問い合わせ対応
3. 多言語資料作成・更新（翻訳¥50,000-100,000/言語）
4. 説明ミスによるトラブル

### 多言語優先度調査（MVP前実施）
やどびとユーザーアンケートで以下を調査:
- ゲスト国籍TOP5
- 言語対応の困難度ランキング
- 希望対応言語

**結果に基づきExpansion Phase Aの言語優先度を決定**（英語以外の第1優先言語）

---

## 3. MVP機能仕様

### 3.1 ゲスト側機能

**アクセスURL**: `https://yadopera.com/f/{facility_id}?location={location}&token={session_token}`

**画面フロー**
1. 言語選択画面（英語のみ、MVP）
2. ウェルカム画面（よくある質問TOP3、フリー入力、緊急連絡先）
3. AI対話インターフェース（チャット形式、PWA対応、ダークモード、固定フッター）
4. **回答後フィードバック**（「役に立ちましたか？」👍👎ボタン）

**セッション管理（改善版）**
- SessionID: Cookie保存
- **セッション統合トークン**: 4桁英数字（例: `AB12`）
  - 初回アクセス時に発行、画面上部に常時表示
  - 別デバイスでQRスキャン時、トークン入力で会話履歴統合
  - `https://yadopera.com/f/{facility_id}?token=AB12`
- 有効期限: 無動作24時間で自動終了
- 複数デバイス: トークンによる統合可能

**AI応答フロー（RAG統合型）**
```
質問受付
↓
【安全カテゴリ判定】★新規
├ 医療関連キーワード検出 → 即エスカレーション
├ 安全・避難関連キーワード検出 → 即エスカレーション
└ 通常質問 → 次へ
↓
埋め込みベクトル生成（OpenAI Embeddings）
↓
pgvectorで類似FAQ検索（コサイン類似度、Top 3取得）
↓
コンテキスト構築（約600トークン）
├ 関連FAQ Top 3: 300トークン
├ 施設基本情報: 150トークン
├ システムプロンプト: 100トークン
└ ゲスト質問: 50トークン
↓
GPT-4o miniで回答生成（最大200トークン出力）
↓
信頼度スコア計算（0.0-1.0）★改善版
├ FAQ類似度ボーナス（0.8以上: +0.3）
├ 回答長ペナルティ（20文字未満: -0.2）
├ 不確実性ワード検出（maybe等: -0.15）
├ 【新規】質問具体性スコア（固有名詞・数値含む: +0.1）
├ 【新規】過去同一質問解決率（80%以上: +0.15）
└ 【新規】施設カスタムFAQヒット（+0.2）
↓
エスカレーション判定
↓
回答返却 or エスカレーション
```

**安全カテゴリ強制エスカレーション（新規）**

以下のキーワード検出時は信頼度スコアに関係なく即座にエスカレーション:

*医療関連*: hospital, doctor, ambulance, emergency, sick, injured, fever, allergy, medicine, pharmacy, 病院, 救急

*安全・避難関連*: fire, earthquake, evacuation, escape, 火災, 地震, 避難

**夜間対応設計（新規）**

*夜間時間帯（22:00-8:00）のエスカレーション処理*:
```
エスカレーション発生
↓
自動返信メッセージ送信:

英語:
"Thank you for your message. Our staff will respond 
by 9:00 AM tomorrow morning. For life-threatening 
emergencies, please call 119 (ambulance/fire) or 
110 (police)."

日本語:
「お問い合わせありがとうございます。明朝9時までに
スタッフよりご連絡いたします。緊急の場合は
119（救急・消防）または110（警察）へお電話ください。」
↓
翌朝対応キューに追加
↓
8:00にスタッフへ一括通知
```

**コスト効率**
- 1質問あたり: ¥0.033（RAG最適化後）
- 月100件/施設: ¥3.3/月
- 従来比48%削減

**OpenAI API障害時フォールバック**

英語:
```
Sorry, the automatic support system is temporarily unavailable.
Please contact the staff directly for assistance.
```

日本語:
```
現在、自動案内システムが一時的に利用できません。
お手数ですがスタッフへ直接お問い合わせください。
```

宿側ログ:
```
AI API error: fallback_message_triggered
timestamp: xxxx-xx-xx xx:xx
guest_session_id: xxxx
error_type: OpenAI_API_timeout / rate_limit / server_error
```

**エスカレーション機能**

*通常モード（デフォルト）*
- AI信頼度 < 0.7で自動エスカレーション
- 緊急キーワード検出
- 3往復以上未解決
- **安全カテゴリは閾値無視で即エスカレーション**

*早期エスカレーションモード（スタッフ在席時）*
- AI信頼度 < 0.85で早めにエスカレーション
- 時間帯・曜日・言語・スタッフスキル別に設定可能

**エスカレーションスケジュール設定例**
```yaml
例1: 平日日中（英語対応スタッフ在席）
- 曜日: ["mon", "tue", "wed", "thu", "fri"]
  時間: "09:00-18:00"
  モード: "early"（早期エスカレーション）
  閾値: 0.85
  言語: ["en", "ja"]
  通知: ["email"]

例2: 夜間（緊急時のみ）
- 曜日: "all"
  時間: "18:00-09:00"
  モード: "normal"（通常）
  閾値: 0.7
  言語: ["en", "ja"]
  通知: ["email"]
```

**対応カテゴリ（MVP）**
- 基本情報: チェックイン/アウト時間、WiFiパスワード、支払い方法、門限
- 設備・サービス: キッチン、シャワー、洗濯機、タオル、ドライヤー、荷物預かり、自転車レンタル
- 館内ルール: ゴミ出し、騒音時間帯、喫煙所
- 周辺情報: コンビニ、駅、レストラン、ATM
- トラブル対応: 鍵紛失、WiFi不通、設備故障
- **【強制エスカレーション】医療・安全**: 体調不良、病院案内、避難経路

### 3.2 宿側機能（管理画面）

**認証システム**
- メールアドレス + パスワード認証（bcryptハッシュ化）
- JWT認証（python-jose、有効期限7日間）
- パスワードリセット機能

**ダッシュボード**

*週次サマリー（現行）*
- 更新方式: REST API + ポーリング（手動更新）
- リアルタイムチャット履歴（最新10件）
- 週次サマリー（総質問数、カテゴリ別円グラフ、TOP5、未解決数、自動応答率）
- **夜間対応キュー**: 翌朝対応が必要な質問一覧
- **ゲストフィードバック集計**: 👍👎の比率、低評価回答リスト

*月次サマリー統計カード（Phase 3実装予定）*★新規（2025-12-21追加）

管理者は月次統計と料金が一番の関心課題なので、月次サマリー統計カードをメインで実装。のちにStripeとリンク。

**請求期間ベースの統計カード（上段）**:

1. **総質問数**
   - 何が: 現在の請求期間中にゲストが送信した質問の総数
   - 期間: 現在の請求期間（契約開始日〜次回請求日前日）
   - 補足表示: プラン上限（例: 200件）、残り利用可能数（例: 残り38件）

2. **AI自動対応数**
   - 何が: AIがエスカレーションせず完結した質問数
   - 期間: 現在の請求期間
   - 計算: 総質問数 − エスカレーション数
   - 意味: 「AIが何回スタッフの代わりをしたか」

3. **自動応答率（請求納得指標）**
   - 何が: AIのみで完結した質問の割合
   - 期間: 現在の請求期間
   - 計算: AI自動対応数 ÷ 総質問数 × 100

4. **エスカレーション数**
   - 何が: 人手対応が必要だった質問数
   - 期間: 現在の請求期間
   - 補足内訳（小）: 信頼度不足、安全カテゴリ（医療・避難）、夜間対応

5. **想定人手対応時間削減**
   - 何が: AI対応により削減された想定人手対応時間
   - 期間: 現在の請求期間
   - 計算: AI自動対応数 × 3分
   - 表示例: 今月 AIが 96件対応（約4.8時間削減）
   - 意味: これが一番「払ってよかった」と感じるカード

**品質・安心系カード（下段）**:

6. **平均AI信頼度**
   - 何が: AI回答の信頼度平均値
   - 期間: 現在の請求期間

7. **ゲスト満足度（👍率）**
   - 何が: ゲストフィードバック肯定率
   - 期間: 現在の請求期間
   - 計算: 👍 ÷ (👍 + 👎)

**FAQ管理（MVP強化版）**

*初期テンプレート20-30件提供*

*FAQ自動学習機能（MVP前倒し実装）*:
```
未解決質問リスト
├ 日時、内容、言語、信頼度スコア表示
├ 「FAQ追加」ボタン ★ワンクリック
│   ↓
│   質問文自動入力
│   回答文テンプレート自動生成（GPT-4o mini）
│   カテゴリ自動推定
│   ↓
│   スタッフが確認・編集
│   ↓
│   保存時に埋め込みベクトル自動生成
└ 「無視」ボタン（ノイズ質問除外）
```

*ゲストフィードバック連動*:
- 👎評価が2回以上ついた回答を自動ハイライト
- 「FAQ改善提案」ボタンで回答文修正案を自動生成

**QRコード発行**
- 施設専用QRコード生成
- 設置場所別（entrance / room / kitchen / lounge / custom）
- **セッション統合トークン埋め込みオプション**
- PDF/PNG/SVG形式ダウンロード（A4印刷用）

### 3.3 宿泊事業者向けサポート体制（新規）

**PoC・MVP段階: 静的FAQページ**

*FAQカテゴリ（20-30項目）*:
- **初期設定**: アカウント作成、施設情報登録、初回ログイン
- **QRコード設置**: 推奨設置場所、印刷方法、複数QR運用
- **FAQ登録・編集**: テンプレ活用法、カテゴリ分類、優先度設定
- **AI応答の仕組み**: RAG動作原理、信頼度スコア、エスカレーション条件
- **ログ・分析**: チャット履歴の見方、週次レポート、フィードバック確認
- **トラブルシューティング**: AI回答がおかしい場合、WiFi弱い環境、APIエラー
- **料金・請求**: OpenAI従量コスト、プラン変更、請求サイクル
- **セキュリティ・プライバシー**: データ保持期間、GDPR対応、暗号化

*提供形式*:
- Webページ（`https://yadopera.com/help`）
- PDF版マニュアル（ダウンロード可能）
- 動画チュートリアル（5分×5本、Phase 2（PoC準備））

**Phase 2（PoC準備）: 管理画面内AIヘルプチャット実装**★実装時期変更

*機能概要*:
```
宿側スタッフが日本語で質問
↓
事業者向けFAQ（Markdown）をEmbeddings化
↓
RAGまたはSystem Prompt埋め込みで回答生成
↓
回答 + 該当FAQリンク + 設定画面URL を返却
```

*対応クエリ例*:
- 「どうやってFAQを登録するの？」→ 手順説明 + FAQ編集画面リンク
- 「ゲストチャットのログは見られる？」→ ダッシュボード説明 + 画面リンク
- 「AI回答がおかしい場合は？」→ FAQ改善提案機能の案内
- 「QRコードはどこに貼るのがベスト？」→ 推奨設置場所リスト
- 「OpenAI料金はどれくらい？」→ 料金体系説明 + 利用状況画面リンク

*技術実装*:
- 小規模のため**pgvector不要**、GPT-4o miniのSystem Promptに全FAQ埋め込み
- 推定コスト: ¥0.01/質問以下（FAQが静的情報のため低トークン）
- 管理画面右下にフローティングチャットアイコン設置

*期待効果*:
- 開発者（Air）のサポート工数 **70%削減**
- 初期操作つまずきによる **解約率低減**
- 「宿向けAI」も提供することで **差別化・付加価値向上**

---

## 4. 技術スタック

### フロントエンド
- Vue.js 3 (Composition API)
- TypeScript 5.3+
- Tailwind CSS 3.4+
- Vite 5.0+
- Pinia 2.1+
- Axios 1.6+
- Vite PWA Plugin 0.19+

### バックエンド
- FastAPI 0.109+（Python 3.11+）
- SQLAlchemy 2.0+（ORM、async対応）
- Alembic 1.13+
- uvicorn 0.27+
- python-jose 3.3+（JWT認証）
- passlib 1.7+（bcrypt）
- Redis 7.2+

### AI/ML
- OpenAI API: GPT-4o mini、text-embedding-3-small
- LangChain 0.1+
- pgvector 0.2+
- tiktoken 0.5+

### データベース・インフラ
- PostgreSQL 15+（pgvector拡張）
- Redis Cloud
- Render.com
- Cloudflare
- AWS S3
- GitHub Actions（Expansion Phase A）

---

## 5. データベース設計（概要）

### 主要テーブル（v0.3追加分）

**guest_feedback**（ゲストフィードバック）★新規
```sql
id SERIAL PRIMARY KEY
message_id INTEGER REFERENCES messages(id)
facility_id INTEGER REFERENCES facilities(id)
feedback_type VARCHAR(10)  -- 'positive', 'negative'
created_at TIMESTAMP DEFAULT NOW()
```

**faq_suggestions**（FAQ追加提案）★新規
```sql
id SERIAL PRIMARY KEY
facility_id INTEGER REFERENCES facilities(id)
source_message_id INTEGER REFERENCES messages(id)
suggested_question TEXT
suggested_answer TEXT
suggested_category VARCHAR(100)
status VARCHAR(20) DEFAULT 'pending'  -- 'pending', 'approved', 'rejected'
created_at TIMESTAMP
reviewed_at TIMESTAMP
reviewed_by INTEGER REFERENCES users(id)
```

**overnight_queue**（夜間対応キュー）★新規
```sql
id SERIAL PRIMARY KEY
facility_id INTEGER REFERENCES facilities(id)
escalation_id INTEGER REFERENCES escalations(id)
guest_message TEXT
scheduled_notify_at TIMESTAMP  -- 翌朝8:00
notified_at TIMESTAMP
resolved_at TIMESTAMP
resolved_by INTEGER REFERENCES users(id)
created_at TIMESTAMP
```

**session_tokens**（セッション統合トークン）★新規
```sql
id SERIAL PRIMARY KEY
facility_id INTEGER REFERENCES facilities(id)
token VARCHAR(10) UNIQUE  -- 'AB12'形式
primary_session_id VARCHAR(100) REFERENCES conversations(session_id)
linked_session_ids TEXT[]  -- 統合されたセッションID配列
created_at TIMESTAMP
expires_at TIMESTAMP  -- 24時間後
```

**question_patterns**（質問パターン解決率）★新規
```sql
id SERIAL PRIMARY KEY
facility_id INTEGER REFERENCES facilities(id)
pattern_embedding vector(1536)
total_count INTEGER DEFAULT 0
resolved_count INTEGER DEFAULT 0  -- エスカレーションなしで完了
resolution_rate DECIMAL(3,2) GENERATED ALWAYS AS 
  (resolved_count::DECIMAL / NULLIF(total_count, 0)) STORED
last_asked_at TIMESTAMP
created_at TIMESTAMP
updated_at TIMESTAMP
```

**operator_faqs**（宿泊事業者向けFAQ）★新規
```sql
id SERIAL PRIMARY KEY
category VARCHAR(100)  -- 'setup', 'qrcode', 'faq_management', 'ai_logic', 'logs', 'troubleshooting', 'billing', 'security'
question TEXT
answer TEXT
related_url TEXT  -- 管理画面内リンク
display_order INTEGER DEFAULT 0
is_active BOOLEAN DEFAULT TRUE
created_at TIMESTAMP
updated_at TIMESTAMP
```

**データ保持ポリシー（GDPR準拠）**
```sql
-- 3ヶ月経過した会話データを自動削除（Celeryバッチ処理）
-- Expansion Phase Aで実装、MVP期間中は手動対応

-- 削除対象テーブル
-- conversations: ended_at < NOW() - INTERVAL '3 months'
-- messages: conversation_id が削除対象
-- escalations: created_at < NOW() - INTERVAL '3 months' AND resolved_at IS NOT NULL

-- 保持対象（削除しない）
-- facilities, users, faqs: 契約中は保持
-- guest_feedback: 匿名化して統計データとして保持
-- faq_suggestions: 承認済みはFAQに統合、却下済みは3ヶ月で削除
```

---

## 6. API設計

### API バージョニング
`/api/v1/`

### エンドポイント一覧（v0.3追加分）

**Guest API**
- GET `/api/v1/facility/{slug}` 施設情報取得
- POST `/api/v1/chat` チャットメッセージ送信
- GET `/api/v1/chat/history/{session_id}` 会話履歴取得
- **POST `/api/v1/chat/feedback` ゲストフィードバック送信** ★新規
- **POST `/api/v1/session/link` セッション統合** ★新規
- **GET `/api/v1/session/token/{token}` トークン検証** ★新規

**Admin API**
- POST `/api/v1/auth/login` ログイン
- POST `/api/v1/auth/logout` ログアウト
- POST `/api/v1/auth/password-reset` パスワードリセット要求
- POST `/api/v1/auth/password-reset/confirm` パスワードリセット確定
- GET `/api/v1/admin/dashboard` ダッシュボードデータ
- GET/POST/PUT/DELETE `/api/v1/admin/faqs` FAQ管理
- **GET `/api/v1/admin/faq-suggestions` FAQ追加提案一覧** ★新規
- **POST `/api/v1/admin/faq-suggestions/{id}/approve` 提案承認** ★新規
- **POST `/api/v1/admin/faq-suggestions/{id}/reject` 提案却下** ★新規
- **GET `/api/v1/admin/overnight-queue` 夜間対応キュー** ★新規
- **GET `/api/v1/admin/feedback-stats` フィードバック統計** ★新規
- GET/PUT `/api/v1/admin/escalations` エスカレーション管理
- POST `/api/v1/admin/qr-code` QRコード生成
- GET/POST/PUT `/api/v1/admin/escalation-schedule` スケジュール管理

**Operator Support API（Phase 2（PoC準備））**★新規（実装時期変更）
- GET `/api/v1/help/faqs` 事業者向けFAQ一覧
- GET `/api/v1/help/faqs/{category}` カテゴリ別FAQ
- POST `/api/v1/help/chat` AIヘルプチャット（管理画面内）
- GET `/api/v1/help/search?q={query}` FAQ検索

---

## 7. 開発スケジュール

### Phase 0: 準備（1週間）
- アーキテクチャ設計書v0.3作成
- **簡易ランディングページ（LP）作成**★新規
  - 目的: 説明コスト削減、信頼性担保、PoC応募導線
  - 構成: ヒーロー、課題提起、解決策、仕組み、料金、FAQ、CTA
  - 工数: 数時間（静的1ページ）
- **開発環境構築**（詳細化）
  - プロジェクト構造作成
  - Docker環境セットアップ（docker-compose.yml, Dockerfile作成）
  - Backend初期設定（requirements.txt, Alembic設定）
  - Frontend初期設定（package.json, Vite + Vue 3設定）
  - データベース初期化（PostgreSQL + pgvector）
  - Redis環境構築
  - README.md作成（セットアップ手順）
  - 動作確認（全サービス起動確認）
- GitHub リポジトリ作成
- OpenAI API キー取得
- Render アカウント準備
- **やどびと多言語優先度アンケート実施**

### Phase 1: MVP開発（4週間）

**Week 1: バックエンド基盤**
- FastAPI プロジェクト初期化
- PostgreSQL 接続（pgvector拡張）
- JWT認証システム
- 基本テーブル実装
- **セッション統合トークンAPI実装**

**Week 2: AI対話エンジン**
- OpenAI API 統合
- RAG実装
- **信頼度スコア改善版実装**
- **安全カテゴリ強制エスカレーション実装**
- **夜間対応キュー実装**
- フォールバック文言実装

**Week 3: フロントエンド**
- Vue.js プロジェクト初期化
- ゲスト側UI（PWA、ダークモード）
- **ゲストフィードバックUI（👍👎）**
- **セッション統合トークン表示・入力UI**
- 管理画面（ダッシュボード）
- **FAQ自動学習UI（ワンクリック追加）**
- **夜間対応キューUI**

**Week 4: 統合・テスト**
- エンドツーエンドテスト
- レスポンス速度最適化
- エラーハンドリング
- QRコード生成機能
- **ステージング環境構築・デプロイ**（Render.com + Railway Hobby）
  - `develop`ブランチ作成
  - ステージング環境設定（環境変数、データベース接続）
  - ステージング環境デプロイ確認

### Phase 2: PoC準備（2週間）
- やどびとユーザーへのメールDM作成・送信
- オンライン説明会準備（Zoom、週1回×4週間）
- **PoC施設選定（3施設、品質重視）**
- 初期FAQ作成支援
- 利用マニュアル作成
- 専用Slackチャンネル作成
- **宿泊事業者向けAIヘルプチャット実装**★新規（実装時期変更）
  - 管理画面内フローティングチャット
  - 事業者向けFAQ（20-30項目）をSystem Prompt埋め込み
  - 設定画面リンク自動返却
  - サポート工数70%削減目標（PoC期間中のサポート工数削減）
- **開発者管理ページ実装**★新規
  - 契約宿泊管理者のエラーやスコアなどが閲覧できる統括ページ
  - 全施設のパフォーマンス指標を一覧表示
  - エラーログの集約表示
  - 信頼度スコアの推移グラフ
- **デモサイト実装**★新規
  - PoC契約に向け、参加希望者が閲覧できるデモサイト
  - テスト用IDとパスワードを提供
  - 実際のシステム機能を体験できる環境
- **宿泊施設管理者向けFAQ実装**★新規
  - 宿泊管理者が困惑しないよう本システムと同様のFAQを設置
  - 管理画面内にFAQページを追加
  - よくある質問と回答を提供
- **Phase 2残存課題対応**★新規（2025-12-21追加、2025-12-22更新）
  - **セッション有効期限延長問題の対応**✅完了（2025-12-22）: 防止策1（`started_at`ベースの固定有効期限）を実装。チェックアウト後もアクセス可能になる問題を防止。`backend/app/utils/session.py`を新規作成、`chat_service.py`と`chat.py`を修正。参照文書: `docs/Phase1_Phase2_セッション有効期限延長問題_防止策1実装_完全調査分析_修正案_20251222.md`
  - **宿泊管理者ダッシュボードグラフ削除問題の対応**✅完了（2025-12-22）: グラフコンポーネント（`CategoryChart`）のみをコメントアウト（マスク）。統計カード（スコア）は表示を維持。円グラフ（SVG）のみを非表示、凡例と合計は表示を維持。参照文書: `docs/Phase1_Phase2_宿泊管理者ダッシュボードグラフ削除問題_完全調査分析_修正案_20251221.md`
  - **PWAインストールプロンプトのボタンの動作問題の対応**: スマホのホーム画面にアイコンが表示されるが、アイコンをタップすると404エラーが発生する問題を調査・修正。6セッション以上取り組んだが未解決。残存課題として継承。参照文書: `docs/20251222_220854_PWA404エラー_残存課題_完全総括_失敗履歴修正履歴_コードベース現況_継承文書.md`
  - **ランディングページの料金プラン表示変更**✅完了（2025-12-22）: 新しい料金プラン（Free/Mini/Small/Standard/Premium）を反映。`landing/index.html`を修正し、`main`ブランチにプッシュ済み。GitHub Pagesでデプロイ完了。同時利用言語数の概念を明示、全プランで表示項目を統一、Freeプランの説明を追加、FAQ Q7を更新、応募締切日を2026年1月20日（予定）に更新。
  - **FAQ登録数カウント方法修正**★新規（2025-12-21追加）: FAQ登録数を「意味（インテント）」単位で1件としてカウントするように修正。データベーススキーマ変更（`faqs`テーブルと`faq_translations`テーブルに分離）、既存データ移行、バックエンド・フロントエンド修正を実施。多言語対応してもFAQ登録数が増えない設計に変更（「今何時ですか？」と「what time is it now?」は1件としてカウント）。参照文書: `docs/Phase1_Phase2_FAQ登録数カウント方法修正_ステップ計画_大原則準拠_20251221.md`
  - **料金プラン改訂**★新規（2025-12-21追加、2025-12-22完了）: Freeプラン追加（1言語、30質問限定、超過後はFAQ対応のみ、20件、〜25床）、同時利用言語数の概念追加、各プランの言語数・価格・FAQ登録数・規模目安を更新（Mini: 2言語、Small: 3言語、Standard: 4言語、Premium: 無制限言語）。ランディングページへの反映完了（2025-12-22）。

### Phase 3: PoC実施（2ヶ月）
- **3施設同時スタート**
- 週次ヒアリング（30分×3施設）
- FAQ最適化（自動学習機能活用）
- **ゲストフィードバックデータ分析**
- バグ修正・機能改善
- 成功事例の記録
- 有料転換率測定
- **本番向けランディングページ作成**★新規
  - SNSなどから誘引するページで申し込み受付できるページ
  - ヒーローセクション、機能紹介、料金プラン、申し込みフォーム
  - SEO最適化、SNSシェアボタン
  - 問い合わせフォーム、FAQセクション
- **管理者ダッシュボードページに月次サマリー統計カードをメインで実装**★新規（2025-12-21追加）
  - 管理者は月次統計と料金が一番の関心課題なので、月次サマリー統計カードをメインで実装
  - のちにStripeとリンク
  - **請求期間ベースの統計カード（上段）**:
    - 総質問数: 現在の請求期間中にゲストが送信した質問の総数。プラン上限と残り利用可能数を表示
    - AI自動対応数: AIがエスカレーションせず完結した質問数（総質問数 − エスカレーション数）
    - 自動応答率: AIのみで完結した質問の割合（AI自動対応数 ÷ 総質問数 × 100）
    - エスカレーション数: 人手対応が必要だった質問数（信頼度不足、安全カテゴリ、夜間対応の内訳表示）
    - 想定人手対応時間削減: AI対応により削減された想定人手対応時間（AI自動対応数 × 3分）。これが一番「払ってよかった」と感じるカード
  - **品質・安心系カード（下段）**:
    - 平均AI信頼度: AI回答の信頼度平均値
    - ゲスト満足度（👍率）: ゲストフィードバック肯定率（👍 ÷ (👍 + 👎)）
- **プラン超過時の挙動の実装**★新規（2025-12-21追加）
  - 管理者選択制で、プラン超過時の挙動を実装
  - **通常継続（従量課金）**: プラン超過時も通常通りAI応答を継続し、超過分を従量課金（¥30/質問）で請求
  - **AI停止・FAQ限定モード**: プラン超過時はAI応答を停止し、FAQのみで対応
- **QRコードデザイン変更**★新規（2025-12-22追加）
  - QRコードの中央に「YadOPERA」テキストを配置
  - QRコードの下部に情報を追加（設置場所、生成日時、施設名など）
  - PNG/PDF/SVG形式すべてに対応
  - 実装箇所: `backend/app/services/qr_code_service.py`の`generate_qr_code()`メソッド

### Phase 4: 本格展開準備（1ヶ月）
- PoC結果を反映した機能改善
- **本番環境構築・デプロイ**（Render.com）
  - 本番環境設定（環境変数、データベース接続）
  - Render.com PostgreSQL（Managed）作成
  - Redis Cloud設定
  - カスタムドメイン設定（yadopera.com）
  - SSL証明書設定
  - 本番環境デプロイ確認
- **新規登録ページ作成**★新規
  - Stripe実装直前に実装予定
  - 現在はログインページしか作成されていない
  - メールアドレス・パスワード・施設情報入力フォーム
  - 利用規約・プライバシーポリシーへの同意
  - メール認証機能
- 決済機能実装（Stripe連携）
- **多言語対応（アンケート結果に基づく優先言語）**
- Slack/LINE通知連携
- **地域拡大準備（福岡・沖縄）**

**合計期間**: 約5ヶ月

---

## 8. PoC計画（v0.3改訂）

### 対象施設選定基準
| 条件 | 目標値 | 理由 |
|------|-------|------|
| 施設数 | **3施設** | 品質重視、一人開発の限界考慮 |
| 外国人ゲスト比率 | 40%以上 | 高利用頻度を確保 |
| スタッフ体制 | 2-3名 | 最低限のフィードバック体制 |
| ベッド数 | 20-40床 | 中規模で検証 |
| やどびと利用実績 | 過去6ヶ月 | 信頼関係あり |
| 立地分散 | 京都1/大阪1/東京1 | 地域差の検証 |

### PoC施設数削減の理由
- 一人開発での品質担保
- 週次MTG工数: 3施設×30分×12週 = 18時間（旧: 30-42時間）
- 深いフィードバック収集が可能
- 成功パターン確立後にスケール

### PoC提供内容
- 月額料金: **完全無料**（2ヶ月間）
- AI利用制限: なし
- 初期設定サポート: FAQ登録支援、施設情報入力代行
- 専用Slackチャンネル
- 週次ミーティング: 30分オンライン
- 週次レポート自動送信
- **ゲストフィードバック分析レポート（月次）**

### 検証KPI

**定量指標**
| KPI | 目標値 | 測定方法 |
|-----|-------|----------|
| 総質問数 | 100件/月/施設 | conversations集計 |
| 自動応答率 | 70%以上 | (総質問 - エスカレーション) / 総質問 |
| 平均レスポンス時間 | 3秒以内 | response_time_ms平均 |
| **ゲストフィードバック肯定率** | 80%以上 | 👍 / (👍+👎) |
| **FAQ自動追加数** | 10件/月/施設 | faq_suggestions承認数 |
| 夜間質問数 | 30件/月/施設 | 時間帯別集計 |

**定性指標**
- スタッフ体感負担度（5段階）
- 料金感度調査
- 次に欲しい機能TOP3
- NPS

### 成功基準
- PoC終了後の有料転換率: **67%以上**（3施設中2施設）
- NPS: **+30以上**
- クリティカルバグ: **0件**
- スタッフ負担度改善: 平均**2ポイント以上**
- **ゲストフィードバック肯定率: 75%以上**

---

## 9. 収益モデル（v0.3改訂）

### 価格設定（本導入後）

**サブスクリプションプラン（2025-12-21更新）**
| プラン | 同時利用言語数 | 想定 | 価格 | FAQ登録数 | 規模目安 |
|--------|---------------|------|------|-----------|----------|
| Free | 1言語 | 国内・日本語のみ※選択不可（30質問限定）超過後はFAQ対応のみ | 無料 | 20件 | 〜25床 |
| Mini | 2言語 | 日本語＋英語 | ¥1,980/月 + ¥30/質問（最初から従量課金） | 30件 | 〜25床 |
| Small | 3言語 | 日・英・中（繁体字中国語） | ¥3,980/月、200件/月まで（超過分は+ ¥30/質問） | 50件 | 〜25床 |
| Standard | 4言語 | 日・英・中（繁体字中国語）・仏 | ¥5,980/月、500件/月まで（超過分は+ ¥30/質問） | 100件 | 26-50床 |
| Premium | 無制限 | - | ¥7,980/月、1,000件/月まで（超過分は+ ¥30/質問） | 無制限 | 51床以上 |

**注意**: FAQ登録数は「意味（インテント）」単位で1件としてカウントされます。多言語対応してもFAQ登録数が増えない設計です（例：「今何時ですか？」と「what time is it now?」は1件としてカウント）。

**プラン超過時の挙動（管理者選択制）**
- **通常継続（従量課金）**: プラン超過時も通常通りAI応答を継続し、超過分を従量課金（¥30/質問）で請求
- **AI停止・FAQ限定モード**: プラン超過時はAI応答を停止し、FAQのみで対応

**従量課金プラン（旧）**
| プラン | 月額基本料 | 従量料金 | 上限 |
|--------|-----------|---------|------|
| Pay-as-you-go | ¥1,980 | ¥30/質問 | 500件/月 |

*想定ユースケース*: 質問数が少ない施設、季節変動が大きい施設

**セットアップ代行サービス（新規）**
| サービス | 料金 | 内容 |
|----------|------|------|
| FAQ作成代行 | ¥30,000 | 30件まで、ヒアリング含む |
| 完全導入サポート | ¥50,000 | FAQ50件+施設情報+QRコード設置案 |

### コスト構造（月額）

**固定費**: ¥19,500-25,000（変更なし）

**運用費**
- 開発・保守: ¥120,000-150,000/月
- カスタマーサポート: ¥30,000/月（Phase 2（PoC準備）以降、AIヘルプチャット実装により70%削減予定）

### 収益シミュレーション（v0.3改訂）

**Year 1**
- Q1: PoC期間（3施設、売上¥0）
- Q2-Q4: 
  - M12: 25施設（市場5%、保守的）
  - 売上構成: サブスク20施設×¥5,000 + 従量5施設×¥2,500
  - 月間売上: ¥112,500
  - セットアップ代行: 5件×¥35,000 = ¥175,000（一時収益）

**Year 2**
- 目標: 50施設（初期市場33%、Expansion Phase A地域含め17%）
- 月間売上: ¥250,000
- 年間売上: ¥3,000,000
- 営業利益: ¥300,000-600,000

**損益分岐点（改訂）**
- 月次固定費: ¥145,000
- サブスク平均ARPU: ¥5,000（粗利80%）
- 従量平均ARPU: ¥2,500（粗利75%）
- BEP ≈ 32-37施設
- **Year 2 Q2で黒字化想定**

### 補助金活用戦略（変更なし）
- 小規模事業者持続化補助金: 最大¥300,000
- IT導入補助金: 年間利用料の50%
- 自治体インバウンド推進事業

---

## 10. GTM戦略

### フェーズ1: PoC施設募集（1ヶ月）

**メールDM戦略（100-150施設）**

*変更点*: 3施設限定を強調、希少性訴求

件名: 【やどびと限定3施設】AI多言語対応ツール無料PoC募集

**オンライン説明会**
- 頻度: 週1回×4週間
- 時間: 毎週水曜日 18:00-18:30
- 定員: 20施設/回
- 選考プロセス説明を追加

### フェーズ2: PoC実施（2ヶ月）
- 週次ヒアリング（30分×3施設）
- 専用Slackでの即時サポート
- **FAQ自動学習機能の活用促進**
- **ゲストフィードバックの週次分析共有**
- 成功事例の記録

### フェーズ3: 成功事例の発信（PoC後）
- やどびと特集記事
- 導入施設インタビュー動画
- 具体的数値訴求（「問い合わせ70%削減」等）
- プレスリリース配信

### フェーズ4: 本格展開・地域拡大
- 紹介キャンペーン
- **福岡・沖縄への営業開始**
- 業界団体・自治体連携
- **地域別パートナー施設の開拓**

---

## 11. 競合モニタリング体制（新規）

### 四半期レビュー制度

**モニタリング対象**
1. 小規模宿向けPMS: BedLinker、minn、Beds24
2. AI チャットボットサービス: ChatGPTプラグイン、カスタムGPT
3. 多言語対応ツール: Google翻訳API活用サービス
4. 宿泊業界SaaS全般

**レビュー項目**
- 新機能リリース
- 価格変更
- 資金調達・M&A情報
- ユーザーレビュー・評判
- 市場シェア推定

**対応アクション**
- 機能ロードマップへの反映
- 価格戦略の見直し
- 差別化ポイントの再定義
- マーケティングメッセージ調整

**実施タイミング**
- Q1: 1月第2週
- Q2: 4月第2週
- Q3: 7月第2週
- Q4: 10月第2週

---

## 12. 将来拡張（Expansion Phase A-C）

**注意**: 開発スケジュール（7章）のPhase 0-4とは異なり、本格展開後の拡張フェーズを表します。混乱を避けるため、Expansion Phase A/B/Cと表記します。

### Expansion Phase A（PoC終了後 3-6ヶ月）
- **多言語追加**: アンケート結果に基づく優先言語（繁体中国語or韓国語想定）
- **地域拡大**: 福岡・沖縄への営業開始
- 通知機能強化: Slack/LINE連携
- 分析機能拡充: カテゴリ統計、時間帯ヒートマップ
- キャッシュ最適化: Redis活用強化
- **データ自動削除バッチ処理**: GDPR準拠3ヶ月削除（Celery実装）

### Expansion Phase B（6-12ヶ月）
- **地域拡大**: 北海道・金沢・広島
- 多言語完全対応: 簡体中国語、韓国語、自動言語判定
- 軽量PMS機能: 宿泊者一覧、簡易部屋割、引き継ぎメモ
- 要望管理: トラブル報告、ステータス管理

### Expansion Phase C（12-24ヶ月）
- 簡易PMS完全版: 複数施設管理、予約システム連携
- レンタルオプション管理: 在庫管理、貸出・返却記録、決済統合
- サプライ品在庫管理
- アップセル機能: 延泊提案、ローカル体験紹介
- 音声対応: Whisper API
- 画像認識: 設備トラブル診断

---

## 13. リスクと対策（v0.3改訂）

### 技術リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| OpenAI API障害 | 高 | フォールバック文言、キャッシュ、複数APIキー |
| AI回答精度不足 | 高 | **FAQ自動学習機能、ゲストフィードバック活用** |
| レスポンス遅延 | 中 | async/await、CDN、ストリーミング |
| pgvector性能劣化 | 中 | IVFFlatインデックス最適化 |
| データ漏洩 | 高 | SSL/TLS、暗号化、最小権限原則 |
| **安全情報誤答** | **高** | **強制エスカレーション、人間対応必須** |

### ビジネスリスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| PoCで効果が出ない | 高 | **3施設に絞り品質重視、早期改善** |
| チャーン率高 | 中 | オンボーディング強化、週次レポート |
| 競合参入 | 中 | **四半期モニタリング、差別化強化** |
| 市場規模過大評価 | 高 | **段階的地域拡大、ピボット準備** |
| 一人開発の限界 | 高 | **PoC施設数削減、自動化推進** |

### 法的・コンプライアンスリスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 個人情報漏洩 | 高 | GDPR準拠、3ヶ月自動削除 |
| AI誤答による損害 | 中 | **医療・安全は強制エスカレーション**、免責事項 |
| 宿泊業法抵触 | 低 | 将来PMS連携で対応 |

---

## 14. 開発コスト概算

### 自己開発（Air単独）
| 項目 | 工数 | 備考 |
|------|------|------|
| MVP開発 | 180時間 | 4週間 × 40h + 新機能20h |
| PoC対応 | **18時間** | 週次MTG 3施設×30分×12週 |
| Expansion Phase A開発 | 80時間 | 多言語・通知・地域拡大 |
| **合計** | **278時間** | 約2ヶ月フルタイム相当 |

### 運用コスト（月額）
| 項目 | 金額 |
|------|------|
| インフラ合計 | ¥24,500-39,500 |

**損益分岐点**: 32-37施設

---

## 15. 成功指標（KPI）

### 短期（PoC終了時）
- PoC参加施設: **3施設**
- 自動応答率: 70%以上
- **ゲストフィードバック肯定率: 75%以上**
- 継続利用意向: **67%以上**（2施設以上）
- 成功事例: 2件以上
- NPS: +30以上
- **FAQ自動追加: 30件以上**（3施設合計）

### 中期（1年後）
- 有料契約施設: 25施設
- 月間売上: ¥112,500
- チャーン率: 15%以下
- 自動応答率: 85%達成
- **対応地域: 3地域**（京都・大阪・東京）

### 長期（2年後）
- 契約施設: 50施設
- 月間売上: ¥250,000
- チャーン率: 10%以下
- **対応地域: 6地域**（+福岡・沖縄・北海道）
- アップセル機能利用率: 30%

---

## 16. 次のアクション

### 即時（1週間以内）
- [ ] アーキテクチャ設計書v0.3作成
- [ ] **簡易ランディングページ（LP）作成**★新規
  - [ ] デザイン・構成決定（ヒーロー、課題提起、解決策、仕組み、料金、FAQ、CTA）
  - [ ] デモ動画作成（1分程度）
  - [ ] PoC応募フォーム実装
  - [ ] 説明会予約機能実装
  - [ ] デプロイ（静的ホスティング）
- [ ] **開発環境構築**（詳細化）★追加
  - [ ] プロジェクト構造作成（backend/, frontend/, docs/）
  - [ ] `.gitignore`設定
  - [ ] `docker-compose.yml`作成・動作確認
  - [ ] `backend/Dockerfile`作成
  - [ ] `frontend/Dockerfile`作成
  - [ ] `backend/requirements.txt`作成
  - [ ] `backend/.env.example`作成
  - [ ] Alembic初期化・設定
  - [ ] `frontend/package.json`作成
  - [ ] `frontend/.env.example`作成
  - [ ] Vite + Vue 3プロジェクト初期化
  - [ ] README.md作成（セットアップ手順）
  - [ ] 全サービス起動確認（`docker-compose up`）
- [ ] GitHub リポジトリ作成
- [ ] OpenAI API キー取得
- [ ] Render アカウント準備
- [ ] **やどびと多言語優先度アンケート設計・配信**

### 開発準備（2週間以内）
- [ ] データベース設計詳細化（**新規テーブル含む**）
- [ ] API仕様書作成
- [ ] UI/UXワイヤーフレーム作成（**フィードバックUI、セッション統合UI含む**）
- [ ] 初期FAQリスト作成
- [ ] **安全カテゴリキーワードリスト作成**
- [ ] **宿泊事業者向けFAQ（20-30項目）作成**★新規

### MVP開発開始
- [ ] Week 1: バックエンド基盤（**セッション統合トークン含む**）
- [ ] Week 2: AI対話エンジン（**信頼度スコア改善版、強制エスカレーション含む**）
- [ ] Week 3: フロントエンド（**FAQ自動学習UI、フィードバックUI含む**）
- [ ] Week 4: 統合テスト・デプロイ

---

## 付録

### A. サービス名の由来
**やどぺら** = 「宿」 + 「ぺらぺら（流暢に話す）」

### B. 初期FAQテンプレート30件
（v0.21と同一、省略）

### C. 宿泊事業者向けFAQテンプレート（新規）

**初期設定（5項目）**
1. アカウント作成の手順は？
2. 施設情報はどこで登録しますか？
3. 初回ログイン後にまずやるべきことは？
4. スタッフアカウントを追加できますか？
5. パスワードを忘れた場合は？

**QRコード設置（4項目）**
6. QRコードはどこに貼るのがベストですか？
7. 複数のQRコードを使い分けられますか？
8. QRコードの印刷サイズの推奨は？
9. QRコードを再発行したい場合は？

**FAQ登録・編集（5項目）**
10. FAQテンプレートの使い方は？
11. 自分でFAQを追加する方法は？
12. FAQの優先度とは何ですか？
13. カテゴリはどう分けるべきですか？
14. FAQを一括登録できますか？

**AI応答の仕組み（4項目）**
15. AIはどうやって回答を選んでいますか？
16. 信頼度スコアとは何ですか？
17. エスカレーションはいつ発生しますか？
18. AI回答がおかしい場合どうすればいいですか？

**ログ・分析（3項目）**
19. ゲストとのチャット履歴はどこで見られますか？
20. 週次レポートには何が含まれていますか？
21. ゲストからの評価（フィードバック）はどこで確認できますか？

**トラブルシューティング（4項目）**
22. AIが応答しない場合は？
23. WiFiが弱い宿でも使えますか？
24. ゲストがQRコードを読み取れないと言っています
25. 「システムが一時的に利用できません」と表示されます

**料金・請求（3項目）**
26. 料金体系を教えてください
27. OpenAI APIの従量料金はどれくらいかかりますか？
28. プランを変更したい場合は？

**セキュリティ・プライバシー（2項目）**
29. ゲストのデータはどのくらい保存されますか？
30. セキュリティ対策について教えてください

### D. 安全カテゴリキーワードリスト

**医療関連（即エスカレーション）**
- 英語: hospital, doctor, ambulance, emergency room, sick, injured, fever, allergy, medicine, pharmacy, pain, bleeding, unconscious
- 日本語: 病院, 医者, 救急車, 具合悪い, 怪我, 熱, アレルギー, 薬, 痛い

**安全・避難関連（即エスカレーション）**
- 英語: fire, earthquake, evacuation, escape route, emergency exit, tsunami, typhoon
- 日本語: 火災, 火事, 地震, 避難, 非常口, 津波, 台風

### D. 参考URL
（v0.21と同一）

### E. 問い合わせ
- 開発者: Air
- ブログ: https://air-edison.com
- Twitter: @kbqjp

---

**Document Version**: v0.3.6  
**Based on**: v0.21 要約定義書  
**Author**: Air  
**Last Updated**: 2025-12-22 09時18分02秒  
**Status**: 開発準備完了

---

## 変更履歴サマリー

| バージョン | 日付 | 主な変更 |
|-----------|------|---------|
| v0.1 | 2025-11 | 初版作成 |
| v0.2 | 2025-11-19 | RAG統合、エスカレーションモード、補助金戦略 |
| v0.21 | 2025-11-19 | JWT認証ライブラリ修正 |
| v0.3 | 2025-11-21 | 市場拡大戦略、PoC施設数最適化、FAQ自動学習MVP化、夜間対応設計、信頼度スコア改善、セッション統合、収益モデル多様化、安全カテゴリ強制エスカレーション、競合モニタリング体制、**宿泊事業者向けFAQ＋AIサポート（Phase 2（PoC準備））**、データ保持ポリシー詳細化 |
| v0.3.1 | 2025-11-25 | **ブランチ戦略とデプロイ戦略追加**（オプション2採用、Railway Hobbyステージング環境、実装フェーズ明確化） |
| v0.3.2 | 2025-12-01 | **Phase表記の明確化**（将来拡張をExpansion Phase A/B/Cに変更、宿泊事業者向けAIヘルプチャット実装時期をPhase 2（PoC準備）に変更） |
| v0.3.3 | 2025-12-20 | **Phase 2-4の機能追加**（開発者管理ページ、デモサイト、宿泊施設管理者向けFAQ、本番向けランディングページ、新規登録ページ） |
| v0.3.4 | 2025-12-21 | **Phase 2-3残存課題追加**（セッション有効期限延長問題、ダッシュボードグラフ削除問題、PWAインストールプロンプト問題、料金プラン表示変更、月次サマリー統計カード仕様、プラン超過時挙動） |
| v0.3.5 | 2025-12-21 | **FAQ登録数カウント方法修正（Phase 2実施）**（データベーススキーマ変更、既存データ移行、バックエンド・フロントエンド修正、多言語対応してもFAQ登録数が増えない設計に変更） |
| v0.3.6 | 2025-12-21 | **料金プラン改訂**（Freeプラン追加、同時利用言語数の概念追加、各プランの言語数・価格・FAQ登録数・規模目安を更新） |
| v0.3.7 | 2025-12-22 | **Phase 2残存課題対応完了**（セッション有効期限延長問題の防止策1実装完了、宿泊管理者ダッシュボードグラフ削除問題対応完了） |
| v0.3.8 | 2025-12-23 | **ランディングページの料金プラン表示変更完了**（新仕様（v0.3.6）への更新完了、同時利用言語数の概念を明示、全プランで表示項目を統一、Freeプランの説明を追加、FAQ Q7を更新、応募締切日を2026年1月20日（予定）に更新、GitHub Pagesでデプロイ完了） |