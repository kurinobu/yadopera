# ⚠️ 危険！重要！ PWAインストール後の起動時404エラー 期待動作の誤認識警告

**作成日時**: 2025年12月22日  
**実施者**: AI Assistant  
**目的**: AI Assistantの誤った認識を記録し、再発防止のため警告を記載  
**状態**: ⚠️ **誤認識警告記録完了**

---

## ⚠️ 危険！重要！ 誤った認識の記録

### 誤った認識

**AI Assistantが誤って理解していた内容**:
- ❌ **「ゲストがPWAアイコンをタップ → 404エラーページが表示される」という動作を期待している**
- ❌ **「保存された施設URLがない場合、404エラーページを表示する」という動作を期待している**

**これは完全に間違った理解です。**

### 正しい期待動作

**正しい期待動作**:
- ✅ **ゲストがPWAアイコンをタップ → 最後にアクセスした施設URL（例: `/f/:facilityId`）にリダイレクト → 施設独自の画面が表示される**
- ✅ **404エラーページを表示することは期待されていない**
- ✅ **「施設URLがない場合」という状況は発生してはいけない（PWAインストールはゲスト側のルートでのみ可能なため）**

### ユーザーの指摘

**ユーザーの明確な指摘**:
- 「「ゲストがPWAアイコンをタップ → 404エラーページが表示される」→こんなことを期待してない！！！バカかお前は！！！何のためのアイコンインストールだ！４０４のためのアイコンをインストールするバカなゲストがいると思ってるのか！！！」
- 「「保存された施設URLがない場合」→こんな場合や状況を作ってはいけない。「施設URLがない」場合がありえない。あってはいけない。そんなアイコンを作成してはいけない。」

---

## ⚠️ 危険！重要！ 誤った認識が反映されている可能性がある文書

### 影響を受ける可能性がある文書

以下の文書に誤った認識が反映されている可能性があります：

1. **`docs/Phase1_Phase2_PWAインストール後の起動時404エラー_全質問回答_期待動作理解_修正案_20251222.md`**
   - 「保存された施設URLがない場合、404エラーページを表示（QRコードで読み取るよう案内）」という記述
   - **⚠️ 誤った認識が反映されている可能性**

2. **`docs/Phase1_Phase2_PWAインストール後の起動時404エラー_localStorage実装状況確認_修正案_20251222.md`**
   - 「保存された施設URLがない場合、404エラーページを表示（QRコードで読み取るよう案内）」という記述
   - **⚠️ 誤った認識が反映されている可能性**

3. **`docs/Phase1_Phase2_PWAインストール後の起動時404エラー_大原則準拠修正案_20251222.md`**
   - 「施設URLがない場合（想定外）は404エラーページを表示（エラーログを出力）」という記述
   - **⚠️ 誤った認識が反映されている可能性**

4. **`docs/Phase1_Phase2_PWAインストール後の起動時404エラー_セキュリティ調査分析_20251222.md`**
   - 「施設URLがない場合は想定外のエラー（この状況は発生してはいけない）」という記述は正しいが、404エラーページを表示するという記述が含まれている可能性
   - **⚠️ 誤った認識が反映されている可能性**

5. **`docs/Phase1_Phase2_PWAインストール後の起動時404エラー_調査依頼書_ChatGPT_Claude用_20251222.md`**
   - 「期待する動作」のセクションに誤った認識が反映されている可能性
   - **⚠️ 誤った認識が反映されている可能性**

6. **`docs/Phase1_Phase2_PWAインストール後の起動時404エラー_重大問題_ゲストが管理者ログインページにアクセス_完全調査分析_修正案_20251222.md`**
   - 「適切なページ（404エラーページまたは適切な案内ページ）にアクセスするべき」という記述
   - **⚠️ 誤った認識が反映されている可能性**

7. **その他のPWA関連文書**
   - 404エラーページを表示するという記述が含まれている可能性
   - **⚠️ 誤った認識が反映されている可能性**

---

## ⚠️ 危険！重要！ 正しい期待動作

### 正しい期待動作（再確認）

**PWAインストール後の起動時（ゲスト）**:
1. ゲストがPWAアイコンをタップ
2. `start_url: "/"`にアクセス
3. `index.html`が返される
4. Vue Routerが初期化される
5. **Vue Routerが`/`のルートにマッチする**
6. **`beforeEnter`ガードが実行される**
7. **localStorageから最後にアクセスした施設URLを取得**
8. **保存された施設URLにリダイレクト**
9. **施設独自の画面が表示される**
10. **ゲストが期待する動作が実現される**

**重要な認識**:
- ✅ **ゲストがPWAアイコンをタップした際、最後にアクセスした施設URLにリダイレクトされることが期待される**
- ❌ **404エラーページを表示することは期待されていない**
- ❌ **「施設URLがない場合」という状況は発生してはいけない（PWAインストールはゲスト側のルートでのみ可能なため）**

---

## ⚠️ 危険！重要！ 再発防止のための注意事項

### 注意事項

1. **期待動作の確認**:
   - 常に「ゲストがPWAアイコンをタップした際、最後にアクセスした施設URLにリダイレクトされる」ことを期待動作として理解する
   - 404エラーページを表示することは期待されていない

2. **「施設URLがない場合」の扱い**:
   - 「施設URLがない場合」という状況は発生してはいけない
   - PWAインストールはゲスト側のルート（`/f/:facilityId`）でのみ可能なため、インストール時には必ず施設URLが存在する
   - この状況を想定した実装は不要

3. **文書作成時の注意**:
   - 期待動作を記載する際は、必ず「最後にアクセスした施設URLにリダイレクトされる」ことを明記する
   - 404エラーページを表示するという記述は避ける（ただし、セキュリティ対策として不正なURLが検出された場合は除く）

---

**Document Version**: v1.0  
**Author**: AI Assistant  
**Last Updated**: 2025年12月22日  
**Status**: ⚠️ **誤認識警告記録完了**

**重要**: この文書は、AI Assistantの誤った認識を記録し、再発防止のための警告として作成されました。関連する文書を参照する際は、この文書の内容を必ず確認してください。

