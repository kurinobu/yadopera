============================= test session starts ==============================
platform darwin -- Python 3.11.1, pytest-7.4.4, pluggy-1.5.0
rootdir: /Users/kurinobu/projects/yadopera/backend
configfile: pytest.ini
plugins: asyncio-0.23.3, flask-1.3.0, metadata-3.1.1, cov-4.1.0, html-4.0.0, anyio-3.7.0
asyncio: mode=Mode.AUTO
collected 71 items

tests/test_ai_engine.py EEFE                                             [  5%]
tests/test_auth.py EEEEFE.E                                              [ 16%]
tests/test_chat_api.py sEE                                               [ 21%]
tests/test_chat_service.py EE.                                           [ 25%]
tests/test_confidence.py EFEFEFEF                                        [ 36%]
tests/test_embeddings.py ....                                            [ 42%]
tests/test_escalation.py EEEEEE                                          [ 50%]
tests/test_integration.py E.sEEEEEEE.E.EE                                [ 71%]
tests/test_overnight_queue.py EEE                                        [ 76%]
tests/test_safety_check.py .F..                                          [ 81%]
tests/test_session_token.py EEEEEEE                                      [ 91%]
tests/test_vector_search.py E.EE.E                                       [100%]

=============================== warnings summary ===============================
../../../.pyenv/versions/3.11.1/lib/python3.11/site-packages/pydantic/_internal/_config.py:271: 20 warnings
  /Users/kurinobu/.pyenv/versions/3.11.1/lib/python3.11/site-packages/pydantic/_internal/_config.py:271: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

../../../.pyenv/versions/3.11.1/lib/python3.11/site-packages/passlib/utils/__init__.py:854
  /Users/kurinobu/.pyenv/versions/3.11.1/lib/python3.11/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
    from crypt import crypt as _crypt

tests/test_ai_engine.py: 2 warnings
tests/test_auth.py: 4 warnings
tests/test_chat_api.py: 1 warning
tests/test_chat_service.py: 1 warning
tests/test_confidence.py: 4 warnings
tests/test_escalation.py: 3 warnings
tests/test_integration.py: 7 warnings
tests/test_overnight_queue.py: 2 warnings
tests/test_session_token.py: 3 warnings
tests/test_vector_search.py: 2 warnings
  /Users/kurinobu/.pyenv/versions/3.11.1/lib/python3.11/site-packages/_pytest/stash.py:104: RuntimeWarning: coroutine 'Connection._cancel' was never awaited
    del self._storage[key]
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_ai_engine.py::TestRAGEngine::test_process_message_facility_not_found
FAILED tests/test_auth.py::TestLogin::test_login_validation_error - Assertion...
FAILED tests/test_confidence.py::TestConfidence::test_short_response_penalty
FAILED tests/test_confidence.py::TestConfidence::test_proper_noun_bonus - Att...
FAILED tests/test_confidence.py::TestConfidence::test_custom_faq_bonus - Attr...
FAILED tests/test_confidence.py::TestConfidence::test_multiple_penalties - At...
FAILED tests/test_safety_check.py::TestSafetyCheck::test_safety_keyword_detection
ERROR tests/test_ai_engine.py::TestRAGEngine::test_process_message_success - ...
ERROR tests/test_ai_engine.py::TestRAGEngine::test_process_message_embedding_failure
ERROR tests/test_ai_engine.py::TestRAGEngine::test_process_message_openai_error
ERROR tests/test_auth.py::TestLogin::test_login_success - sqlalchemy.exc.Inte...
ERROR tests/test_auth.py::TestLogin::test_login_invalid_email - RuntimeError:...
ERROR tests/test_auth.py::TestLogin::test_login_invalid_password - sqlalchemy...
ERROR tests/test_auth.py::TestLogin::test_login_inactive_user - RuntimeError:...
ERROR tests/test_auth.py::TestLogout::test_logout_success - RuntimeError: Tas...
ERROR tests/test_auth.py::TestLogout::test_logout_invalid_token - RuntimeErro...
ERROR tests/test_chat_api.py::TestChatAPI::test_get_chat_history - sqlalchemy...
ERROR tests/test_chat_api.py::TestChatAPI::test_get_chat_history_not_found - ...
ERROR tests/test_chat_service.py::TestChatService::test_process_chat_message_new_conversation
ERROR tests/test_chat_service.py::TestChatService::test_get_conversation_history
ERROR tests/test_confidence.py::TestConfidence::test_base_confidence - Runtim...
ERROR tests/test_confidence.py::TestConfidence::test_uncertain_phrase_penalty
ERROR tests/test_confidence.py::TestConfidence::test_number_bonus - RuntimeEr...
ERROR tests/test_confidence.py::TestConfidence::test_confidence_clipping - Ru...
ERROR tests/test_escalation.py::TestEscalation::test_safety_category_escalation
ERROR tests/test_escalation.py::TestEscalation::test_low_confidence_escalation
ERROR tests/test_escalation.py::TestEscalation::test_emergency_keyword_escalation
ERROR tests/test_escalation.py::TestEscalation::test_multiple_turns_escalation
ERROR tests/test_escalation.py::TestEscalation::test_no_escalation_needed - R...
ERROR tests/test_escalation.py::TestEscalation::test_create_escalation - sqla...
ERROR tests/test_integration.py::TestAuthFlow::test_login_and_access_protected_endpoint
ERROR tests/test_integration.py::TestChatFlow::test_chat_history_flow - Runti...
ERROR tests/test_integration.py::TestAdminFlow::test_dashboard_access - sqlal...
ERROR tests/test_integration.py::TestAdminFlow::test_faq_list_access - Runtim...
ERROR tests/test_integration.py::TestAdminFlow::test_faq_create_flow - sqlalc...
ERROR tests/test_integration.py::TestAdminFlow::test_faq_suggestions_access
ERROR tests/test_integration.py::TestAdminFlow::test_overnight_queue_access
ERROR tests/test_integration.py::TestAdminFlow::test_qr_code_generation_access
ERROR tests/test_integration.py::TestErrorHandling::test_invalid_json - Runti...
ERROR tests/test_integration.py::TestResponseTime::test_dashboard_response_time
ERROR tests/test_integration.py::TestResponseTime::test_faq_list_response_time
ERROR tests/test_overnight_queue.py::TestOvernightQueue::test_add_to_overnight_queue
ERROR tests/test_overnight_queue.py::TestOvernightQueue::test_get_overnight_queue
ERROR tests/test_overnight_queue.py::TestOvernightQueue::test_send_overnight_auto_reply
ERROR tests/test_session_token.py::TestSessionTokenVerify::test_verify_token_success
ERROR tests/test_session_token.py::TestSessionTokenVerify::test_verify_token_invalid
ERROR tests/test_session_token.py::TestSessionTokenVerify::test_verify_token_expired
ERROR tests/test_session_token.py::TestSessionLink::test_link_session_success
ERROR tests/test_session_token.py::TestSessionLink::test_link_session_invalid_token
ERROR tests/test_session_token.py::TestSessionLink::test_link_session_expired_token
ERROR tests/test_session_token.py::TestSessionLink::test_link_session_wrong_facility
ERROR tests/test_vector_search.py::TestVectorSearch::test_search_similar_faqs_empty_embedding
ERROR tests/test_vector_search.py::TestVectorSearch::test_search_similar_faqs_with_data
ERROR tests/test_vector_search.py::TestVectorSearch::test_search_similar_patterns_empty_embedding
ERROR tests/test_vector_search.py::TestVectorSearch::test_search_similar_patterns_with_data
= 7 failed, 14 passed, 2 skipped, 50 warnings, 48 errors in 286.52s (0:04:46) ==
